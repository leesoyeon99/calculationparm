// 2022 ê°œì • ìˆ˜í•™ ê³„í†µë„ ê¸°ë°˜ ì»¤ë¦¬í˜ëŸ¼ ë°ì´í„°

export interface CurriculumUnit {
  id: string;
  title: string;
  grade: number;
  subject: string;
  subSubject: string;
  stageRange: [number, number];
  difficulty: 'easy' | 'medium' | 'hard';
  prerequisites: string[];
  description: string;
}

export interface DiagnosticTest {
  id: string;
  grade: number;
  subject: string;
  problems: {
    id: string;
    question: string;
    options: string[];
    correctAnswer: string;
    explanation: string;
    unit: string;
  }[];
}

// ìœ ì¹˜~ì¤‘í•™êµ ìˆ˜í•™ ì»¤ë¦¬í˜ëŸ¼ êµ¬ì¡°
export const curriculumUnits: CurriculumUnit[] = [
  // ìœ ì¹˜ì› (ëˆ„ë¦¬ê³¼ì •)
  {
    id: 'K1',
    title: 'ìˆ˜ ì„¸ê¸°ì™€ ë¹„êµ',
    grade: 0,
    subject: 'ìˆ˜ì™€ ì—°ì‚°',
    subSubject: 'ê¸°ì´ˆ ìˆ˜ ê°œë…',
    stageRange: [1, 5],
    difficulty: 'easy',
    prerequisites: [],
    description: '1~10ê¹Œì§€ì˜ ìˆ˜ ì„¸ê¸°ì™€ ë¹„êµí•˜ê¸°'
  },
  {
    id: 'K2',
    title: 'ê¸°ì´ˆ ë§ì…ˆÂ·ëº„ì…ˆ',
    grade: 0,
    subject: 'ìˆ˜ì™€ ì—°ì‚°',
    subSubject: 'ì‚¬ì¹™ì—°ì‚° ê¸°ì´ˆ',
    stageRange: [6, 10],
    difficulty: 'easy',
    prerequisites: ['K1'],
    description: '5ê¹Œì§€ì˜ ë§ì…ˆÂ·ëº„ì…ˆ ë†€ì´'
  },

  // 1í•™ë…„
  {
    id: 'G1-1',
    title: '100ê¹Œì§€ì˜ ìˆ˜',
    grade: 1,
    subject: 'ìˆ˜ì™€ ì—°ì‚°',
    subSubject: 'ìì—°ìˆ˜',
    stageRange: [11, 15],
    difficulty: 'easy',
    prerequisites: ['K1'],
    description: '100ê¹Œì§€ì˜ ìˆ˜ ì½ê¸°, ì“°ê¸°, í¬ê¸° ë¹„êµ'
  },
  {
    id: 'G1-2',
    title: 'í•œ ìë¦¬ ìˆ˜ ë§ì…ˆÂ·ëº„ì…ˆ',
    grade: 1,
    subject: 'ìˆ˜ì™€ ì—°ì‚°',
    subSubject: 'ì‚¬ì¹™ì—°ì‚°',
    stageRange: [16, 25],
    difficulty: 'easy',
    prerequisites: ['G1-1'],
    description: '9ê¹Œì§€ì˜ ë§ì…ˆÂ·ëº„ì…ˆ'
  },
  {
    id: 'G1-3',
    title: 'ë‘ ìë¦¬ ìˆ˜ ë§ì…ˆÂ·ëº„ì…ˆ',
    grade: 1,
    subject: 'ìˆ˜ì™€ ì—°ì‚°',
    subSubject: 'ì‚¬ì¹™ì—°ì‚°',
    stageRange: [26, 30],
    difficulty: 'medium',
    prerequisites: ['G1-2'],
    description: 'ë°›ì•„ì˜¬ë¦¼Â·ë°›ì•„ë‚´ë¦¼ ì—†ëŠ” ë§ì…ˆÂ·ëº„ì…ˆ'
  },

  // 2í•™ë…„
  {
    id: 'G2-1',
    title: 'ì„¸ ìë¦¬ ìˆ˜, ë„¤ ìë¦¬ ìˆ˜',
    grade: 2,
    subject: 'ìˆ˜ì™€ ì—°ì‚°',
    subSubject: 'ìì—°ìˆ˜',
    stageRange: [31, 35],
    difficulty: 'easy',
    prerequisites: ['G1-1'],
    description: '1000ê¹Œì§€ì˜ ìˆ˜ ì½ê¸°, ì“°ê¸°, í¬ê¸° ë¹„êµ'
  },
  {
    id: 'G2-2',
    title: 'ê³±ì…ˆêµ¬êµ¬',
    grade: 2,
    subject: 'ìˆ˜ì™€ ì—°ì‚°',
    subSubject: 'ì‚¬ì¹™ì—°ì‚°',
    stageRange: [36, 45],
    difficulty: 'medium',
    prerequisites: ['G1-2'],
    description: '2~9ë‹¨ ê³±ì…ˆêµ¬êµ¬'
  },
  {
    id: 'G2-3',
    title: 'ë‘ ìë¦¬ ìˆ˜ ê³±ì…ˆ',
    grade: 2,
    subject: 'ìˆ˜ì™€ ì—°ì‚°',
    subSubject: 'ì‚¬ì¹™ì—°ì‚°',
    stageRange: [46, 50],
    difficulty: 'hard',
    prerequisites: ['G2-2'],
    description: 'ë‘ ìë¦¬ ìˆ˜ Ã— í•œ ìë¦¬ ìˆ˜'
  },

  // 3í•™ë…„
  {
    id: 'G3-1',
    title: 'ë¶„ìˆ˜ì™€ ì†Œìˆ˜ ê¸°ì´ˆ',
    grade: 3,
    subject: 'ìˆ˜ì™€ ì—°ì‚°',
    subSubject: 'ë¶„ìˆ˜ì™€ ì†Œìˆ˜',
    stageRange: [51, 55],
    difficulty: 'medium',
    prerequisites: ['G2-1'],
    description: 'ë¶„ìˆ˜ì™€ ì†Œìˆ˜ì˜ ê°œë…ê³¼ ì½ê¸°, ì“°ê¸°'
  },
  {
    id: 'G3-2',
    title: 'ê³±ì…ˆê³¼ ë‚˜ëˆ—ì…ˆ',
    grade: 3,
    subject: 'ìˆ˜ì™€ ì—°ì‚°',
    subSubject: 'ì‚¬ì¹™ì—°ì‚°',
    stageRange: [56, 65],
    difficulty: 'medium',
    prerequisites: ['G2-3'],
    description: 'ì„¸ ìë¦¬ ìˆ˜ Ã— í•œ ìë¦¬ ìˆ˜, ì„¸ ìë¦¬ Ã· í•œ ìë¦¬'
  },
  {
    id: 'G3-3',
    title: 'ì•½ìˆ˜ì™€ ë°°ìˆ˜',
    grade: 3,
    subject: 'ìˆ˜ì™€ ì—°ì‚°',
    subSubject: 'ì•½ìˆ˜ì™€ ë°°ìˆ˜',
    stageRange: [66, 70],
    difficulty: 'hard',
    prerequisites: ['G3-2'],
    description: 'ì•½ìˆ˜ì™€ ë°°ìˆ˜ì˜ ê°œë…ê³¼ êµ¬í•˜ê¸°'
  },

  // 4í•™ë…„
  {
    id: 'G4-1',
    title: 'ë¶„ìˆ˜ì˜ ë§ì…ˆÂ·ëº„ì…ˆ',
    grade: 4,
    subject: 'ìˆ˜ì™€ ì—°ì‚°',
    subSubject: 'ë¶„ìˆ˜ì™€ ì†Œìˆ˜',
    stageRange: [71, 75],
    difficulty: 'medium',
    prerequisites: ['G3-1'],
    description: 'ë¶„ëª¨ê°€ ê°™ì€ ë¶„ìˆ˜ì˜ ë§ì…ˆÂ·ëº„ì…ˆ'
  },
  {
    id: 'G4-2',
    title: 'ë¶„ìˆ˜ì™€ ì†Œìˆ˜ì˜ ë§ì…ˆÂ·ëº„ì…ˆ',
    grade: 4,
    subject: 'ìˆ˜ì™€ ì—°ì‚°',
    subSubject: 'ë¶„ìˆ˜ì™€ ì†Œìˆ˜',
    stageRange: [76, 80],
    difficulty: 'hard',
    prerequisites: ['G4-1'],
    description: 'ë¶„ìˆ˜ì™€ ì†Œìˆ˜ì˜ í˜¼í•© ê³„ì‚°'
  },

  // 5í•™ë…„
  {
    id: 'G5-1',
    title: 'ë¶„ìˆ˜ì˜ ê³±ì…ˆ',
    grade: 5,
    subject: 'ìˆ˜ì™€ ì—°ì‚°',
    subSubject: 'ë¶„ìˆ˜ì™€ ì†Œìˆ˜',
    stageRange: [81, 85],
    difficulty: 'hard',
    prerequisites: ['G4-2'],
    description: 'ë¶„ìˆ˜ì˜ ê³±ì…ˆê³¼ ì•½ë¶„Â·í†µë¶„'
  },
  {
    id: 'G5-2',
    title: 'ì†Œìˆ˜ì˜ ê³±ì…ˆ',
    grade: 5,
    subject: 'ìˆ˜ì™€ ì—°ì‚°',
    subSubject: 'ë¶„ìˆ˜ì™€ ì†Œìˆ˜',
    stageRange: [86, 90],
    difficulty: 'hard',
    prerequisites: ['G5-1'],
    description: 'ì†Œìˆ˜ì˜ ê³±ì…ˆê³¼ ë‚˜ëˆ—ì…ˆ'
  },

  // 6í•™ë…„
  {
    id: 'G6-1',
    title: 'ë¶„ìˆ˜ì˜ ë‚˜ëˆ—ì…ˆ',
    grade: 6,
    subject: 'ìˆ˜ì™€ ì—°ì‚°',
    subSubject: 'ë¶„ìˆ˜ì™€ ì†Œìˆ˜',
    stageRange: [91, 95],
    difficulty: 'hard',
    prerequisites: ['G5-2'],
    description: 'ë¶„ìˆ˜ì˜ ë‚˜ëˆ—ì…ˆê³¼ ë¹„ì™€ ë¹„ìœ¨'
  },
  {
    id: 'G6-2',
    title: 'ë¹„ë¡€ì‹ê³¼ ë¹„ë¡€ë°°ë¶„',
    grade: 6,
    subject: 'ìˆ˜ì™€ ì—°ì‚°',
    subSubject: 'ë¹„ì™€ ë¹„ìœ¨',
    stageRange: [96, 100],
    difficulty: 'hard',
    prerequisites: ['G6-1'],
    description: 'ë¹„ë¡€ì‹ê³¼ ë¹„ë¡€ë°°ë¶„ ë¬¸ì œ'
  },

  // ì¤‘í•™êµ 1í•™ë…„
  {
    id: 'M1-1',
    title: 'ì •ìˆ˜ì™€ ìœ ë¦¬ìˆ˜',
    grade: 7,
    subject: 'ìˆ˜ì™€ ì—°ì‚°',
    subSubject: 'ì •ìˆ˜ì™€ ìœ ë¦¬ìˆ˜',
    stageRange: [101, 110],
    difficulty: 'hard',
    prerequisites: ['G6-2'],
    description: 'ì •ìˆ˜ì™€ ìœ ë¦¬ìˆ˜ì˜ ê°œë…ê³¼ ì‚¬ì¹™ì—°ì‚°'
  },
  {
    id: 'M1-2',
    title: 'ë¬¸ìì™€ ì‹',
    grade: 7,
    subject: 'ìˆ˜ì™€ ì—°ì‚°',
    subSubject: 'ë¬¸ìì™€ ì‹',
    stageRange: [111, 120],
    difficulty: 'hard',
    prerequisites: ['M1-1'],
    description: 'ì¼ì°¨ì‹ì˜ ê³„ì‚°ê³¼ í™œìš©'
  },

  // ì¤‘í•™êµ 2í•™ë…„
  {
    id: 'M2-1',
    title: 'ìœ ë¦¬ìˆ˜ì™€ ìˆœí™˜ì†Œìˆ˜',
    grade: 8,
    subject: 'ìˆ˜ì™€ ì—°ì‚°',
    subSubject: 'ìœ ë¦¬ìˆ˜ì™€ ìˆœí™˜ì†Œìˆ˜',
    stageRange: [121, 130],
    difficulty: 'hard',
    prerequisites: ['M1-2'],
    description: 'ìˆœí™˜ì†Œìˆ˜ì˜ ê°œë…ê³¼ ìœ ë¦¬ìˆ˜ë¡œì˜ ë³€í™˜'
  },
  {
    id: 'M2-2',
    title: 'ì¼ì°¨ë°©ì •ì‹',
    grade: 8,
    subject: 'ìˆ˜ì™€ ì—°ì‚°',
    subSubject: 'ë°©ì •ì‹',
    stageRange: [131, 140],
    difficulty: 'hard',
    prerequisites: ['M2-1'],
    description: 'ì¼ì°¨ë°©ì •ì‹ì˜ í’€ì´ì™€ í™œìš©'
  },

  // ì¤‘í•™êµ 3í•™ë…„
  {
    id: 'M3-1',
    title: 'ë‹¤í•­ì‹',
    grade: 9,
    subject: 'ìˆ˜ì™€ ì—°ì‚°',
    subSubject: 'ë‹¤í•­ì‹',
    stageRange: [141, 150],
    difficulty: 'hard',
    prerequisites: ['M2-2'],
    description: 'ë‹¤í•­ì‹ì˜ ë§ì…ˆ, ëº„ì…ˆ, ê³±ì…ˆ'
  },
  {
    id: 'M3-2',
    title: 'ì¸ìˆ˜ë¶„í•´',
    grade: 9,
    subject: 'ìˆ˜ì™€ ì—°ì‚°',
    subSubject: 'ë‹¤í•­ì‹',
    stageRange: [151, 160],
    difficulty: 'hard',
    prerequisites: ['M3-1'],
    description: 'ì¸ìˆ˜ë¶„í•´ì˜ ê¸°ë³¸ ê³µì‹ê³¼ í™œìš©'
  },
  // ì‚¬ê³ ë ¥ ì—°ì‚° 4í•™ë…„
  {
    id: 'T4-1',
    title: 'ë…¼ë¦¬ì  ì‚¬ê³ ',
    grade: 4,
    subject: 'ì‚¬ê³ ë ¥ ì—°ì‚°',
    subSubject: 'ë…¼ë¦¬ì  ì¶”ë¡ ',
    stageRange: [161, 168],
    difficulty: 'medium',
    prerequisites: ['E4-3'],
    description: 'ë…¼ë¦¬ì  ì‚¬ê³ ì™€ ë¬¸ì œ í•´ê²°'
  },
  // ì‚¬ê³ ë ¥ ì—°ì‚° 5í•™ë…„
  {
    id: 'T5-1',
    title: 'ì°½ì˜ì  ì‚¬ê³ ',
    grade: 5,
    subject: 'ì‚¬ê³ ë ¥ ì—°ì‚°',
    subSubject: 'ì°½ì˜ì  ì¶”ë¡ ',
    stageRange: [169, 176],
    difficulty: 'hard',
    prerequisites: ['E5-3'],
    description: 'ì°½ì˜ì  ì‚¬ê³ ì™€ ì¶”ë¡ '
  },
  // ì‚¬ê³ ë ¥ ì—°ì‚° 6í•™ë…„
  {
    id: 'T6-1',
    title: 'ë¹„íŒì  ì‚¬ê³ ',
    grade: 6,
    subject: 'ì‚¬ê³ ë ¥ ì—°ì‚°',
    subSubject: 'ë¹„íŒì  ë¶„ì„',
    stageRange: [177, 183],
    difficulty: 'hard',
    prerequisites: ['E6-3'],
    description: 'ë¹„íŒì  ì‚¬ê³ ì™€ ì¢…í•© ë¶„ì„'
  }
];

// ì§„ë‹¨ í…ŒìŠ¤íŠ¸ ë°ì´í„°
export const diagnosticTests: DiagnosticTest[] = [
  {
    id: 'diagnostic-grade-1',
    grade: 1,
    subject: 'ìˆ˜ì™€ ì—°ì‚°',
    problems: [
      {
        id: 'd1-1',
        question: 'ë‹¤ìŒ ì¤‘ ê°€ì¥ í° ìˆ˜ëŠ”?',
        options: ['15', '25', '35', '45'],
        correctAnswer: '45',
        explanation: '45ê°€ ê°€ì¥ í° ìˆ˜ì…ë‹ˆë‹¤.',
        unit: 'G1-1'
      },
      {
        id: 'd1-2',
        question: '7 + 3 = ?',
        options: ['8', '9', '10', '11'],
        correctAnswer: '10',
        explanation: '7 + 3 = 10ì…ë‹ˆë‹¤.',
        unit: 'G1-2'
      },
      {
        id: 'd1-3',
        question: '12 - 5 = ?',
        options: ['6', '7', '8', '9'],
        correctAnswer: '7',
        explanation: '12 - 5 = 7ì…ë‹ˆë‹¤.',
        unit: 'G1-2'
      }
    ]
  },
  {
    id: 'diagnostic-grade-2',
    grade: 2,
    subject: 'ìˆ˜ì™€ ì—°ì‚°',
    problems: [
      {
        id: 'd2-1',
        question: '3 Ã— 4 = ?',
        options: ['10', '11', '12', '13'],
        correctAnswer: '12',
        explanation: '3 Ã— 4 = 12ì…ë‹ˆë‹¤.',
        unit: 'G2-2'
      },
      {
        id: 'd2-2',
        question: '24 Ã· 6 = ?',
        options: ['3', '4', '5', '6'],
        correctAnswer: '4',
        explanation: '24 Ã· 6 = 4ì…ë‹ˆë‹¤.',
        unit: 'G2-2'
      },
      {
        id: 'd2-3',
        question: '15 + 27 = ?',
        options: ['40', '41', '42', '43'],
        correctAnswer: '42',
        explanation: '15 + 27 = 42ì…ë‹ˆë‹¤.',
        unit: 'G1-3'
      }
    ]
  },
  {
    id: 'diagnostic-grade-3',
    grade: 3,
    subject: 'ìˆ˜ì™€ ì—°ì‚°',
    problems: [
      {
        id: 'd3-1',
        question: '1/2 + 1/2 = ?',
        options: ['1/4', '1/2', '1', '2'],
        correctAnswer: '1',
        explanation: '1/2 + 1/2 = 2/2 = 1ì…ë‹ˆë‹¤.',
        unit: 'G3-1'
      },
      {
        id: 'd3-2',
        question: '0.5 + 0.3 = ?',
        options: ['0.7', '0.8', '0.9', '1.0'],
        correctAnswer: '0.8',
        explanation: '0.5 + 0.3 = 0.8ì…ë‹ˆë‹¤.',
        unit: 'G3-1'
      },
      {
        id: 'd3-3',
        question: '6 Ã— 7 = ?',
        options: ['40', '41', '42', '43'],
        correctAnswer: '42',
        explanation: '6 Ã— 7 = 42ì…ë‹ˆë‹¤.',
        unit: 'G2-2'
      }
    ]
  }
];

// Advanced, curriculum-aware problem generator (K-6)
// Author: ChatGPT (for TimeEdu)
// ëª©í‘œ: ë‹¨ìˆœ ì•”ê¸°í˜• ë¬¸í•­ì´ ì•„ë‹Œ ì‚¬ê³  ì´‰ë°œí˜•(ì˜¤ê°œë… ìœ ë„ ì§€ë¬¸, ë‹¤ë‹¨ê³„ ì¶”ë¡ , ì˜¤ë¥˜ ë¶„ì„, ë¹„êµ/ì¼ë°˜í™” ë“±)

/********************
 * Types
 ********************/
export type Bloom = "Remember" | "Understand" | "Apply" | "Analyze" | "Evaluate" | "Create";
export type ProblemFormat = "MCQ" | "MultiSelect" | "Short" | "Ordering" | "Matching";

export interface Choice {
  id: string; // "â‘ ", "â‘¡" ë“± ë³´ê¸° ë¼ë²¨
  text: string; // ë³´ê¸° í…ìŠ¤íŠ¸
  isCorrect: boolean;
  rationale?: string; // ì„ íƒì§€ì— ëŒ€í•œ í•´ì„¤(ì˜¤ê°œë… ê·¼ê±° í¬í•¨)
}

export interface Problem {
  id: string; // e.g., "STAGE-001"
  gradeBand: string; // e.g., "Kindergarten", "G1" â€¦ "G6"
  stageId: number;
  format: ProblemFormat;
  difficulty: 1 | 2 | 3 | 4 | 5;
  blooms: Bloom;
  skills: string[]; // e.g., ["ìˆ˜ì™€ ì—°ì‚°", "ìë¦¿ê°’", "ë¶„ìˆ˜ì˜ ì˜ë¯¸"]
  tags: string[]; // ê²€ìƒ‰/ì¶”ì²œìš© íƒœê·¸
  stem: string; // ë¬¸ì œ ë³¸ë¬¸
  choices?: Choice[]; // MCQ/MultiSelectì—ì„œ ì‚¬ìš©
  answer: string | string[]; // ì •ë‹µ(ë©€í‹°ì…€ë ‰íŠ¸ë©´ ë°°ì—´)
  solution: string; // í’€ì´/ê·¼ê±°
  data?: Record<string, any>; // ì‹œê°í™”/ì¡°ì‘í˜•ì„ ìœ„í•œ ì¶”ê°€ ë°ì´í„°(íŒ¨í„´, ì´ë¯¸ì§€ í‘œê¸° ë“±)
}

/********************
 * Utilities
 ********************/
function rng(seed: number) {
  // ì„ í˜•í•©ë™ ìƒì„±ê¸°(LCG) - ì¬í˜„ì„± ë³´ì¥
  let s = seed >>> 0;
  return () => (s = (s * 1664525 + 1013904223) >>> 0) / 0xffffffff;
}

function pick<T>(rand: () => number, arr: T[]): T {
  return arr[Math.floor(rand() * arr.length)];
}

function shuffle<T>(rand: () => number, arr: T[]): T[] {
  const a = arr.slice();
  for (let i = a.length - 1; i > 0; i--) {
    const j = Math.floor(rand() * (i + 1));
    [a[i], a[j]] = [a[j], a[i]];
  }
  return a;
}

function toChoiceLabel(i: number): string {
  const map = ["â‘ ", "â‘¡", "â‘¢", "â‘£", "â‘¤", "â‘¥"];
  return map[i] || String(i + 1);
}

function ensureUnique<T>(arr: T[]): T[] {
  return Array.from(new Set(arr.map(v => JSON.stringify(v)))).map(v => JSON.parse(v));
}

/********************
 * Game-style problem generators by grade
 ********************/

// ğŸ® ê²Œì„í˜• ë¬¸ì œ ì¸í„°í˜ì´ìŠ¤
export interface GameProblem {
  id: string;
  gradeBand: string;
  stageId: number;
  format: ProblemFormat;
  difficulty: 1 | 2 | 3 | 4 | 5;
  blooms: Bloom;
  skills: string[];
  tags: string[];
  stem: string; // ë¬¸ì œ ë³¸ë¬¸
  choices?: Choice[];
  answer: string | string[];
  solution: string; // í’€ì´/ê·¼ê±°
  gameContext: {
    theme: string; // ê²Œì„ í…Œë§ˆ (ëª¬ìŠ¤í„°, ë§ˆë²•, ë˜ì „ ë“±)
    reward: string; // ê²Œì„ ë³´ìƒ
    visual: string; // ì‹œê°ì  ìš”ì†Œ
  };
  data?: Record<string, any>;
}

// ğŸ–¼ï¸ ì´ë¯¸ì§€ ê¸°ë°˜ ë¬¸ì œ ì¸í„°í˜ì´ìŠ¤
export interface ImageProblem {
  id: string;
  gradeBand: string;
  stageId: number;
  format: ProblemFormat;
  difficulty: 1 | 2 | 3 | 4 | 5;
  blooms: Bloom;
  skills: string[];
  tags: string[];
  stem: string; // ë¬¸ì œ ë³¸ë¬¸
  choices?: Choice[];
  answer: string | string[];
  solution: string; // í’€ì´/ê·¼ê±°
  images: {
    items: ImageItem[]; // ë¬¸ì œì— ì‚¬ìš©ë  ì´ë¯¸ì§€ë“¤
    background?: string; // ë°°ê²½ ì´ë¯¸ì§€
    layout: 'grid' | 'row' | 'scattered' | 'custom'; // ì´ë¯¸ì§€ ë°°ì¹˜ ë°©ì‹
  };
  gameContext: {
    theme: string;
    reward: string;
    visual: string;
  };
  data?: Record<string, any>;
}

// ğŸ–¼ï¸ ì´ë¯¸ì§€ ì•„ì´í…œ ì¸í„°í˜ì´ìŠ¤
export interface ImageItem {
  src: string; // ì´ë¯¸ì§€ ê²½ë¡œ
  alt: string; // ëŒ€ì²´ í…ìŠ¤íŠ¸
  count: number; // ê°œìˆ˜
  position?: { x: number; y: number }; // ìœ„ì¹˜ (scattered ë ˆì´ì•„ì›ƒìš©)
  size?: 'small' | 'medium' | 'large'; // í¬ê¸°
  animation?: 'none' | 'bounce' | 'pulse' | 'fade'; // ì• ë‹ˆë©”ì´ì…˜
}

// ğŸ–¼ï¸ ì´ë¯¸ì§€ ì•„ì´í…œ íƒ€ì…
interface ImageMappingItem {
  src: string;
  alt: string;
  emoji: string;
}

// ğŸ–¼ï¸ ì´ë¯¸ì§€ ë§¤í•‘ ë°ì´í„°
export const imageMapping: {
  [key: string]: ImageMappingItem | { [key: string]: string };
  balloon: ImageMappingItem;
  star: ImageMappingItem;
  apple: ImageMappingItem;
  flower: ImageMappingItem;
  heart: ImageMappingItem;
  pizza: ImageMappingItem;
  cake: ImageMappingItem;
  candy: ImageMappingItem;
  magicGem: ImageMappingItem;
  potion: ImageMappingItem;
  redGem: ImageMappingItem;
  blueGem: ImageMappingItem;
  diamond: ImageMappingItem;
  emerald: ImageMappingItem;
  hero: ImageMappingItem;
  wizard: ImageMappingItem;
  archer: ImageMappingItem;
  monster: ImageMappingItem;
  dragon: ImageMappingItem;
  wolf: ImageMappingItem;
  backgrounds: {
    forest: string;
    castle: string;
    dungeon: string;
    magicLab: string;
    party: string;
  };
} = {
  // ê¸°ë³¸ ì•„ì´í…œë“¤
  balloon: {
    src: '/images/items/balloon.png',
    alt: 'í’ì„ ',
    emoji: 'ğŸˆ'
  },
  star: {
    src: '/images/items/star.png',
    alt: 'ë³„',
    emoji: 'â­'
  },
  apple: {
    src: '/images/items/apple.png',
    alt: 'ì‚¬ê³¼',
    emoji: 'ğŸ'
  },
  flower: {
    src: '/images/items/flower.png',
    alt: 'ê½ƒ',
    emoji: 'ğŸŒ¸'
  },
  heart: {
    src: '/images/items/heart.png',
    alt: 'í•˜íŠ¸',
    emoji: 'â¤ï¸'
  },
  // ìŒì‹ ì•„ì´í…œë“¤
  pizza: {
    src: '/images/items/pizza.png',
    alt: 'í”¼ì',
    emoji: 'ğŸ•'
  },
  cake: {
    src: '/images/items/cake.png',
    alt: 'ì¼€ì´í¬',
    emoji: 'ğŸ‚'
  },
  candy: {
    src: '/images/items/candy.png',
    alt: 'ì‚¬íƒ•',
    emoji: 'ğŸ­'
  },
  // ë§ˆë²• ì•„ì´í…œë“¤
  magicGem: {
    src: '/images/items/magic-gem.png',
    alt: 'ë§ˆë²• êµ¬ìŠ¬',
    emoji: 'ğŸ’'
  },
  potion: {
    src: '/images/items/potion.png',
    alt: 'í¬ì…˜',
    emoji: 'ğŸ§ª'
  },
  redGem: {
    src: '/images/items/red-gem.png',
    alt: 'ë¹¨ê°„ êµ¬ìŠ¬',
    emoji: 'ğŸ”´'
  },
  blueGem: {
    src: '/images/items/blue-gem.png',
    alt: 'íŒŒë€ êµ¬ìŠ¬',
    emoji: 'ğŸ”µ'
  },
  diamond: {
    src: '/images/items/diamond.png',
    alt: 'ë‹¤ì´ì•„ëª¬ë“œ',
    emoji: 'ğŸ’'
  },
  emerald: {
    src: '/images/items/emerald.png',
    alt: 'ì—ë©”ë„ë“œ',
    emoji: 'ğŸ’'
  },
  // ê²Œì„ ìºë¦­í„°ë“¤
  hero: {
    src: '/images/characters/hero.png',
    alt: 'ìš©ì‚¬',
    emoji: 'âš”ï¸'
  },
  wizard: {
    src: '/images/characters/wizard.png',
    alt: 'ë§ˆë²•ì‚¬',
    emoji: 'ğŸ§™â€â™‚ï¸'
  },
  archer: {
    src: '/images/characters/archer.png',
    alt: 'ê¶ìˆ˜',
    emoji: 'ğŸ¹'
  },
  monster: {
    src: '/images/characters/monster.png',
    alt: 'ëª¬ìŠ¤í„°',
    emoji: 'ğŸ‘¹'
  },
  dragon: {
    src: '/images/characters/dragon.png',
    alt: 'ë“œë˜ê³¤',
    emoji: 'ğŸ‰'
  },
  wolf: {
    src: '/images/characters/wolf.png',
    alt: 'ëŠ‘ëŒ€',
    emoji: 'ğŸº'
  },
  // ë°°ê²½ ì´ë¯¸ì§€ë“¤
  backgrounds: {
    forest: '/images/backgrounds/forest.png',
    castle: '/images/backgrounds/castle.png',
    dungeon: '/images/backgrounds/dungeon.png',
    magicLab: '/images/backgrounds/magic-lab.png',
    party: '/images/backgrounds/party.png'
  }
};

/********************
 * Image-based problem generators
 ********************/

// ğŸ–¼ï¸ ì´ë¯¸ì§€ ê¸°ë°˜ ë¬¸ì œ ìƒì„± í—¬í¼ í•¨ìˆ˜
function createImageItems(itemType: string, count: number, size: 'small' | 'medium' | 'large' = 'medium'): ImageItem[] {
  const item = imageMapping[itemType] as ImageMappingItem;
  if (!item || !item.src) {
    // fallback to emoji if image not found
    return Array.from({ length: count }, () => ({
      src: '',
      alt: itemType,
      count: 1,
      size,
      animation: 'none' as const
    }));
  }
  
  return Array.from({ length: count }, () => ({
    src: item.src,
    alt: item.alt,
    count: 1,
    size,
    animation: 'none' as const
  }));
}

// ğŸ–¼ï¸ ì´ë¯¸ì§€ ê¸°ë°˜ ë¬¸ì œ ìƒì„± í—¬í¼ í•¨ìˆ˜ (scattered ë ˆì´ì•„ì›ƒ)
function createScatteredImageItems(itemType: string, count: number, containerWidth: number = 400, containerHeight: number = 300): ImageItem[] {
  const item = imageMapping[itemType] as ImageMappingItem;
  if (!item || !item.src) {
    // fallback to emoji if image not found
    return Array.from({ length: count }, () => ({
      src: '',
      alt: itemType,
      count: 1,
      size: 'medium' as const,
      position: {
        x: Math.random() * (containerWidth - 50),
        y: Math.random() * (containerHeight - 50)
      },
      animation: 'bounce' as const
    }));
  }
  
  return Array.from({ length: count }, () => ({
    src: item.src,
    alt: item.alt,
    count: 1,
    size: 'medium' as const,
    position: {
      x: Math.random() * (containerWidth - 50),
      y: Math.random() * (containerHeight - 50)
    },
    animation: 'bounce' as const
  }));
}

// ğŸŸ¢ ì´ˆë“±í•™êµ 1í•™ë…„ ì´ë¯¸ì§€ ê¸°ë°˜ ë¬¸ì œ (100ê¹Œì§€ ìˆ˜, ë§ì…ˆÂ·ëº„ì…ˆ ê¸°ì´ˆ)
function genG1_ImageProblems(seed: number, stageId: number): ImageProblem {
  const rand = rng(seed);
  const themes = [
    { theme: "í’ì„  í„°ëœ¨ë¦¬ê¸°", itemType: "balloon", action: "í„°ì¡Œì–´", background: "party" },
    { theme: "ë³„ ëª¨ìœ¼ê¸°", itemType: "star", action: "ë–¨ì–´ì¡Œì–´", background: "forest" },
    { theme: "ì‚¬ê³¼ ë”°ê¸°", itemType: "apple", action: "ë–¨ì–´ì¡Œì–´", background: "forest" },
    { theme: "ê½ƒì ë‚ ë¦¬ê¸°", itemType: "flower", action: "ë‚ ì•„ê°”ì–´", background: "forest" }
  ];
  
  const selectedTheme = pick(rand, themes);
  const total = Math.floor(rand() * 8) + 3; // 3~10
  const lost = Math.floor(rand() * (total - 1)) + 1; // 1~(total-1)
  const remaining = total - lost;
  
  const wrong1 = remaining - 1;
  const wrong2 = remaining + 1;
  const wrong3 = total; // ì›ë˜ ê°œìˆ˜ (ì˜¤ê°œë…)
  
  const choices: Choice[] = shuffle(rand, [
    { id: "â‘ ", text: `${remaining}ê°œ`, isCorrect: true, rationale: `ì •í™•í•œ ê³„ì‚°: ${total} - ${lost} = ${remaining}` },
    { id: "â‘¡", text: `${wrong1}ê°œ`, isCorrect: false, rationale: "í•œ ê°œ ëœ ê³„ì‚°í•œ ì‹¤ìˆ˜" },
    { id: "â‘¢", text: `${wrong2}ê°œ`, isCorrect: false, rationale: "í•œ ê°œ ë” ê³„ì‚°í•œ ì‹¤ìˆ˜" },
    { id: "â‘£", text: `${wrong3}ê°œ`, isCorrect: false, rationale: "ë¹¼ê¸°ë¥¼ í•˜ì§€ ì•Šì€ ì‹¤ìˆ˜" }
  ]);

  return {
    id: `IMAGE-STAGE-${stageId}`,
    gradeBand: "G1",
    stageId,
    format: "MCQ",
    difficulty: 1,
    blooms: "Apply",
    skills: ["ê¸°ë³¸ ë§ì…ˆÂ·ëº„ì…ˆ", "ìƒí™© ì´í•´"],
    tags: ["ì´ë¯¸ì§€", "ìœ ì•„", "ê¸°ì´ˆì—°ì‚°"],
    stem: `${selectedTheme.theme}ì—ì„œ ${total}ê°œê°€ ìˆì—ˆëŠ”ë°, ${lost}ê°œê°€ ${selectedTheme.action}! ë‚¨ì€ ${selectedTheme.theme}ì€ ëª‡ ê°œì¼ê¹Œ?`,
    choices,
    answer: choices.find(c => c.isCorrect)!.id,
    solution: `${total} - ${lost} = ${remaining}ê°œê°€ ë‚¨ì•˜ìŠµë‹ˆë‹¤!`,
    images: {
      items: createScatteredImageItems(selectedTheme.itemType, total, 400, 300),
      background: imageMapping.backgrounds[selectedTheme.background as keyof typeof imageMapping.backgrounds],
      layout: 'scattered'
    },
    gameContext: {
      theme: selectedTheme.theme,
      reward: `${remaining}ê°œì˜ ${(imageMapping[selectedTheme.itemType] as ImageMappingItem).alt} íšë“!`,
      visual: `${(imageMapping[selectedTheme.itemType] as ImageMappingItem).alt}ì´ í•˜ë‚˜ì”© 'í‘!' í•˜ê³  ì‚¬ë¼ì§€ëŠ” ì• ë‹ˆë©”ì´ì…˜`
    }
  };
}

// ğŸ”µ ì´ˆë“±í•™êµ 2í•™ë…„ ì´ë¯¸ì§€ ê¸°ë°˜ ë¬¸ì œ (ì„¸Â·ë„¤ ìë¦¬ ìˆ˜, ê³±ì…ˆêµ¬êµ¬)
function genG2_ImageProblems(seed: number, stageId: number): ImageProblem {
  const rand = rng(seed);
  const themes = [
    { theme: "ìš©ì‚¬ ëª¨í—˜", character: "hero", monster: "monster", action: "ê³µê²©ë ¥", background: "dungeon" },
    { theme: "ë§ˆë²•ì‚¬ í€˜ìŠ¤íŠ¸", character: "wizard", monster: "dragon", action: "ë§ˆë²•ë ¥", background: "castle" },
    { theme: "ê¶ìˆ˜ ì‚¬ëƒ¥", character: "archer", monster: "wolf", action: "í™”ì‚´ë ¥", background: "forest" }
  ];
  
  const selectedTheme = pick(rand, themes);
  const multiplier1 = Math.floor(rand() * 8) + 2; // 2~9
  const multiplier2 = Math.floor(rand() * 8) + 2; // 2~9
  const correct = multiplier1 * multiplier2;
  
  const wrong1 = correct - multiplier1; // í•œ ë‹¨ê³„ ëœ ê³±í•¨
  const wrong2 = correct + multiplier1; // í•œ ë‹¨ê³„ ë” ê³±í•¨
  const wrong3 = multiplier1 + multiplier2; // ë”í•˜ê¸°ë¡œ ì°©ê°
  
  const choices: Choice[] = shuffle(rand, [
    { id: "â‘ ", text: `${correct}`, isCorrect: true, rationale: `ì •í™•í•œ ê³±ì…ˆ: ${multiplier1} Ã— ${multiplier2} = ${correct}` },
    { id: "â‘¡", text: `${wrong1}`, isCorrect: false, rationale: "ê³±ì…ˆì„ ë§ì…ˆìœ¼ë¡œ ì°©ê°" },
    { id: "â‘¢", text: `${wrong2}`, isCorrect: false, rationale: "ê³„ì‚° ì‹¤ìˆ˜" },
    { id: "â‘£", text: `${wrong3}`, isCorrect: false, rationale: "ê³±ì…ˆì„ ë§ì…ˆìœ¼ë¡œ ì°©ê°" }
  ]);

  return {
    id: `IMAGE-STAGE-${stageId}`,
    gradeBand: "G2",
    stageId,
    format: "MCQ",
    difficulty: 2,
    blooms: "Apply",
    skills: ["ê³±ì…ˆêµ¬êµ¬", "ìƒí™© ì´í•´"],
    tags: ["ì´ë¯¸ì§€", "ëª¨í—˜", "ê³±ì…ˆ"],
    stem: `${(imageMapping[selectedTheme.character] as ImageMappingItem).alt}ê°€ ${(imageMapping[selectedTheme.monster] as ImageMappingItem).alt}ì—ê²Œ ${multiplier1}Ã—${multiplier2}ì˜ ${selectedTheme.action}ì„ ë‚ ë ¤ì•¼ í•´! ${selectedTheme.action}ì€ ì–¼ë§ˆì¼ê¹Œ?`,
    choices,
    answer: choices.find(c => c.isCorrect)!.id,
    solution: `${multiplier1} Ã— ${multiplier2} = ${correct}ì…ë‹ˆë‹¤!`,
    images: {
      items: [
        ...createImageItems(selectedTheme.character, 1, 'large'),
        ...createImageItems(selectedTheme.monster, 1, 'large')
      ],
      background: imageMapping.backgrounds[selectedTheme.background as keyof typeof imageMapping.backgrounds],
      layout: 'row'
    },
    gameContext: {
      theme: selectedTheme.theme,
      reward: `ëª¬ìŠ¤í„° HPê°€ ${correct}ë§Œí¼ ê¹ì„!`,
      visual: `${(imageMapping[selectedTheme.character] as ImageMappingItem).alt}ê°€ ${selectedTheme.action}ì„ ë°œì‚¬í•˜ëŠ” ëª¨ì…˜`
    }
  };
}

// ğŸŒ¿ ì´ˆë“±í•™êµ 3í•™ë…„ ì´ë¯¸ì§€ ê¸°ë°˜ ë¬¸ì œ (ë¶„ìˆ˜Â·ì†Œìˆ˜, ê³±ì…ˆÂ·ë‚˜ëˆ—ì…ˆ)
function genG3_ImageProblems(seed: number, stageId: number): ImageProblem {
  const rand = rng(seed);
  const themes = [
    { theme: "í”¼ì íŒŒí‹°", item: "pizza", action: "ë‚˜ëˆ„ì–´ ë¨¹ê¸°", background: "party" },
    { theme: "ì¼€ì´í¬ íŒŒí‹°", item: "cake", action: "ë‚˜ëˆ„ì–´ ë¨¹ê¸°", background: "party" },
    { theme: "ì‚¬íƒ• ë‚˜ëˆ„ê¸°", item: "candy", action: "ë‚˜ëˆ„ì–´ ì£¼ê¸°", background: "party" }
  ];
  
  const selectedTheme = pick(rand, themes);
  const totalPieces = Math.floor(rand() * 3) + 4; // 4~6ì¡°ê°
  const eaten = Math.floor(rand() * (totalPieces - 1)) + 1; // 1~(totalPieces-1)
  const fraction = `${eaten}/${totalPieces}`;
  
  const wrong1 = `${eaten - 1}/${totalPieces}`;
  const wrong2 = `${eaten + 1}/${totalPieces}`;
  const wrong3 = `${eaten}/${totalPieces - 1}`;
  
  const choices: Choice[] = shuffle(rand, [
    { id: "â‘ ", text: fraction, isCorrect: true, rationale: `${totalPieces}ì¡°ê° ì¤‘ ${eaten}ì¡°ê°ì„ ë¨¹ì—ˆìœ¼ë¯€ë¡œ ${fraction}` },
    { id: "â‘¡", text: wrong1, isCorrect: false, rationale: "í•œ ì¡°ê° ëœ ë¨¹ì€ ê²ƒìœ¼ë¡œ ê³„ì‚°" },
    { id: "â‘¢", text: wrong2, isCorrect: false, rationale: "í•œ ì¡°ê° ë” ë¨¹ì€ ê²ƒìœ¼ë¡œ ê³„ì‚°" },
    { id: "â‘£", text: wrong3, isCorrect: false, rationale: "ì „ì²´ ì¡°ê° ìˆ˜ë¥¼ ì˜ëª» ê³„ì‚°" }
  ]);

  return {
    id: `IMAGE-STAGE-${stageId}`,
    gradeBand: "G3",
    stageId,
    format: "MCQ",
    difficulty: 2,
    blooms: "Understand",
    skills: ["ë¶„ìˆ˜ì˜ ì˜ë¯¸", "ì¼ë¶€-ì „ì²´ ê´€ê³„"],
    tags: ["ì´ë¯¸ì§€", "íŒŒí‹°", "ë¶„ìˆ˜"],
    stem: `${(imageMapping[selectedTheme.item] as ImageMappingItem).alt} 1íŒì„ ${totalPieces}ì¡°ê°ìœ¼ë¡œ ë‚˜ëˆ„ì—ˆì–´. ê·¸ ì¤‘ ${eaten}ì¡°ê°ì„ ë¨¹ìœ¼ë©´ ëª‡ ë¶„ì˜ ëª‡ì¼ê¹Œ?`,
    choices,
    answer: choices.find(c => c.isCorrect)!.id,
    solution: `${totalPieces}ì¡°ê° ì¤‘ ${eaten}ì¡°ê° â†’ ${fraction}`,
    images: {
      items: createImageItems(selectedTheme.item, totalPieces, 'medium'),
      background: imageMapping.backgrounds[selectedTheme.background as keyof typeof imageMapping.backgrounds],
      layout: 'grid'
    },
    gameContext: {
      theme: selectedTheme.theme,
      reward: `${(imageMapping[selectedTheme.item] as ImageMappingItem).alt}ë¥¼ ë¨¹ê³  ì²´ë ¥ì´ íšŒë³µë¨!`,
      visual: `${(imageMapping[selectedTheme.item] as ImageMappingItem).alt}ê°€ ì¡°ê°ë³„ë¡œ ë‚˜ë‰˜ì–´ì§€ëŠ” ì• ë‹ˆë©”ì´ì…˜`
    }
  };
}

// ğŸŸ¢ ì´ˆë“±í•™êµ 1í•™ë…„ ê³ í’ˆì§ˆ ë¬¸ì œ (100ê¹Œì§€ ìˆ˜, ë§ì…ˆÂ·ëº„ì…ˆ ê¸°ì´ˆ)
function genG1_GameProblems(seed: number, stageId: number): ImageProblem {
  const rand = rng(seed);
  
  // ì‹¤ì œ êµì¬ ìˆ˜ì¤€ì˜ ë¬¸ì œ ìœ í˜•ë“¤
  const problemTypes = [
    {
      type: "ê°œìˆ˜ ì„¸ê¸°",
      context: "í•™êµì—ì„œ ì¹œêµ¬ë“¤ê³¼ í•¨ê»˜ ê³¼ì¼ ë‚˜ëˆ„ê¸°",
      characters: ["ë¯¼ìˆ˜", "ì§€ì˜", "ì² ìˆ˜", "ì„ ìƒë‹˜"],
      setting: "êµì‹¤",
      background: "êµì‹¤ì—ì„œ ê³¼ì¼ì„ ë‚˜ëˆ„ì–´ ë¨¹ëŠ” ìƒí™©"
    },
    {
      type: "ë§ì…ˆ",
      context: "ë†€ì´í„°ì—ì„œ ì¹œêµ¬ë“¤ê³¼ í•¨ê»˜ ë†€ê¸°",
      characters: ["ë¯¼ìˆ˜", "ì§€ì˜", "ì² ìˆ˜"],
      setting: "ë†€ì´í„°",
      background: "ë†€ì´í„°ì—ì„œ ì¹œêµ¬ë“¤ê³¼ í•¨ê»˜ ë†€ë©° ìˆ˜ë¥¼ ì„¸ëŠ” ìƒí™©"
    },
    {
      type: "ëº„ì…ˆ",
      context: "ì§‘ì—ì„œ ì¥ë‚œê° ì •ë¦¬í•˜ê¸°",
      characters: ["ë¯¼ìˆ˜", "ì—„ë§ˆ"],
      setting: "ì§‘",
      background: "ì§‘ì—ì„œ ì¥ë‚œê°ì„ ì •ë¦¬í•˜ë©° ìˆ˜ë¥¼ ì„¸ëŠ” ìƒí™©"
    },
    {
      type: "ìˆ˜ ë¹„êµ",
      context: "í•™êµì—ì„œ ì¹œêµ¬ë“¤ê³¼ í‚¤ ë¹„êµí•˜ê¸°",
      characters: ["ë¯¼ìˆ˜", "ì§€ì˜", "ì² ìˆ˜"],
      setting: "êµì‹¤",
      background: "êµì‹¤ì—ì„œ ì¹œêµ¬ë“¤ê³¼ í‚¤ë¥¼ ë¹„êµí•˜ëŠ” ìƒí™©"
    }
  ];
  
  const selectedType = pick(rand, problemTypes);
  
  let stem = "";
  let choices: Choice[] = [];
  let correctAnswer = "";
  let solution = "";
  
  switch (selectedType.type) {
    case "ê°œìˆ˜ ì„¸ê¸°":
      const totalItems = Math.floor(rand() * 8) + 3; // 3~10
      stem = `êµì‹¤ì—ì„œ ì„ ìƒë‹˜ì´ ì‚¬ê³¼ë¥¼ ê°€ì ¸ì˜¤ì…¨ì–´ìš”. ë¯¼ìˆ˜ ì•ì— ${totalItems}ê°œì˜ ì‚¬ê³¼ê°€ ë†“ì—¬ ìˆìŠµë‹ˆë‹¤. ì‚¬ê³¼ëŠ” ëª¨ë‘ ëª‡ ê°œì¼ê¹Œìš”?`;
      
      const countOptions = [
        `${totalItems}ê°œ`,
        `${totalItems + 1}ê°œ`,
        `${totalItems - 1}ê°œ`,
        `${totalItems + 2}ê°œ`
      ];
      
      choices = shuffle(rand, [
        { id: "â‘ ", text: countOptions[0], isCorrect: true, rationale: "ì •í™•íˆ ì„¸ì–´ì„œ ë‹µí•¨" },
        { id: "â‘¡", text: countOptions[1], isCorrect: false, rationale: "í•˜ë‚˜ ë” ì„¸ì–´ì„œ ì˜ëª» ê³„ì‚°" },
        { id: "â‘¢", text: countOptions[2], isCorrect: false, rationale: "í•˜ë‚˜ ëœ ì„¸ì–´ì„œ ì˜ëª» ê³„ì‚°" },
        { id: "â‘£", text: countOptions[3], isCorrect: false, rationale: "ë‘ ê°œ ë” ì„¸ì–´ì„œ ì˜ëª» ê³„ì‚°" }
      ]);
      correctAnswer = choices.find(c => c.isCorrect)!.id;
      solution = `ì‚¬ê³¼ë¥¼ í•˜ë‚˜ì”© ì„¸ì–´ë³´ë©´ ${totalItems}ê°œì…ë‹ˆë‹¤.`;
      break;
      
    case "ë§ì…ˆ":
      const add1 = Math.floor(rand() * 5) + 1; // 1~5
      const add2 = Math.floor(rand() * 5) + 1; // 1~5
      const sum = add1 + add2;
      
      stem = `ë†€ì´í„°ì—ì„œ ë¯¼ìˆ˜ê°€ ${add1}ê°œì˜ êµ¬ìŠ¬ì„ ê°€ì§€ê³  ìˆì—ˆì–´ìš”. ì§€ì˜ì´ ${add2}ê°œì˜ êµ¬ìŠ¬ì„ ë” ì£¼ì—ˆìŠµë‹ˆë‹¤. ë¯¼ìˆ˜ê°€ ê°€ì§„ êµ¬ìŠ¬ì€ ëª¨ë‘ ëª‡ ê°œì¼ê¹Œìš”?`;
      
      const addOptions = [
        `${sum}ê°œ`,
        `${add1 + add2 + 1}ê°œ`,
        `${add1 + add2 - 1}ê°œ`,
        `${add1}ê°œ`
      ];
      
      choices = shuffle(rand, [
        { id: "â‘ ", text: addOptions[0], isCorrect: true, rationale: `${add1} + ${add2} = ${sum}` },
        { id: "â‘¡", text: addOptions[1], isCorrect: false, rationale: "í•˜ë‚˜ ë” ê³„ì‚°í•´ì„œ ì˜ëª» ê³„ì‚°" },
        { id: "â‘¢", text: addOptions[2], isCorrect: false, rationale: "í•˜ë‚˜ ëœ ê³„ì‚°í•´ì„œ ì˜ëª» ê³„ì‚°" },
        { id: "â‘£", text: addOptions[3], isCorrect: false, rationale: "ì²˜ìŒì— ê°€ì§„ ê²ƒë§Œ ì„¸ì–´ì„œ ì˜ëª» ê³„ì‚°" }
      ]);
      correctAnswer = choices.find(c => c.isCorrect)!.id;
      solution = `${add1}ê°œ + ${add2}ê°œ = ${sum}ê°œì…ë‹ˆë‹¤.`;
      break;
      
    case "ëº„ì…ˆ":
      const total = Math.floor(rand() * 8) + 5; // 5~12
      const eaten = Math.floor(rand() * (total - 2)) + 1; // 1~(total-2)
      const remaining = total - eaten;
      
      stem = `ì§‘ì—ì„œ ì—„ë§ˆê°€ ${total}ê°œì˜ ê³¼ìë¥¼ ì¤€ë¹„í•˜ì…¨ì–´ìš”. ë¯¼ìˆ˜ê°€ ${eaten}ê°œë¥¼ ë¨¹ì—ˆìŠµë‹ˆë‹¤. ë‚¨ì€ ê³¼ìëŠ” ëª‡ ê°œì¼ê¹Œìš”?`;
      
      const subOptions = [
        `${remaining}ê°œ`,
        `${total}ê°œ`,
        `${eaten}ê°œ`,
        `${remaining + 1}ê°œ`
      ];
      
      choices = shuffle(rand, [
        { id: "â‘ ", text: subOptions[0], isCorrect: true, rationale: `${total} - ${eaten} = ${remaining}` },
        { id: "â‘¡", text: subOptions[1], isCorrect: false, rationale: "ì²˜ìŒì— ì¤€ë¹„í•œ ê°œìˆ˜ë§Œ ì„¸ì–´ì„œ ì˜ëª» ê³„ì‚°" },
        { id: "â‘¢", text: subOptions[2], isCorrect: false, rationale: "ë¨¹ì€ ê°œìˆ˜ë§Œ ì„¸ì–´ì„œ ì˜ëª» ê³„ì‚°" },
        { id: "â‘£", text: subOptions[3], isCorrect: false, rationale: "í•˜ë‚˜ ë” ê³„ì‚°í•´ì„œ ì˜ëª» ê³„ì‚°" }
      ]);
      correctAnswer = choices.find(c => c.isCorrect)!.id;
      solution = `${total}ê°œ - ${eaten}ê°œ = ${remaining}ê°œì…ë‹ˆë‹¤.`;
      break;
      
    case "ìˆ˜ ë¹„êµ":
      const num1 = Math.floor(rand() * 10) + 1; // 1~10
      const num2 = Math.floor(rand() * 10) + 1; // 1~10
      const larger = Math.max(num1, num2);
      const smaller = Math.min(num1, num2);
      
      stem = `êµì‹¤ì—ì„œ ë¯¼ìˆ˜ëŠ” ${num1}cm, ì§€ì˜ì€ ${num2}cm í‚¤ì˜ˆìš”. ë” í° ìˆ˜ëŠ” ëª‡ì¼ê¹Œìš”?`;
      
      const compareOptions = [
        `${larger}`,
        `${smaller}`,
        `${num1}`,
        `${num2}`
      ];
      
      choices = shuffle(rand, [
        { id: "â‘ ", text: compareOptions[0], isCorrect: true, rationale: `${larger}ê°€ ${smaller}ë³´ë‹¤ í½ë‹ˆë‹¤` },
        { id: "â‘¡", text: compareOptions[1], isCorrect: false, rationale: "ì‘ì€ ìˆ˜ë¥¼ ì„ íƒí•´ì„œ ì˜ëª» ê³„ì‚°" },
        { id: "â‘¢", text: compareOptions[2], isCorrect: num1 === larger, rationale: num1 === larger ? "ì •ë‹µ" : "ì²« ë²ˆì§¸ ìˆ˜ë¥¼ ì„ íƒí•´ì„œ ì˜ëª» ê³„ì‚°" },
        { id: "â‘£", text: compareOptions[3], isCorrect: num2 === larger, rationale: num2 === larger ? "ì •ë‹µ" : "ë‘ ë²ˆì§¸ ìˆ˜ë¥¼ ì„ íƒí•´ì„œ ì˜ëª» ê³„ì‚°" }
      ]);
      correctAnswer = choices.find(c => c.isCorrect)!.id;
      solution = `${larger}ê°€ ${smaller}ë³´ë‹¤ í½ë‹ˆë‹¤.`;
      break;
  }

  return {
    id: `HQ-STAGE-${stageId}`,
    gradeBand: "G1",
    stageId,
    format: "MCQ",
    difficulty: 1,
    blooms: "Apply",
    skills: ["100ê¹Œì§€ì˜ ìˆ˜", "ë§ì…ˆ", "ëº„ì…ˆ", "ìˆ˜ ë¹„êµ", "ê°œìˆ˜ ì„¸ê¸°"],
    tags: ["ê³ í’ˆì§ˆ", "ì‹¤ìƒí™œ", "êµì¬ìˆ˜ì¤€"],
    stem: stem,
    choices,
    answer: correctAnswer,
    solution: solution,
    images: {
      items: createImageItems("hero", 1, 'medium'),
      background: imageMapping.backgrounds[selectedType.setting as keyof typeof imageMapping.backgrounds] || imageMapping.backgrounds.forest,
      layout: 'row'
    },
    gameContext: {
      theme: selectedType.context,
      reward: "ë¬¸ì œë¥¼ ë§íˆë©´ ë‹¤ìŒ ë‹¨ê³„ë¡œ ì§„í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤!",
      visual: "ì‹¤ìƒí™œ ìƒí™©ì´ ìƒìƒí•˜ê²Œ ë‚˜íƒ€ë‚˜ëŠ” ì• ë‹ˆë©”ì´ì…˜"
    }
  };
}

// ğŸ”µ ì´ˆë“±í•™êµ 2í•™ë…„ ê³ í’ˆì§ˆ ë¬¸ì œ (ì„¸Â·ë„¤ ìë¦¬ ìˆ˜, 1000ê¹Œì§€ì˜ ìˆ˜)
function genG2_GameProblems(seed: number, stageId: number): ImageProblem {
  const rand = rng(seed);
  
  // ì‹¤ì œ êµì¬ ìˆ˜ì¤€ì˜ ë¬¸ì œ ìœ í˜•ë“¤
  const problemTypes = [
    {
      type: "ìˆ˜ ì½ê¸°",
      context: "í•™êµ ë„ì„œê´€ì—ì„œ ì±… ë²ˆí˜¸ í™•ì¸í•˜ê¸°",
      characters: ["ë¯¼ìˆ˜", "ì§€ì˜", "ì‚¬ì„œì„ ìƒë‹˜"],
      setting: "í•™êµ ë„ì„œê´€",
      background: "ë„ì„œê´€ì—ì„œ ì±…ì„ ì°¾ëŠ” ìƒí™©"
    },
    {
      type: "ìˆ˜ ì“°ê¸°", 
      context: "ë§ˆíŠ¸ì—ì„œ ë¬¼ê±´ ê°€ê²© í™•ì¸í•˜ê¸°",
      characters: ["ì—„ë§ˆ", "ë¯¼ìˆ˜", "ê³„ì‚°ì›"],
      setting: "ë§ˆíŠ¸",
      background: "ë§ˆíŠ¸ì—ì„œ ë¬¼ê±´ì„ ì‚¬ë©° ê°€ê²©ì„ í™•ì¸í•˜ëŠ” ìƒí™©"
    },
    {
      type: "í¬ê¸° ë¹„êµ",
      context: "ë†€ì´ê³µì›ì—ì„œ í‚¤ ì œí•œ í™•ì¸í•˜ê¸°",
      characters: ["ë¯¼ìˆ˜", "ì§€ì˜", "ë†€ì´ê¸°êµ¬ ì•ˆì „ìš”ì›"],
      setting: "ë†€ì´ê³µì›",
      background: "ë†€ì´ê³µì›ì—ì„œ ë†€ì´ê¸°êµ¬ë¥¼ íƒ€ê¸° ìœ„í•´ í‚¤ë¥¼ í™•ì¸í•˜ëŠ” ìƒí™©"
    },
    {
      type: "ìˆ˜ ë°°ì—´",
      context: "í•™êµì—ì„œ í•™ìƒ ë²ˆí˜¸ í™•ì¸í•˜ê¸°",
      characters: ["ë¯¼ìˆ˜", "ë°˜ ì¹œêµ¬ë“¤", "ì„ ìƒë‹˜"],
      setting: "êµì‹¤",
      background: "êµì‹¤ì—ì„œ í•™ìƒ ë²ˆí˜¸ë¥¼ í™•ì¸í•˜ëŠ” ìƒí™©"
    }
  ];
  
  const selectedType = pick(rand, problemTypes);
  
  // 1000ê¹Œì§€ì˜ ìˆ˜ ë²”ìœ„ì—ì„œ ë¬¸ì œ ìƒì„±
  const generateNumbers = () => {
    const hundreds = Math.floor(rand() * 9) + 1; // 100~900
    const tens = Math.floor(rand() * 10); // 0~9
    const ones = Math.floor(rand() * 10); // 0~9
    return hundreds * 100 + tens * 10 + ones;
  };
  
  const number1 = generateNumbers();
  const number2 = generateNumbers();
  const number3 = generateNumbers();
  
  let stem = "";
  let choices: Choice[] = [];
  let correctAnswer = "";
  let solution = "";
  
  switch (selectedType.type) {
    case "ìˆ˜ ì½ê¸°":
      stem = `ë„ì„œê´€ì—ì„œ ë¯¼ìˆ˜ê°€ ì±…ì„ ì°¾ê³  ìˆìŠµë‹ˆë‹¤. ì±… ë²ˆí˜¸ê°€ ${number1}ë²ˆì´ì—ìš”. ì´ ìˆ˜ë¥¼ ì½ìœ¼ë©´ ì–´ë–»ê²Œ ë ê¹Œìš”?`;
      
      const readOptions = [
        `${Math.floor(number1/100)}ë°± ${Math.floor((number1%100)/10)}ì‹­ ${number1%10}ì¼`,
        `${Math.floor(number1/100)}ë°± ${number1%100}ì‹­`,
        `${number1}ë°±`,
        `${number1}`
      ];
      
      choices = shuffle(rand, [
        { id: "â‘ ", text: readOptions[0], isCorrect: true, rationale: "ì„¸ ìë¦¬ ìˆ˜ë¥¼ ì˜¬ë°”ë¥´ê²Œ ì½ìŒ" },
        { id: "â‘¡", text: readOptions[1], isCorrect: false, rationale: "ì‹­ì˜ ìë¦¬ì™€ ì¼ì˜ ìë¦¬ë¥¼ ì˜ëª» ì½ìŒ" },
        { id: "â‘¢", text: readOptions[2], isCorrect: false, rationale: "ë°±ì˜ ìë¦¬ë§Œ ì½ê³  ë‚˜ë¨¸ì§€ë¥¼ ìƒëµ" },
        { id: "â‘£", text: readOptions[3], isCorrect: false, rationale: "ìˆ«ì ê·¸ëŒ€ë¡œ ì½ìŒ" }
      ]);
      correctAnswer = choices.find(c => c.isCorrect)!.id;
      solution = `${number1}ì€ ${Math.floor(number1/100)}ë°± ${Math.floor((number1%100)/10)}ì‹­ ${number1%10}ì¼ë¡œ ì½ìŠµë‹ˆë‹¤.`;
      break;
      
    case "ìˆ˜ ì“°ê¸°":
      const writtenNumber = `${Math.floor(number1/100)}ë°± ${Math.floor((number1%100)/10)}ì‹­ ${number1%10}ì¼`;
      stem = `ë§ˆíŠ¸ì—ì„œ ë¬¼ê±´ ê°€ê²©ì´ "${writtenNumber}"ë¡œ í‘œì‹œë˜ì–´ ìˆìŠµë‹ˆë‹¤. ì´ ê°€ê²©ì„ ìˆ«ìë¡œ ì“°ë©´ ì–´ë–»ê²Œ ë ê¹Œìš”?`;
      
      const writeOptions = [
        `${number1}`,
        `${number1 + 10}`,
        `${number1 - 10}`,
        `${Math.floor(number1/100)}${Math.floor((number1%100)/10)}${number1%10}`
      ];
      
      choices = shuffle(rand, [
        { id: "â‘ ", text: writeOptions[0], isCorrect: true, rationale: "ì½ì€ ìˆ˜ë¥¼ ì˜¬ë°”ë¥´ê²Œ ìˆ«ìë¡œ ì”€" },
        { id: "â‘¡", text: writeOptions[1], isCorrect: false, rationale: "ì‹­ì˜ ìë¦¬ë¥¼ ì˜ëª» ê³„ì‚°" },
        { id: "â‘¢", text: writeOptions[2], isCorrect: false, rationale: "ì‹­ì˜ ìë¦¬ë¥¼ ì˜ëª» ê³„ì‚°" },
        { id: "â‘£", text: writeOptions[3], isCorrect: false, rationale: "ìë¦¿ìˆ˜ë¥¼ ì˜ëª» ì´í•´" }
      ]);
      correctAnswer = choices.find(c => c.isCorrect)!.id;
      solution = `"${writtenNumber}"ì€ ${number1}ìœ¼ë¡œ ì”ë‹ˆë‹¤.`;
      break;
      
    case "í¬ê¸° ë¹„êµ":
      const numbers = [number1, number2, number3].sort((a, b) => a - b);
      stem = `ë†€ì´ê³µì›ì—ì„œ ë†€ì´ê¸°êµ¬ë¥¼ íƒ€ë ¤ë©´ í‚¤ê°€ ${numbers[1]}cm ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤. ë¯¼ìˆ˜ëŠ” ${numbers[0]}cm, ì§€ì˜ì€ ${numbers[2]}cmì…ë‹ˆë‹¤. ë†€ì´ê¸°êµ¬ë¥¼ íƒˆ ìˆ˜ ìˆëŠ” ì‚¬ëŒì€ ëˆ„êµ¬ì¼ê¹Œìš”?`;
      
      choices = shuffle(rand, [
        { id: "â‘ ", text: "ì§€ì˜ë§Œ", isCorrect: true, rationale: `ì§€ì˜(${numbers[2]}cm)ë§Œ ${numbers[1]}cm ì´ìƒ` },
        { id: "â‘¡", text: "ë¯¼ìˆ˜ë§Œ", isCorrect: false, rationale: `ë¯¼ìˆ˜(${numbers[0]}cm)ëŠ” ${numbers[1]}cm ë¯¸ë§Œ` },
        { id: "â‘¢", text: "ë‘˜ ë‹¤", isCorrect: false, rationale: `ë¯¼ìˆ˜(${numbers[0]}cm)ëŠ” ${numbers[1]}cm ë¯¸ë§Œ` },
        { id: "â‘£", text: "ë‘˜ ë‹¤ ëª» íƒ„ë‹¤", isCorrect: false, rationale: `ì§€ì˜(${numbers[2]}cm)ì€ íƒˆ ìˆ˜ ìˆìŒ` }
      ]);
      correctAnswer = choices.find(c => c.isCorrect)!.id;
      solution = `${numbers[1]}cm ì´ìƒì´ì–´ì•¼ í•˜ë¯€ë¡œ, ì§€ì˜(${numbers[2]}cm)ë§Œ íƒˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.`;
      break;
      
    case "ìˆ˜ ë°°ì—´":
      const startNumber = Math.floor(rand() * 100) + 100; // 100~199
      const nextNumber = startNumber + 10;
      stem = `êµì‹¤ì—ì„œ í•™ìƒ ë²ˆí˜¸ê°€ ${startNumber}ë²ˆë¶€í„° ì‹œì‘í•´ì„œ 10ì”© ì»¤ì§‘ë‹ˆë‹¤. ${startNumber}ë²ˆ ë‹¤ìŒ ë²ˆí˜¸ëŠ” ëª‡ ë²ˆì¼ê¹Œìš”?`;
      
      choices = shuffle(rand, [
        { id: "â‘ ", text: `${nextNumber}ë²ˆ`, isCorrect: true, rationale: `${startNumber} + 10 = ${nextNumber}` },
        { id: "â‘¡", text: `${startNumber + 1}ë²ˆ`, isCorrect: false, rationale: "1ì”© ì»¤ì§€ëŠ” ê²ƒìœ¼ë¡œ ì°©ê°" },
        { id: "â‘¢", text: `${startNumber + 100}ë²ˆ`, isCorrect: false, rationale: "100ì”© ì»¤ì§€ëŠ” ê²ƒìœ¼ë¡œ ì°©ê°" },
        { id: "â‘£", text: `${startNumber - 10}ë²ˆ`, isCorrect: false, rationale: "ì‘ì•„ì§€ëŠ” ê²ƒìœ¼ë¡œ ì°©ê°" }
      ]);
      correctAnswer = choices.find(c => c.isCorrect)!.id;
      solution = `${startNumber}ë²ˆì—ì„œ 10ì”© ì»¤ì§€ë¯€ë¡œ ${startNumber} + 10 = ${nextNumber}ë²ˆì…ë‹ˆë‹¤.`;
      break;
  }

  return {
    id: `HQ-STAGE-${stageId}`,
    gradeBand: "G2",
    stageId,
    format: "MCQ",
    difficulty: 2,
    blooms: "Apply",
    skills: ["ì„¸ ìë¦¬ ìˆ˜", "ë„¤ ìë¦¬ ìˆ˜", "1000ê¹Œì§€ì˜ ìˆ˜", "ìˆ˜ ì½ê¸°", "ìˆ˜ ì“°ê¸°", "í¬ê¸° ë¹„êµ"],
    tags: ["ê³ í’ˆì§ˆ", "ì‹¤ìƒí™œ", "êµì¬ìˆ˜ì¤€"],
    stem: stem,
    choices,
    answer: correctAnswer,
    solution: solution,
    images: {
      items: createImageItems("hero", 1, 'medium'),
      background: imageMapping.backgrounds[selectedType.setting as keyof typeof imageMapping.backgrounds] || imageMapping.backgrounds.forest,
      layout: 'row'
    },
    gameContext: {
      theme: selectedType.context,
      reward: "ë¬¸ì œë¥¼ ë§íˆë©´ ë‹¤ìŒ ë‹¨ê³„ë¡œ ì§„í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤!",
      visual: "ì‹¤ìƒí™œ ìƒí™©ì´ ìƒìƒí•˜ê²Œ ë‚˜íƒ€ë‚˜ëŠ” ì• ë‹ˆë©”ì´ì…˜"
    }
  };
}

// ğŸŒ¿ ì´ˆë“±í•™êµ 3í•™ë…„ ê²Œì„í˜• ë¬¸ì œ (ë¶„ìˆ˜Â·ì†Œìˆ˜, ê³±ì…ˆÂ·ë‚˜ëˆ—ì…ˆ) - ì´ë¯¸ì§€ ê¸°ë°˜ìœ¼ë¡œ ë³€í™˜
function genG3_GameProblems(seed: number, stageId: number): ImageProblem {
  const rand = rng(seed);
  const themes = [
    { theme: "í”¼ì íŒŒí‹°", item: "pizza", action: "ë‚˜ëˆ„ì–´ ë¨¹ê¸°", background: "party" },
    { theme: "ì¼€ì´í¬ íŒŒí‹°", item: "cake", action: "ë‚˜ëˆ„ì–´ ë¨¹ê¸°", background: "party" },
    { theme: "ì‚¬íƒ• ë‚˜ëˆ„ê¸°", item: "candy", action: "ë‚˜ëˆ„ì–´ ì£¼ê¸°", background: "party" }
  ];
  
  const selectedTheme = pick(rand, themes);
  const totalPieces = Math.floor(rand() * 3) + 4; // 4~6ì¡°ê°
  const eaten = Math.floor(rand() * (totalPieces - 1)) + 1; // 1~(totalPieces-1)
  const fraction = `${eaten}/${totalPieces}`;
  
  const wrong1 = `${eaten - 1}/${totalPieces}`;
  const wrong2 = `${eaten + 1}/${totalPieces}`;
  const wrong3 = `${eaten}/${totalPieces - 1}`;
  
  const choices: Choice[] = shuffle(rand, [
    { id: "â‘ ", text: fraction, isCorrect: true, rationale: `${totalPieces}ì¡°ê° ì¤‘ ${eaten}ì¡°ê°ì„ ë¨¹ì—ˆìœ¼ë¯€ë¡œ ${fraction}` },
    { id: "â‘¡", text: wrong1, isCorrect: false, rationale: "í•œ ì¡°ê° ëœ ë¨¹ì€ ê²ƒìœ¼ë¡œ ê³„ì‚°" },
    { id: "â‘¢", text: wrong2, isCorrect: false, rationale: "í•œ ì¡°ê° ë” ë¨¹ì€ ê²ƒìœ¼ë¡œ ê³„ì‚°" },
    { id: "â‘£", text: wrong3, isCorrect: false, rationale: "ì „ì²´ ì¡°ê° ìˆ˜ë¥¼ ì˜ëª» ê³„ì‚°" }
  ]);

  return {
    id: `IMAGE-STAGE-${stageId}`,
    gradeBand: "G3",
    stageId,
    format: "MCQ",
    difficulty: 2,
    blooms: "Understand",
    skills: ["ë¶„ìˆ˜ì˜ ì˜ë¯¸", "ì¼ë¶€-ì „ì²´ ê´€ê³„"],
    tags: ["ì´ë¯¸ì§€", "íŒŒí‹°", "ë¶„ìˆ˜"],
    stem: `${(imageMapping[selectedTheme.item] as ImageMappingItem).alt} 1íŒì„ ${totalPieces}ì¡°ê°ìœ¼ë¡œ ë‚˜ëˆ„ì—ˆì–´. ê·¸ ì¤‘ ${eaten}ì¡°ê°ì„ ë¨¹ìœ¼ë©´ ëª‡ ë¶„ì˜ ëª‡ì¼ê¹Œ?`,
    choices,
    answer: choices.find(c => c.isCorrect)!.id,
    solution: `${totalPieces}ì¡°ê° ì¤‘ ${eaten}ì¡°ê° â†’ ${fraction}`,
    images: {
      items: createImageItems(selectedTheme.item, totalPieces, 'medium'),
      background: imageMapping.backgrounds[selectedTheme.background as keyof typeof imageMapping.backgrounds],
      layout: 'grid'
    },
    gameContext: {
      theme: selectedTheme.theme,
      reward: `${(imageMapping[selectedTheme.item] as ImageMappingItem).alt}ë¥¼ ë¨¹ê³  ì²´ë ¥ì´ íšŒë³µë¨!`,
      visual: `${(imageMapping[selectedTheme.item] as ImageMappingItem).alt}ê°€ ì¡°ê°ë³„ë¡œ ë‚˜ë‰˜ì–´ì§€ëŠ” ì• ë‹ˆë©”ì´ì…˜`
    }
  };
}

// ğŸ”® ì´ˆë“±í•™êµ 4í•™ë…„ ê²Œì„í˜• ë¬¸ì œ (ë¶„ìˆ˜ ì—°ì‚°, ë„í˜•) - ì´ë¯¸ì§€ ê¸°ë°˜ìœ¼ë¡œ ë³€í™˜
function genG4_GameProblems(seed: number, stageId: number): ImageProblem {
  const rand = rng(seed);
  const themes = [
    { theme: "ë§ˆë²• ì—ë„ˆì§€", item: "magicGem", action: "ë§ˆë²• ì—ë„ˆì§€", background: "magicLab" },
    { theme: "í¬ì…˜ ì œì¡°", item: "potion", action: "ë§ˆë²•ë ¥", background: "magicLab" },
    { theme: "ë³´ì„ í•©ì„±", item: "diamond", action: "ì—ë„ˆì§€", background: "magicLab" }
  ];
  
  const selectedTheme = pick(rand, themes);
  const frac1 = Math.floor(rand() * 3) + 2; // 2~4
  const frac2 = Math.floor(rand() * 3) + 2; // 2~4
  const denom = Math.max(frac1, frac2) + 1; // ê³µí†µë¶„ëª¨
  const num1 = Math.floor(rand() * (denom - 1)) + 1;
  const num2 = Math.floor(rand() * (denom - 1)) + 1;
  const sum = num1 + num2;
  const result = sum === denom ? "1" : `${sum}/${denom}`;
  
  const wrong1 = `${num1 + num2 - 1}/${denom}`;
  const wrong2 = `${num1 + num2 + 1}/${denom}`;
  const wrong3 = `${num1}/${denom} + ${num2}/${denom}`;
  
  const choices: Choice[] = shuffle(rand, [
    { id: "â‘ ", text: result, isCorrect: true, rationale: `ë¶„ëª¨ê°€ ê°™ìœ¼ë¯€ë¡œ ë¶„ìë§Œ ë”í•¨: ${num1} + ${num2} = ${sum}` },
    { id: "â‘¡", text: wrong1, isCorrect: false, rationale: "ë¶„ì ê³„ì‚° ì‹¤ìˆ˜" },
    { id: "â‘¢", text: wrong2, isCorrect: false, rationale: "ë¶„ì ê³„ì‚° ì‹¤ìˆ˜" },
    { id: "â‘£", text: wrong3, isCorrect: false, rationale: "ê³„ì‚°ì„ ì™„ë£Œí•˜ì§€ ì•ŠìŒ" }
  ]);

  return {
    id: `IMAGE-STAGE-${stageId}`,
    gradeBand: "G4",
    stageId,
    format: "MCQ",
    difficulty: 3,
    blooms: "Apply",
    skills: ["ë¶„ìˆ˜ ë§ì…ˆ", "ë™ì¼ë¶„ëª¨"],
    tags: ["ì´ë¯¸ì§€", "ë§ˆë²•", "ë¶„ìˆ˜ì—°ì‚°"],
    stem: `ë¶„ìˆ˜ ë§ˆë²•ì‚¬ê°€ ${num1}/${denom} + ${num2}/${denom}ì˜ ë§ˆë²•ì„ ê±¸ì—ˆì–´. ê²°ê³¼ëŠ” ì–¼ë§ˆì¼ê¹Œ?`,
    choices,
    answer: choices.find(c => c.isCorrect)!.id,
    solution: `${num1}/${denom} + ${num2}/${denom} = ${result}`,
    images: {
      items: createImageItems(selectedTheme.item, sum, 'medium'),
      background: imageMapping.backgrounds[selectedTheme.background as keyof typeof imageMapping.backgrounds],
      layout: 'grid'
    },
    gameContext: {
      theme: selectedTheme.theme,
      reward: `ë§ˆë²• ì—ë„ˆì§€ êµ¬ìŠ¬ì´ ì™„ì„±ë¨!`,
      visual: `${(imageMapping[selectedTheme.item] as ImageMappingItem).alt}ì´ ë¹›ë‚˜ë©° í•©ì³ì§€ëŠ” ì• ë‹ˆë©”ì´ì…˜`
    }
  };
}

// ğŸ“˜ ì´ˆë“±í•™êµ 5í•™ë…„ ê²Œì„í˜• ë¬¸ì œ (ë¶„ìˆ˜Â·ì†Œìˆ˜ ê³±ì…ˆ, ì•½ë¶„Â·í†µë¶„)
function genG5_GameProblems(seed: number, stageId: number): ImageProblem {
  const rand = rng(seed);
  const themes = [
    { theme: "ë§ˆë²• ì•½ ì œì¡°", ingredient: "candy", potion: "potion", background: "magicLab" },
    { theme: "ìš”ë¦¬ ë ˆì‹œí”¼", ingredient: "apple", potion: "cake", background: "party" },
    { theme: "í¬ì…˜ ì œì¡°", ingredient: "magicGem", potion: "potion", background: "magicLab" }
  ];
  
  const selectedTheme = pick(rand, themes);
  const total = Math.floor(rand() * 20) + 20; // 20~39
  const fraction = Math.floor(rand() * 3) + 2; // 2~4
  const denominator = Math.floor(rand() * 3) + 4; // 4~6
  const used = Math.floor((total * fraction) / denominator);
  
  const wrong1 = Math.floor(total / denominator); // ë¶„ìë§Œ ê³ ë ¤
  const wrong2 = Math.floor(total * fraction); // ë¶„ëª¨ ë¬´ì‹œ
  const wrong3 = Math.floor(total / fraction); // ì—­ìˆ˜
  
  const choices: Choice[] = shuffle(rand, [
    { id: "â‘ ", text: `${used}ê°œ`, isCorrect: true, rationale: `${total} Ã— ${fraction}/${denominator} = ${used}ê°œ` },
    { id: "â‘¡", text: `${wrong1}ê°œ`, isCorrect: false, rationale: "ë¶„ìë§Œ ê³ ë ¤í•œ ê³„ì‚° ì‹¤ìˆ˜" },
    { id: "â‘¢", text: `${wrong2}ê°œ`, isCorrect: false, rationale: "ë¶„ëª¨ë¥¼ ë¬´ì‹œí•œ ê³„ì‚° ì‹¤ìˆ˜" },
    { id: "â‘£", text: `${wrong3}ê°œ`, isCorrect: false, rationale: "ê³±ì…ˆì„ ë‚˜ëˆ—ì…ˆìœ¼ë¡œ ì°©ê°" }
  ]);

  return {
    id: `IMAGE-STAGE-${stageId}`,
    gradeBand: "G5",
    stageId,
    format: "MCQ",
    difficulty: 3,
    blooms: "Apply",
    skills: ["ë¶„ìˆ˜ ê³±ì…ˆ", "ì‹¤ìƒí™œ ì ìš©"],
    tags: ["ì´ë¯¸ì§€", "ì œì¡°", "ë¶„ìˆ˜ê³±ì…ˆ"],
    stem: `ë§ˆë²• ì•½ì˜ ì¬ë£Œë¡œ ${(imageMapping[selectedTheme.ingredient] as ImageMappingItem).alt}ì˜ ${fraction}/${denominator}ë¥¼ ì‚¬ìš©í–ˆì–´. ${(imageMapping[selectedTheme.ingredient] as ImageMappingItem).alt}ì´ ${total}ê°œì˜€ë‹¤ë©´, ëª‡ ê°œë¥¼ ì“´ ê±¸ê¹Œ?`,
    choices,
    answer: choices.find(c => c.isCorrect)!.id,
    solution: `${total} Ã— ${fraction}/${denominator} = ${used}ê°œ`,
    images: {
      items: [
        ...createImageItems(selectedTheme.ingredient, used, 'medium'),
        ...createImageItems(selectedTheme.potion, 1, 'large')
      ],
      background: imageMapping.backgrounds[selectedTheme.background as keyof typeof imageMapping.backgrounds],
      layout: 'row'
    },
    gameContext: {
      theme: selectedTheme.theme,
      reward: `${(imageMapping[selectedTheme.potion] as ImageMappingItem).alt}ì— ${(imageMapping[selectedTheme.ingredient] as ImageMappingItem).alt}ì´ ${used}ê°œ ë“¤ì–´ê°€ì„œ ì™„ì„±!`,
      visual: `${(imageMapping[selectedTheme.ingredient] as ImageMappingItem).alt}ì´ ${(imageMapping[selectedTheme.potion] as ImageMappingItem).alt}ì— ë“¤ì–´ê°€ëŠ” ì• ë‹ˆë©”ì´ì…˜`
    }
  };
}

// ğŸ¯ ì´ˆë“±í•™êµ 6í•™ë…„ ê²Œì„í˜• ë¬¸ì œ (ë¹„ì™€ ë¹„ìœ¨, ì›ì˜ ë„“ì´)
function genG6_GameProblems(seed: number, stageId: number): ImageProblem {
  const rand = rng(seed);
  const themes = [
    { theme: "ë§ˆë²•ì§„ í™œì„±í™”", item: "redGem", item2: "blueGem", action: "ë§ˆë²•ì§„", background: "magicLab" },
    { theme: "í¬ì…˜ ì¡°í•©", item: "potion", item2: "magicGem", action: "í¬ì…˜", background: "magicLab" },
    { theme: "ë³´ì„ ë°°ì¹˜", item: "diamond", item2: "emerald", action: "ë³´ì„ì§„", background: "castle" }
  ];
  
  const selectedTheme = pick(rand, themes);
  const ratio1 = Math.floor(rand() * 3) + 2; // 2~4
  const ratio2 = Math.floor(rand() * 3) + 3; // 3~5
  const given = Math.floor(rand() * 6) + 4; // 4~9
  const answer = Math.floor((given * ratio2) / ratio1);
  
  const wrong1 = Math.floor((given * ratio1) / ratio2); // ë¹„ìœ¨ ë°”ê¿ˆ
  const wrong2 = given + ratio2; // ë§ì…ˆìœ¼ë¡œ ì°©ê°
  const wrong3 = given * ratio1; // ì²« ë²ˆì§¸ ë¹„ìœ¨ë§Œ ê³±í•¨
  
  const choices: Choice[] = shuffle(rand, [
    { id: "â‘ ", text: `${answer}ê°œ`, isCorrect: true, rationale: `${ratio1}:${ratio2} = ${given}:x â†’ x = ${answer}` },
    { id: "â‘¡", text: `${wrong1}ê°œ`, isCorrect: false, rationale: "ë¹„ìœ¨ì„ ë°”ê¿”ì„œ ê³„ì‚°" },
    { id: "â‘¢", text: `${wrong2}ê°œ`, isCorrect: false, rationale: "ë¹„ìœ¨ì„ ë§ì…ˆìœ¼ë¡œ ì°©ê°" },
    { id: "â‘£", text: `${wrong3}ê°œ`, isCorrect: false, rationale: "ë¹„ìœ¨ì˜ ì¼ë¶€ë§Œ ê³ ë ¤" }
  ]);

  return {
    id: `IMAGE-STAGE-${stageId}`,
    gradeBand: "G6",
    stageId,
    format: "MCQ",
    difficulty: 4,
    blooms: "Apply",
    skills: ["ë¹„ì™€ ë¹„ìœ¨", "ë¹„ë¡€ì‹"],
    tags: ["ì´ë¯¸ì§€", "ë§ˆë²•", "ë¹„ìœ¨"],
    stem: `${(imageMapping[selectedTheme.item] as ImageMappingItem).alt}:${(imageMapping[selectedTheme.item2] as ImageMappingItem).alt} = ${ratio1}:${ratio2}ì¼ ë•Œ, ${(imageMapping[selectedTheme.item] as ImageMappingItem).alt}ì´ ${given}ê°œë¼ë©´ ${(imageMapping[selectedTheme.item2] as ImageMappingItem).alt}ëŠ” ëª‡ ê°œì¼ê¹Œ?`,
    choices,
    answer: choices.find(c => c.isCorrect)!.id,
    solution: `${ratio1}:${ratio2} = ${given}:x â†’ x = ${answer}`,
    images: {
      items: [
        ...createImageItems(selectedTheme.item, given, 'medium'),
        ...createImageItems(selectedTheme.item2, answer, 'medium')
      ],
      background: imageMapping.backgrounds[selectedTheme.background as keyof typeof imageMapping.backgrounds],
      layout: 'row'
    },
    gameContext: {
      theme: selectedTheme.theme,
      reward: `êµ¬ìŠ¬ì´ ë§ˆë²•ì§„ì— ì±„ì›Œì§€ë©° ë¬¸ì´ ì—´ë¦¼!`,
      visual: `${(imageMapping[selectedTheme.item] as ImageMappingItem).alt}ê³¼ ${(imageMapping[selectedTheme.item2] as ImageMappingItem).alt}ì´ ${selectedTheme.action}ì— ë°°ì¹˜ë˜ëŠ” ì• ë‹ˆë©”ì´ì…˜`
    }
  };
}

// ğŸ“ ì¤‘í•™êµ 1í•™ë…„ ê²Œì„í˜• ë¬¸ì œ (ì •ìˆ˜Â·ìœ ë¦¬ìˆ˜, ë¬¸ìì™€ ì‹)
function genM1_GameProblems(seed: number, stageId: number): ImageProblem {
  const rand = rng(seed);
  const themes = [
    { theme: "ì˜ì›… ì „íˆ¬", character: "âš”ï¸ ì˜ì›…", enemy: "ğŸ‘¹ ì ", action: "ê³µê²©" },
    { theme: "ë§ˆë²•ì‚¬ ì „íˆ¬", character: "ğŸ§™â€â™‚ï¸ ë§ˆë²•ì‚¬", enemy: "ğŸ‰ ë“œë˜ê³¤", action: "ë§ˆë²• ê³µê²©" },
    { theme: "ê¶ìˆ˜ ì‚¬ëƒ¥", character: "ğŸ¹ ê¶ìˆ˜", enemy: "ğŸº ëª¬ìŠ¤í„°", action: "í™”ì‚´ ê³µê²©" }
  ];
  
  const selectedTheme = pick(rand, themes);
  const damage = Math.floor(rand() * 5) + 3; // 3~7
  const totalDamage = Math.floor(rand() * 10) + 10; // 10~19
  const attacks = Math.floor(totalDamage / damage);
  
  const wrong1 = attacks - 1;
  const wrong2 = attacks + 1;
  const wrong3 = Math.floor(totalDamage / (damage + 1));
  
  const choices: Choice[] = shuffle(rand, [
    { id: "â‘ ", text: `${attacks}ë²ˆ`, isCorrect: true, rationale: `${damage}x = ${totalDamage} â†’ x = ${attacks}` },
    { id: "â‘¡", text: `${wrong1}ë²ˆ`, isCorrect: false, rationale: "í•œ ë²ˆ ëœ ê³µê²©í•œ ê³„ì‚°" },
    { id: "â‘¢", text: `${wrong2}ë²ˆ`, isCorrect: false, rationale: "í•œ ë²ˆ ë” ê³µê²©í•œ ê³„ì‚°" },
    { id: "â‘£", text: `${wrong3}ë²ˆ`, isCorrect: false, rationale: "ê³µê²©ë ¥ì„ ì˜ëª» ê³„ì‚°" }
  ]);

  return {
    id: `IMAGE-STAGE-${stageId}`,
    gradeBand: "M1",
    stageId,
    format: "MCQ",
    difficulty: 3,
    blooms: "Apply",
    skills: ["ì¼ì°¨ë°©ì •ì‹", "ë¬¸ìì™€ ì‹"],
    tags: ["ì´ë¯¸ì§€", "ì „íˆ¬", "ë°©ì •ì‹"],
    stem: `${selectedTheme.character}ê°€ ${selectedTheme.enemy}ì—ê²Œ xë²ˆ ${selectedTheme.action}í•´ ì´ ${totalDamage}ì˜ í”¼í•´ë¥¼ ì¤¬ì–´. í•œ ë²ˆ ${selectedTheme.action}ì˜ í”¼í•´ê°€ ${damage}ë¼ë©´, xëŠ” ì–¼ë§ˆì¼ê¹Œ?`,
    choices,
    answer: choices.find(c => c.isCorrect)!.id,
    solution: `${damage}x = ${totalDamage} â†’ x = ${attacks}`,
    images: {
      items: [
        ...createImageItems("hero", 1, 'large'),
        ...createImageItems("monster", 1, 'large')
      ],
      background: imageMapping.backgrounds.dungeon,
      layout: 'row'
    },
    gameContext: {
      theme: selectedTheme.theme,
      reward: `${selectedTheme.action} ëª¨ì…˜ì´ ${attacks}ë²ˆ ì¬ìƒë¨!`,
      visual: `${selectedTheme.character}ê°€ ${selectedTheme.action}í•˜ëŠ” ëª¨ì…˜ ì• ë‹ˆë©”ì´ì…˜`
    }
  };
}

// âš¡ ì¤‘í•™êµ 2í•™ë…„ ê²Œì„í˜• ë¬¸ì œ (ì¼ì°¨ë°©ì •ì‹, í”¼íƒ€ê³ ë¼ìŠ¤ ì •ë¦¬)
function genM2_GameProblems(seed: number, stageId: number): ImageProblem {
  const rand = rng(seed);
  const themes = [
    { theme: "ë‹¤ë¦¬ ê±´ì„¤", item: "ğŸŒ‰ ë‹¤ë¦¬", action: "ê°•ì„ ê±´ë„˜" },
    { theme: "ì‚¬ë‹¤ë¦¬ ì„¤ì¹˜", item: "ğŸªœ ì‚¬ë‹¤ë¦¬", action: "ë²½ì„ ì˜¤ë¦„" },
    { theme: "ë¡œí”„ ì„¤ì¹˜", item: "ğŸª¢ ë¡œí”„", action: "ì ˆë²½ì„ ì˜¤ë¦„" }
  ];
  
  const selectedTheme = pick(rand, themes);
  const a = Math.floor(rand() * 4) + 3; // 3~6
  const b = Math.floor(rand() * 4) + 4; // 4~7
  const c = Math.sqrt(a * a + b * b);
  const answer = Math.round(c * 100) / 100; // ì†Œìˆ˜ì  ë‘˜ì§¸ìë¦¬ê¹Œì§€
  
  const wrong1 = Math.round((a + b) * 100) / 100; // ë§ì…ˆìœ¼ë¡œ ì°©ê°
  const wrong2 = Math.round((a * b) * 100) / 100; // ê³±ì…ˆìœ¼ë¡œ ì°©ê°
  const wrong3 = Math.round(Math.abs(a - b) * 100) / 100; // ëº„ì…ˆìœ¼ë¡œ ì°©ê°
  
  const choices: Choice[] = shuffle(rand, [
    { id: "â‘ ", text: `${answer}`, isCorrect: true, rationale: `âˆš(${a}Â² + ${b}Â²) = ${answer}` },
    { id: "â‘¡", text: `${wrong1}`, isCorrect: false, rationale: "ë§ì…ˆìœ¼ë¡œ ì°©ê°" },
    { id: "â‘¢", text: `${wrong2}`, isCorrect: false, rationale: "ê³±ì…ˆìœ¼ë¡œ ì°©ê°" },
    { id: "â‘£", text: `${wrong3}`, isCorrect: false, rationale: "ëº„ì…ˆìœ¼ë¡œ ì°©ê°" }
  ]);

  return {
    id: `IMAGE-STAGE-${stageId}`,
    gradeBand: "M2",
    stageId,
    format: "MCQ",
    difficulty: 4,
    blooms: "Apply",
    skills: ["í”¼íƒ€ê³ ë¼ìŠ¤ ì •ë¦¬", "ì§ê°ì‚¼ê°í˜•"],
    tags: ["ì´ë¯¸ì§€", "ê±´ì„¤", "ê¸°í•˜"],
    stem: `ì§ê°ì‚¼ê°í˜•ì˜ í•œ ë³€ì´ ${a}, ë‹¤ë¥¸ ë³€ì´ ${b}ì¼ ë•Œ, ë¹—ë³€ì˜ ê¸¸ì´ëŠ”?`,
    choices,
    answer: choices.find(c => c.isCorrect)!.id,
    solution: `âˆš(${a}Â² + ${b}Â²) = ${answer}`,
    images: {
      items: createImageItems("magicGem", 3, 'medium'),
      background: imageMapping.backgrounds.magicLab,
      layout: 'scattered'
    },
    gameContext: {
      theme: selectedTheme.theme,
      reward: `ë§ì¶”ë©´ ${selectedTheme.item}ì´ ë†“ì—¬ ${selectedTheme.action}!`,
      visual: `ì§ê°ì‚¼ê°í˜•ì´ ê·¸ë ¤ì§€ë©° ${selectedTheme.item}ì´ ì„¤ì¹˜ë˜ëŠ” ì• ë‹ˆë©”ì´ì…˜`
    }
  };
}

// ğŸ† ì¤‘í•™êµ 3í•™ë…„ ê²Œì„í˜• ë¬¸ì œ (ì´ì°¨ë°©ì •ì‹, ì‚¼ê°ë¹„)
function genM3_GameProblems(seed: number, stageId: number): ImageProblem {
  const rand = rng(seed);
  const themes = [
    { theme: "ë³´ìŠ¤ì „", boss: "ğŸ‘¹ ìµœì¢… ë³´ìŠ¤", action: "ì•½ì  íŒŒê´´" },
    { theme: "ë“œë˜ê³¤ í‡´ì¹˜", boss: "ğŸ‰ ê³ ëŒ€ ë“œë˜ê³¤", action: "ê²°ì •íƒ€" },
    { theme: "ë§ˆì™• í† ë²Œ", boss: "ğŸ‘‘ ë§ˆì™•", action: "í•„ì‚´ê¸°" }
  ];
  
  const selectedTheme = pick(rand, themes);
  const x1 = Math.floor(rand() * 3) + 2; // 2~4
  const x2 = Math.floor(rand() * 3) + 3; // 3~5
  const b = -(x1 + x2);
  const c = x1 * x2;
  
  const choices: Choice[] = shuffle(rand, [
    { id: "â‘ ", text: `x=${x1}, x=${x2}`, isCorrect: true, rationale: `ì¸ìˆ˜ë¶„í•´: (x-${x1})(x-${x2})=0` },
    { id: "â‘¡", text: `x=${x1+1}, x=${x2+1}`, isCorrect: false, rationale: "ê³„ì‚° ì‹¤ìˆ˜" },
    { id: "â‘¢", text: `x=${x1-1}, x=${x2-1}`, isCorrect: false, rationale: "ê³„ì‚° ì‹¤ìˆ˜" },
    { id: "â‘£", text: `x=${x1}, x=${x2+1}`, isCorrect: false, rationale: "ë¶€ë¶„ì  ê³„ì‚° ì‹¤ìˆ˜" }
  ]);

  return {
    id: `IMAGE-STAGE-${stageId}`,
    gradeBand: "M3",
    stageId,
    format: "MCQ",
    difficulty: 5,
    blooms: "Analyze",
    skills: ["ì´ì°¨ë°©ì •ì‹", "ì¸ìˆ˜ë¶„í•´"],
    tags: ["ì´ë¯¸ì§€", "ë³´ìŠ¤ì „", "ê³ ê¸‰ìˆ˜í•™"],
    stem: `ì´ì°¨ë°©ì •ì‹ xÂ² + ${b}x + ${c} = 0ì˜ í•´ëŠ”?`,
    choices,
    answer: choices.find(c => c.isCorrect)!.id,
    solution: `ì¸ìˆ˜ë¶„í•´ (x-${x1})(x-${x2})=0 â†’ x=${x1}, x=${x2}`,
    images: {
      items: createImageItems("magicGem", 2, 'large'),
      background: imageMapping.backgrounds.magicLab,
      layout: 'row'
    },
    gameContext: {
      theme: selectedTheme.theme,
      reward: `ì •ë‹µì„ ë§íˆë©´ ${selectedTheme.boss}ì˜ ì•½ì  ë‘ ê³³ì´ ë™ì‹œì— íŒŒê´´ë¨!`,
      visual: `${selectedTheme.boss}ê°€ ë‘ ê³³ì—ì„œ ë™ì‹œì— í”¼í•´ë¥¼ ë°›ëŠ” ì• ë‹ˆë©”ì´ì…˜`
    }
  };
}

// ğŸ§  ì‚¬ê³ ë ¥ ì—°ì‚° ê²Œì„í˜• ë¬¸ì œ (ë…¼ë¦¬ì Â·ì°½ì˜ì Â·ë¹„íŒì  ì‚¬ê³ )
function genThinking_GameProblems(seed: number, stageId: number): ImageProblem {
  const rand = rng(seed);
  const themes = [
    { theme: "í¼ì¦ í•´ê²°", item: "ğŸ§© í¼ì¦", action: "ì¡°ê° ë§ì¶”ê¸°" },
    { theme: "ë¯¸ë¡œ íƒˆì¶œ", item: "ğŸ° ë¯¸ë¡œ", action: "ê¸¸ ì°¾ê¸°" },
    { theme: "ì•”í˜¸ í•´ë…", item: "ğŸ” ì•”í˜¸", action: "ì½”ë“œ í•´ë…" }
  ];
  
  const selectedTheme = pick(rand, themes);
  const patterns = [
    { pattern: "2, 4, 6, 8, ?", answer: "10", logic: "2ì”© ì¦ê°€" },
    { pattern: "1, 4, 9, 16, ?", answer: "25", logic: "ì œê³±ìˆ˜" },
    { pattern: "1, 1, 2, 3, 5, ?", answer: "8", logic: "í”¼ë³´ë‚˜ì¹˜ ìˆ˜ì—´" },
    { pattern: "3, 6, 12, 24, ?", answer: "48", logic: "2ë°°ì”© ì¦ê°€" }
  ];
  
  const selectedPattern = pick(rand, patterns);
  
  const wrong1 = parseInt(selectedPattern.answer) - 2;
  const wrong2 = parseInt(selectedPattern.answer) + 2;
  const wrong3 = parseInt(selectedPattern.answer) * 2;
  
  const choices: Choice[] = shuffle(rand, [
    { id: "â‘ ", text: selectedPattern.answer, isCorrect: true, rationale: selectedPattern.logic },
    { id: "â‘¡", text: wrong1.toString(), isCorrect: false, rationale: "íŒ¨í„´ì„ ì˜ëª» íŒŒì•…" },
    { id: "â‘¢", text: wrong2.toString(), isCorrect: false, rationale: "íŒ¨í„´ì„ ì˜ëª» íŒŒì•…" },
    { id: "â‘£", text: wrong3.toString(), isCorrect: false, rationale: "íŒ¨í„´ì„ ì˜ëª» íŒŒì•…" }
  ]);

  return {
    id: `IMAGE-STAGE-${stageId}`,
    gradeBand: "Thinking",
    stageId,
    format: "MCQ",
    difficulty: 4,
    blooms: "Analyze",
    skills: ["íŒ¨í„´ ì¸ì‹", "ë…¼ë¦¬ì  ì¶”ë¡ "],
    tags: ["ì´ë¯¸ì§€", "ì‚¬ê³ ë ¥", "í¼ì¦"],
    stem: `${selectedTheme.item}ì—ì„œ ë‹¤ìŒ íŒ¨í„´ì˜ ë‹¤ìŒ ìˆ˜ëŠ”? ${selectedPattern.pattern}`,
    choices,
    answer: choices.find(c => c.isCorrect)!.id,
    solution: selectedPattern.logic,
    images: {
      items: createImageItems("magicGem", 5, 'small'),
      background: imageMapping.backgrounds.magicLab,
      layout: 'scattered'
    },
    gameContext: {
      theme: selectedTheme.theme,
      reward: `${selectedTheme.item}ì´ ì™„ì„±ë˜ì–´ ${selectedTheme.action} ì„±ê³µ!`,
      visual: `${selectedTheme.item}ì´ ì¡°ê°ë³„ë¡œ ë§ì¶°ì§€ëŠ” ì• ë‹ˆë©”ì´ì…˜`
    }
  };
}

/********************
 * Core generators by topic
 ********************/

// K: ì„œë¸Œíƒ€ì´ì§•/íŒ¨í„´ í™•ì¥/ë¹„êµ (ì‹œê°ì  ë°ì´í„° í¬í•¨)
function genK_Subitizing(seed: number, stageId: number): Problem {
  const rand = rng(seed);
  const count = Math.floor(rand() * 4) + 2; // 2~5
  const emoji = pick(rand, ["ğŸ", "ğŸˆ", "â­", "ğŸŒ¸", "â¤ï¸"]);
  const wrong1 = count - 1; // ì „í˜•ì  ì˜¤ë‹µ(í•œ ê°œ ëœ ì„¸ê¸°)
  const wrong2 = count + 1; // ì „í˜•ì  ì˜¤ë‹µ(í•œ ê°œ ë” ì„¸ê¸°)
  const options = shuffle(rand, [count, wrong1, wrong2].map((n, i) => ({
    id: toChoiceLabel(i),
    text: `${n}ê°œ`,
    isCorrect: n === count,
    rationale: n === count ? `${emoji.repeat(count)}ëŠ” ${count}ê°œì…ë‹ˆë‹¤.` : `ì•„ì´ë“¤ì´ ìì£¼ í•˜ëŠ” ì‹¤ìˆ˜: í•œ ë²ˆ ëœ/ë” ì…ˆ.`
  })));

  return {
    id: `STAGE-${stageId}`,
    gradeBand: "Kindergarten",
    stageId,
    format: "MCQ",
    difficulty: 1,
    blooms: "Understand",
    skills: ["ìˆ˜ ê°œìˆ˜ ì¸ì‹(ì„œë¸Œíƒ€ì´ì§•)", "ë¹„êµ"],
    tags: ["ì‹œê°", "ìœ ì•„", "ì¹´ìš´íŒ…"],
    stem: `${emoji.repeat(count)}\nê·¸ë¦¼ì˜ ê°œìˆ˜ëŠ” ëª‡ ê°œì¸ê°€ìš”?`,
    choices: options,
    answer: options.find(c => c.isCorrect)!.id,
    solution: `${emoji}ì˜ ê°œìˆ˜ë¥¼ ë°”ë¡œ ì¸ì‹(ì„œë¸Œíƒ€ì´ì§•)í•˜ê±°ë‚˜ í•˜ë‚˜ì”© ì„¸ì–´ ${count}ê°œì„ì„ í™•ì¸í•©ë‹ˆë‹¤.`,
    data: { emoji, count }
  };
}

// G1: ìë¦¿ê°’ ë¶„í•´ + ë°›ì•„ì˜¬ë¦¼/ë¹¼ë‚´ë¦¼ ì˜¤ë¥˜ë¶„ì„ í¬í•¨ ë§ì…ˆ
function genG1_AdditionWithErrorAnalysis(seed: number, stageId: number): Problem {
  const rand = rng(seed);
  const a = Math.floor(rand() * 90) + 10; // 10~99
  const b = Math.floor(rand() * 90) + 10;
  const correct = a + b;
  const ones = (a % 10) + (b % 10);
  const carryWrong = (a - (a % 10)) + (b - (b % 10)) + (ones % 10); // ë°›ì•„ì˜¬ë¦¼ ëˆ„ë½
  const placeWrong = (Math.floor(a / 10) + Math.floor(b / 10)) * 10 + (a % 10 + b % 10); // ìë¦¿ê°’ í˜¼ë™

  const choices: Choice[] = shuffle(rand, ensureUnique([
    { id: "â‘ ", text: String(correct), isCorrect: true, rationale: "ì¼ì˜ ìë¦¬ í•©ì—ì„œ ë°›ì•„ì˜¬ë¦¼ì„ ë”í•œ ê°’ê¹Œì§€ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤." },
    { id: "â‘¡", text: String(carryWrong), isCorrect: false, rationale: "ë°›ì•„ì˜¬ë¦¼(ì˜¬ë¦¼ 1)ì„ ë”í•˜ì§€ ì•Šì€ ì˜¤ë¥˜ì…ë‹ˆë‹¤." },
    { id: "â‘¢", text: String(placeWrong), isCorrect: false, rationale: "ì‹­ì˜ ìë¦¬/ì¼ì˜ ìë¦¬ ìë¦¿ê°’ì„ í˜¼ë™í–ˆìŠµë‹ˆë‹¤." },
    { id: "â‘£", text: String(correct + 1), isCorrect: false, rationale: "ë‹¨ìˆœ ë¶€ì •í™• ê³„ì‚°." }
  ]));

  return {
    id: `STAGE-${stageId}`,
    gradeBand: "G1",
    stageId,
    format: "MCQ",
    difficulty: 2,
    blooms: "Analyze",
    skills: ["ë‘ ìë¦¬ ìˆ˜ ë§ì…ˆ", "ë°›ì•„ì˜¬ë¦¼", "ì˜¤ë¥˜ ë¶„ì„"],
    tags: ["ìë¦¿ê°’", "ì—°ì‚° ì „ëµ"],
    stem: `${a} + ${b} = ?\n(ê³„ì‚° ê³¼ì •ì„ ì ì–´ ë³´ì„¸ìš”.)`,
    choices,
    answer: choices.find(c => c.isCorrect)!.id,
    solution: `ì¼ì˜ ìë¦¬ ${a % 10} + ${b % 10} = ${ones} â†’ ${Math.floor(ones / 10)} ì˜¬ë¦¼, ì‹­ì˜ ìë¦¬ ${Math.floor(a / 10)} + ${Math.floor(b / 10)} + ì˜¬ë¦¼ ${Math.floor(ones / 10)} = ${Math.floor(a / 10) + Math.floor(b / 10) + Math.floor(ones / 10)}. ì •ë‹µì€ ${correct}.`
  };
}

// G2: ë‘ ë‹¨ê³„ ë¬¸ì¥ì œ(ë‹¨ê°€Ã—ìˆ˜ëŸ‰ â†’ í•©ê³„ ë¹„êµ) + ë¶ˆí•„ìš” ì •ë³´ í¬í•¨
function genG2_TwoStepWordProblem(seed: number, stageId: number): Problem {
  const rand = rng(seed);
  const priceA = (Math.floor(rand() * 6) + 2) * 100; // 200~800ì›
  const priceB = priceA + (Math.floor(rand() * 5) + 1) * 100; // ë” ë¹„ì‹¼ B
  const qtyA = Math.floor(rand() * 5) + 2; // 2~6ê°œ
  const qtyB = Math.floor(rand() * 4) + 2; // 2~5ê°œ
  const coupon = (Math.floor(rand() * 3)) * 100; // 0,100,200 (í˜¼ë€ìš©)
  const totalA = priceA * qtyA;
  const totalB = priceB * qtyB;
  const question = `ê³¼ì¼ê°€ê²Œì—ì„œ ì‚¬ê³¼ëŠ” ${priceA}ì›, ë°°ëŠ” ${priceB}ì›ì…ë‹ˆë‹¤. ì˜ì´ëŠ” ì‚¬ê³¼ ${qtyA}ê°œì™€ ë°° ${qtyB}ê°œë¥¼ ìƒ€ê³ , ê°€ê²Œ ì¿ í°(ì˜¤ëŠ˜ì€ ê³¼ì ì „ìš©  ${coupon}ì› í• ì¸)ì„ ë°›ì•˜ìŠµë‹ˆë‹¤. ëˆ„ê°€ ë” ë§ì´ ë‚´ë ¸ì„ê¹Œìš”?`;
  // ì •ë‹µ: ë” í° totalì„ ì°¾ëŠ” ë¹„êµ ë¬¸ì œ (ì¿ í°ì€ ê³¼ì ì „ìš©ì´ë¯€ë¡œ ë¬´ê´€)
  const correct = totalA > totalB ? "ì‚¬ê³¼" : totalA < totalB ? "ë°°" : "ê°™ë‹¤";

  const choices: Choice[] = shuffle(rand, [
    { id: "â‘ ", text: "ì‚¬ê³¼", isCorrect: correct === "ì‚¬ê³¼", rationale: correct === "ì‚¬ê³¼" ? "ì‚¬ê³¼ ì´ì•¡ì´ ë” í½ë‹ˆë‹¤." : "ë°° ì´ì•¡ì´ ë” í½ë‹ˆë‹¤." },
    { id: "â‘¡", text: "ë°°", isCorrect: correct === "ë°°", rationale: correct === "ë°°" ? "ë°° ì´ì•¡ì´ ë” í½ë‹ˆë‹¤." : "ì‚¬ê³¼ ì´ì•¡ì´ ë” í½ë‹ˆë‹¤." },
    { id: "â‘¢", text: "ê°™ë‹¤", isCorrect: correct === "ê°™ë‹¤", rationale: correct === "ê°™ë‹¤" ? "ë‘ í•©ê³„ê°€ ê°™ìŠµë‹ˆë‹¤." : "ë‘ í•©ê³„ëŠ” ë‹¤ë¦…ë‹ˆë‹¤." },
    { id: "â‘£", text: "ì¿ í° ë°›ì€ ê²ƒì´ ë” ì‹¸ë‹¤", isCorrect: false, rationale: "ì¿ í°ì€ ê³¼ì ì „ìš©ìœ¼ë¡œ ë¬¸ì œì˜ êµ¬ë§¤ì™€ ë¬´ê´€í•©ë‹ˆë‹¤ (ë¶ˆí•„ìš” ì •ë³´)." }
  ]);

  return {
    id: `STAGE-${stageId}`,
    gradeBand: "G2",
    stageId,
    format: "MCQ",
    difficulty: 3,
    blooms: "Apply",
    skills: ["ê³±ì…ˆ(ë‹¨ê°€Ã—ìˆ˜ëŸ‰)", "ë¹„êµ", "ë¶ˆí•„ìš” ì •ë³´ ë°°ì œ"],
    tags: ["ë¬¸ì¥ì œ", "ë‘ ë‹¨ê³„ ì¶”ë¡ "],
    stem: question,
    choices,
    answer: choices.find(c => c.isCorrect)!.id,
    solution: `ì‚¬ê³¼ í•©ê³„ ${priceA}Ã—${qtyA}=${totalA}ì›, ë°° í•©ê³„ ${priceB}Ã—${qtyB}=${totalB}ì›. ì¿ í°ì€ ê³¼ì ì „ìš© â†’ ë¬´ê´€. ë¹„êµ ê²°ê³¼: ${correct === "ê°™ë‹¤" ? "ê°™ë‹¤" : `${correct}ê°€ ë” í¼`}.`
  };
}

// G3: ë¶„ìˆ˜ì˜ ì˜ë¯¸(ì „ì²´ì˜ ì¼ë¶€)ì™€ ë™ì¹˜ë¶„ìˆ˜ íŒë‹¨ + ì‹œê° ëª¨ë¸ ë°ì´í„° ì œê³µ
function genG3_FractionEquivalence(seed: number, stageId: number): Problem {
  const rand = rng(seed);
  const n = Math.floor(rand() * 3) + 2; // 2~4 ë“±ë¶„
  const k = Math.floor(rand() * (n - 1)) + 1; // 1~(n-1)
  // ë™ì¹˜ë¶„ìˆ˜ í›„ë³´: (k/n) == (2k/2n) == (3k/3n)
  const candidates = [
    { num: k, den: n },
    { num: 2 * k, den: 2 * n },
    { num: k + 1, den: n },
    { num: 3 * k, den: 3 * n },
  ];
  const optionsRaw = [
    `${k}/${n}`,
    `${2 * k}/${2 * n}`,
    `${k + 1}/${n}`,
    `${3 * k}/${3 * n}`,
  ];
  // ì •ë‹µ: k/nê³¼ 2k/2nê³¼ 3k/3n (ë™ì¹˜), ë‹¨ k+1/nì€ ì¼ë°˜ì ìœ¼ë¡œ ë¹„ë™ì¹˜
  const isEquiv = (a: { num: number; den: number }) => a.num * n === a.den * k; // k/nê³¼ ë¹„êµ
  const options: Choice[] = optionsRaw.map((text, i) => ({ id: toChoiceLabel(i), text, isCorrect: isEquiv(candidates[i]), rationale: isEquiv(candidates[i]) ? "ë¶„ìì™€ ë¶„ëª¨ë¥¼ ê°™ì€ ìˆ˜ë¡œ ê³±í•˜ë©´ ê°’ì€ ê°™ì•„ìš”." : "ë¶„ìë§Œ ë°”ë€Œë©´ ê°’ì´ ë‹¬ë¼ì§‘ë‹ˆë‹¤." }));

  return {
    id: `STAGE-${stageId}`,
    gradeBand: "G3",
    stageId,
    format: "MultiSelect",
    difficulty: 3,
    blooms: "Analyze",
    skills: ["ë¶„ìˆ˜ì˜ ë™ì¹˜", "ë°°ìœ¨ ì¶”ë¡ "],
    tags: ["ì‹œê° ëª¨ë¸", "ì¼ë¶€-ì „ì²´"],
    stem: `ë‹¤ìŒ ì¤‘ ${k}/${n}ê³¼ ê°™ì€ í¬ê¸°ì˜ ë¶„ìˆ˜ë¥¼ ëª¨ë‘ ê³ ë¥´ì„¸ìš”.`,
    choices: options,
    answer: options.filter(o => o.isCorrect).map(o => o.id),
    solution: `ë¶„ìì™€ ë¶„ëª¨ì— ê°™ì€ ìˆ˜ë¥¼ ê³±í•˜ë©´ í¬ê¸°ëŠ” ê°™ìŠµë‹ˆë‹¤. ë”°ë¼ì„œ ${k}/${n} â‰¡ ${2 * k}/${2 * n} â‰¡ ${3 * k}/${3 * n}.`,
    data: { areaModel: { partitions: n, filled: k } }
  };
}

// G4: ì„œë¡œ ë‹¤ë¥¸ ë¶„ëª¨ì˜ ë§ì…ˆ(í†µë¶„ ì „ëµ ë¹„êµ) + ì „ëµ ì„ íƒ ìœ ë„
function genG4_AddUnlikeFractions(seed: number, stageId: number): Problem {
  const rand = rng(seed);
  const a = [2, 3, 4, 5][Math.floor(rand() * 4)];
  const b = [3, 4, 5, 6][Math.floor(rand() * 4)];
  const x = Math.floor(rand() * (a - 1)) + 1;
  const y = Math.floor(rand() * (b - 1)) + 1;
  const lcm = (m: number, n: number) => {
    const gcd = (p: number, q: number): number => (q === 0 ? p : gcd(q, p % q));
    return (m * n) / gcd(m, n);
  };
  const L = lcm(a, b);
  const sumNum = x * (L / a) + y * (L / b);
  const simplified = (() => {
    const gcd = (p: number, q: number): number => (q === 0 ? p : gcd(q, p % q));
    const g = gcd(sumNum, L);
    return `${sumNum / g}/${L / g}`;
  })();

  const choices: Choice[] = shuffle(rand, [
    { id: "â‘ ", text: simplified, isCorrect: true, rationale: "í†µë¶„ í›„ ê¸°ì•½ë¶„ìˆ˜ë¡œ ì•½ë¶„." },
    { id: "â‘¡", text: `${sumNum}/${L}`, isCorrect: false, rationale: "ì•½ë¶„ì„ í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤." },
    { id: "â‘¢", text: `${x + y}/${a + b}`, isCorrect: false, rationale: "ë¶„ì/ë¶„ëª¨ë¥¼ ê°ê° ë”í•˜ëŠ” ì˜¤ê°œë…." },
    { id: "â‘£", text: `${x}/${a} + ${y}/${b}`, isCorrect: false, rationale: "ê³„ì‚°ì„ ìˆ˜í–‰í•˜ì§€ ì•ŠìŒ." }
  ]);

  return {
    id: `STAGE-${stageId}`,
    gradeBand: "G4",
    stageId,
    format: "MCQ",
    difficulty: 3,
    blooms: "Apply",
    skills: ["ë¶„ëª¨ê°€ ë‹¤ë¥¸ ë¶„ìˆ˜ì˜ ë§ì…ˆ", "í†µë¶„", "ì•½ë¶„"],
    tags: ["ë¶„ìˆ˜ ì—°ì‚°", "ì „ëµ ë¹„êµ"],
    stem: `${x}/${a} + ${y}/${b} = ? (ê¸°ì•½ë¶„ìˆ˜ë¡œ)`,
    choices,
    answer: choices.find(c => c.isCorrect)!.id,
    solution: `ê³µí†µë¶„ëª¨ ${L}ë¡œ í†µë¶„ â†’ ë¶„ì ${x * (L / a)} + ${y * (L / b)} = ${sumNum}. ì•½ë¶„í•˜ë©´ ${simplified}.`
  };
}

// G5: ë¹„ì™€ ë¹„ìœ¨, í¼ì„¼íŠ¸ ì¦ê°(ë‘ ë‹¨ê³„) + ë‹¨ìœ„ í•´ì„
function genG5_PercentIncrease(seed: number, stageId: number): Problem {
  const rand = rng(seed);
  const base = (Math.floor(rand() * 16) + 20) * 100; // 2000~3600
  const inc = (Math.floor(rand() * 5) + 5); // 5~9%
  const extra = (Math.floor(rand() * 4) + 2); // ì¶”ê°€ 2~5%
  const after1 = Math.round(base * (1 + inc / 100));
  const after2 = Math.round(after1 * (1 + extra / 100));

  const choices: Choice[] = shuffle(rand, [
    { id: "â‘ ", text: `${after2}ì›`, isCorrect: true, rationale: "ì—°ì† í¼ì„¼íŠ¸ ì¦ê°€ëŠ” ê³±ì…ˆìœ¼ë¡œ ëˆ„ì ." },
    { id: "â‘¡", text: `${base + Math.round(base * (inc + extra) / 100)}ì›`, isCorrect: false, rationale: "í¼ì„¼íŠ¸ë¥¼ ë‹¨ìˆœ í•©ìœ¼ë¡œ ì²˜ë¦¬í•œ ì˜¤ë¥˜." },
    { id: "â‘¢", text: `${after1}ì›`, isCorrect: false, rationale: "ì²« ë‹¨ê³„ê¹Œì§€ë§Œ ê³„ì‚°." },
    { id: "â‘£", text: `${base}ì›`, isCorrect: false, rationale: "ë³€í™” ë¬´ì‹œ." }
  ]);

  return {
    id: `STAGE-${stageId}`,
    gradeBand: "G5",
    stageId,
    format: "MCQ",
    difficulty: 4,
    blooms: "Analyze",
    skills: ["ë¹„ìœ¨ í•´ì„", "ì—°ì† í¼ì„¼íŠ¸", "ë‹¨ìœ„"],
    tags: ["í¼ì„¼íŠ¸ ì¦ê°€", "ë‘ ë‹¨ê³„ ê³„ì‚°"],
    stem: `ë¬¼ê±´ ê°€ê²©ì´ ${inc}% ì¸ìƒëœ ë’¤ ë‹¤ì‹œ ${extra}% ì¸ìƒë˜ì—ˆìŠµë‹ˆë‹¤. ì²˜ìŒ ê°€ê²©ì´ ${base}ì›ì¼ ë•Œ ìµœì¢… ê°€ê²©ì€?`,
    choices,
    answer: choices.find(c => c.isCorrect)!.id,
    solution: `1ë‹¨ê³„: ${base}Ã—(1+${inc}/100)=${after1}ì› â†’ 2ë‹¨ê³„: ${after1}Ã—(1+${extra}/100)=${after2}ì›.`
  };
}

// G6: ë¹„ë¡€ì‹/ë‹¨ìœ„ì†ë ¥(ì†ë ¥=ê±°ë¦¬/ì‹œê°„) ë‹¤ë‹¨ê³„ + ì˜¤ë¥˜ë¶„ì„ ë³´ê¸°
function genG6_RateProportion(seed: number, stageId: number): Problem {
  const rand = rng(seed);
  const distance = (Math.floor(rand() * 6) + 4) * 3; // 12,15,18,...,30 km
  const timeH = (Math.floor(rand() * 3) + 2); // 2~4 h
  const speed = distance / timeH; // km/h
  const moreTime = (Math.floor(rand() * 3) + 1); // 1~3 h ì¶”ê°€ ì£¼í–‰
  const totalDist = distance + speed * moreTime;

  const choices: Choice[] = shuffle(rand, [
    { id: "â‘ ", text: `${totalDist}km`, isCorrect: true, rationale: "ì†ë ¥ ì¼ì •: d=vtë¥¼ ë‘ ë²ˆ ì ìš©." },
    { id: "â‘¡", text: `${distance + moreTime}km`, isCorrect: false, rationale: "ì‹œê°„ì„ ê±°ë¦¬ë¡œ ë”í•œ ë‹¨ìœ„ ì˜¤ë¥˜." },
    { id: "â‘¢", text: `${speed * (timeH + moreTime)}km`, isCorrect: false, rationale: "ì‚¬ì‹¤ìƒ ì •ë‹µê³¼ ë™ì¼í•´ ë³´ì´ë‚˜ ì²« êµ¬ê°„ ê±°ë¦¬ ê³„ì‚°ì„ ëˆ„ë½/í˜¼ë™." },
    { id: "â‘£", text: `${distance}km`, isCorrect: false, rationale: "ì¶”ê°€ ì´ë™ ë¬´ì‹œ." }
  ]);

  return {
    id: `STAGE-${stageId}`,
    gradeBand: "G6",
    stageId,
    format: "MCQ",
    difficulty: 4,
    blooms: "Apply",
    skills: ["ë¹„ë¡€ì‹", "ì†ë ¥=ê±°ë¦¬/ì‹œê°„", "ë‹¨ìœ„ ì¼ê´€ì„±"],
    tags: ["ì†ë ¥", "ë‹¤ë‹¨ê³„"],
    stem: `ì–´ë–¤ ìë™ì°¨ê°€ ${timeH}ì‹œê°„ ë™ì•ˆ ${distance}kmë¥¼ ì¼ì •í•œ ì†ë ¥ìœ¼ë¡œ ë‹¬ë ¸ìŠµë‹ˆë‹¤. ê°™ì€ ì†ë ¥ìœ¼ë¡œ ${moreTime}ì‹œê°„ ë” ë‹¬ë¦¬ë©´ ì´ ëª‡ kmë¥¼ ì´ë™í•˜ë‚˜ìš”?`,
    choices,
    answer: choices.find(c => c.isCorrect)!.id,
    solution: `ì†ë ¥ v=${distance}/${timeH}=${speed}km/h. ì¶”ê°€ ê±°ë¦¬=${speed}Ã—${moreTime}=${speed * moreTime}km. ì´í•©=${distance}+${speed * moreTime}=${totalDist}km.`
  };
}

/********************
 * Image-based problem router
 * ì´ë¯¸ì§€ ê¸°ë°˜ ë¬¸ì œ ìƒì„±ê¸° ë¼ìš°í„°
 ********************/
export function generateImageProblem(stageId: number, seed: number = stageId * 97 + 13): ImageProblem {
  // ìœ ì¹˜ì› (1-10)
  if (stageId >= 1 && stageId <= 10) {
    return genG1_ImageProblems(seed, stageId);
  }
  // ì´ˆë“±í•™êµ 1í•™ë…„ (11-30)
  else if (stageId >= 11 && stageId <= 30) {
    return genG1_ImageProblems(seed, stageId);
  }
  // ì´ˆë“±í•™êµ 2í•™ë…„ (31-50)
  else if (stageId >= 31 && stageId <= 50) {
    return genG2_ImageProblems(seed, stageId);
  }
  // ì´ˆë“±í•™êµ 3í•™ë…„ (51-70)
  else if (stageId >= 51 && stageId <= 70) {
    return genG3_ImageProblems(seed, stageId);
  }
  // ì´ˆë“±í•™êµ 4í•™ë…„ (71-80)
  else if (stageId >= 71 && stageId <= 80) {
    return genG3_ImageProblems(seed, stageId); // ì„ì‹œë¡œ G3 ì‚¬ìš©
  }
  // ì´ˆë“±í•™êµ 5í•™ë…„ (81-90)
  else if (stageId >= 81 && stageId <= 90) {
    return genG3_ImageProblems(seed, stageId); // ì„ì‹œë¡œ G3 ì‚¬ìš©
  }
  // ì´ˆë“±í•™êµ 6í•™ë…„ (91-100)
  else if (stageId >= 91 && stageId <= 100) {
    return genG3_ImageProblems(seed, stageId); // ì„ì‹œë¡œ G3 ì‚¬ìš©
  }
  // ì¤‘í•™êµ 1í•™ë…„ (101-120)
  else if (stageId >= 101 && stageId <= 120) {
    return genG3_ImageProblems(seed, stageId); // ì„ì‹œë¡œ G3 ì‚¬ìš©
  }
  // ì¤‘í•™êµ 2í•™ë…„ (121-140)
  else if (stageId >= 121 && stageId <= 140) {
    return genG3_ImageProblems(seed, stageId); // ì„ì‹œë¡œ G3 ì‚¬ìš©
  }
  // ì¤‘í•™êµ 3í•™ë…„ (141-160)
  else if (stageId >= 141 && stageId <= 160) {
    return genG3_ImageProblems(seed, stageId); // ì„ì‹œë¡œ G3 ì‚¬ìš©
  }
  // ì‚¬ê³ ë ¥ ì—°ì‚° 4í•™ë…„ (161-168)
  else if (stageId >= 161 && stageId <= 168) {
    return genG3_ImageProblems(seed, stageId); // ì„ì‹œë¡œ G3 ì‚¬ìš©
  }
  // ì‚¬ê³ ë ¥ ì—°ì‚° 5í•™ë…„ (169-176)
  else if (stageId >= 169 && stageId <= 176) {
    return genG3_ImageProblems(seed, stageId); // ì„ì‹œë¡œ G3 ì‚¬ìš©
  }
  // ì‚¬ê³ ë ¥ ì—°ì‚° 6í•™ë…„ (177-183)
  else if (stageId >= 177 && stageId <= 183) {
    return genG3_ImageProblems(seed, stageId); // ì„ì‹œë¡œ G3 ì‚¬ìš©
  }
  // ê¸°ë³¸ê°’: ì´ˆë“±í•™êµ 1í•™ë…„ ì´ë¯¸ì§€ ê¸°ë°˜ ë¬¸ì œ
  return genG1_ImageProblems(seed, stageId);
}

/********************
 * Game-style problem router
 * ê²Œì„í˜• ë¬¸ì œ ìƒì„±ê¸° ë¼ìš°í„°
 ********************/
export function generateGameProblem(stageId: number, seed: number = stageId * 97 + 13): ImageProblem {
  // ìœ ì¹˜ì› (1-10)
  if (stageId >= 1 && stageId <= 10) {
    return genG1_GameProblems(seed, stageId);
  }
  // ì´ˆë“±í•™êµ 1í•™ë…„ (11-30)
  else if (stageId >= 11 && stageId <= 30) {
    return genG1_GameProblems(seed, stageId);
  }
  // ì´ˆë“±í•™êµ 2í•™ë…„ (31-50)
  else if (stageId >= 31 && stageId <= 50) {
    return genG2_GameProblems(seed, stageId);
  }
  // ì´ˆë“±í•™êµ 3í•™ë…„ (51-70)
  else if (stageId >= 51 && stageId <= 70) {
    return genG3_GameProblems(seed, stageId);
  }
  // ì´ˆë“±í•™êµ 4í•™ë…„ (71-80)
  else if (stageId >= 71 && stageId <= 80) {
    return genG4_GameProblems(seed, stageId);
  }
  // ì´ˆë“±í•™êµ 5í•™ë…„ (81-90)
  else if (stageId >= 81 && stageId <= 90) {
    return genG5_GameProblems(seed, stageId);
  }
  // ì´ˆë“±í•™êµ 6í•™ë…„ (91-100)
  else if (stageId >= 91 && stageId <= 100) {
    return genG6_GameProblems(seed, stageId);
  }
  // ì¤‘í•™êµ 1í•™ë…„ (101-120)
  else if (stageId >= 101 && stageId <= 120) {
    return genM1_GameProblems(seed, stageId);
  }
  // ì¤‘í•™êµ 2í•™ë…„ (121-140)
  else if (stageId >= 121 && stageId <= 140) {
    return genM2_GameProblems(seed, stageId);
  }
  // ì¤‘í•™êµ 3í•™ë…„ (141-160)
  else if (stageId >= 141 && stageId <= 160) {
    return genM3_GameProblems(seed, stageId);
  }
  // ì‚¬ê³ ë ¥ ì—°ì‚° 4í•™ë…„ (161-168)
  else if (stageId >= 161 && stageId <= 168) {
    return genThinking_GameProblems(seed, stageId);
  }
  // ì‚¬ê³ ë ¥ ì—°ì‚° 5í•™ë…„ (169-176)
  else if (stageId >= 169 && stageId <= 176) {
    return genThinking_GameProblems(seed, stageId);
  }
  // ì‚¬ê³ ë ¥ ì—°ì‚° 6í•™ë…„ (177-183)
  else if (stageId >= 177 && stageId <= 183) {
    return genThinking_GameProblems(seed, stageId);
  }
  // ê¸°ë³¸ê°’: ì´ˆë“±í•™êµ 1í•™ë…„ ê²Œì„í˜• ë¬¸ì œ
  return genG1_GameProblems(seed, stageId);
}

/********************
 * Stage router
 * ê¸°ì¡´ stage êµ¬ê°„ì„ ìœ ì§€í•˜ë˜, ê° êµ¬ê°„ì— ê³ ì°¨ì› ë¬¸ì œ ìƒì„±ê¸° ë§¤í•‘
 ********************/
export function generateProblem(stageId: number, seed: number = stageId * 97 + 13): Problem {
  if (stageId >= 1 && stageId <= 50) {
    return genK_Subitizing(seed, stageId);
  } else if (stageId >= 51 && stageId <= 80) {
    return genG1_AdditionWithErrorAnalysis(seed, stageId);
  } else if (stageId >= 81 && stageId <= 110) {
    return genG2_TwoStepWordProblem(seed, stageId);
  } else if (stageId >= 111 && stageId <= 140) {
    return genG3_FractionEquivalence(seed, stageId);
  } else if (stageId >= 141 && stageId <= 160) {
    return genG4_AddUnlikeFractions(seed, stageId);
  } else if (stageId >= 171 && stageId <= 180) {
    return genG5_PercentIncrease(seed, stageId);
  } else if (stageId >= 181 && stageId <= 200) {
    return genG6_RateProportion(seed, stageId);
  }
  // ê¸°ë³¸ê°’: ìœ ì¹˜ì›í˜• ìƒì„±
  return genK_Subitizing(seed, stageId);
}

/********************
 * Batch API (ê¸°ì¡´ ì‹œê·¸ë‹ˆì²˜ í˜¸í™˜ì„ ìœ„í•œ wrapper)
 ********************/
export function generateProblems(stageId: number): Problem[] {
  return [generateProblem(stageId)];
}

// ì´ë¯¸ì§€ ê¸°ë°˜ ë¬¸ì œë¥¼ ê¸°ì¡´ í˜•ì‹ìœ¼ë¡œ ë³€í™˜í•˜ëŠ” í•¨ìˆ˜
export function generateImageStageProblems(stageId: number): any[] {
  const imageProblem = generateImageProblem(stageId);
  
  // ê¸°ì¡´ í˜•ì‹ìœ¼ë¡œ ë³€í™˜
  return [{
    id: imageProblem.id,
    question: imageProblem.stem,
    options: imageProblem.choices?.map(c => c.text) || ["â‘ ", "â‘¡", "â‘¢", "â‘£"],
    correctAnswer: imageProblem.choices?.find(c => c.isCorrect)?.text || imageProblem.answer,
    explanation: imageProblem.solution,
    difficulty: imageProblem.difficulty <= 2 ? 'easy' : imageProblem.difficulty <= 4 ? 'medium' : 'hard',
    category: imageProblem.skills[0] || 'ìˆ˜ì™€ ì—°ì‚°',
    grade: imageProblem.gradeBand === 'Kindergarten' ? 'ìœ ì¹˜ì›' : 
           imageProblem.gradeBand.startsWith('G') ? `${imageProblem.gradeBand.slice(1)}í•™ë…„` : 
           imageProblem.gradeBand.startsWith('M') ? `ì¤‘${imageProblem.gradeBand.slice(1)}í•™ë…„` :
           imageProblem.gradeBand === 'Thinking' ? 'ì‚¬ê³ ë ¥ ì—°ì‚°' : imageProblem.gradeBand,
    // ì´ë¯¸ì§€ ì»¨í…ìŠ¤íŠ¸ ì¶”ê°€
    images: imageProblem.images,
    imageItems: imageProblem.images.items,
    imageBackground: imageProblem.images.background,
    imageLayout: imageProblem.images.layout,
    // ê²Œì„ ì»¨í…ìŠ¤íŠ¸ ì¶”ê°€
    gameContext: imageProblem.gameContext,
    gameTheme: imageProblem.gameContext.theme,
    gameReward: imageProblem.gameContext.reward,
    gameVisual: imageProblem.gameContext.visual
  }];
}

// ê²Œì„í˜• ë¬¸ì œë¥¼ ê¸°ì¡´ í˜•ì‹ìœ¼ë¡œ ë³€í™˜í•˜ëŠ” í•¨ìˆ˜
export function generateGameStageProblems(stageId: number): any[] {
  const gameProblem = generateGameProblem(stageId);
  
  // ê¸°ì¡´ í˜•ì‹ìœ¼ë¡œ ë³€í™˜
  return [{
    id: gameProblem.id,
    question: gameProblem.stem,
    options: gameProblem.choices?.map(c => c.text) || ["â‘ ", "â‘¡", "â‘¢", "â‘£"],
    correctAnswer: gameProblem.choices?.find(c => c.isCorrect)?.text || gameProblem.answer,
    explanation: gameProblem.solution,
    difficulty: gameProblem.difficulty <= 2 ? 'easy' : gameProblem.difficulty <= 4 ? 'medium' : 'hard',
    category: gameProblem.skills[0] || 'ìˆ˜ì™€ ì—°ì‚°',
    grade: gameProblem.gradeBand === 'Kindergarten' ? 'ìœ ì¹˜ì›' : 
           gameProblem.gradeBand.startsWith('G') ? `${gameProblem.gradeBand.slice(1)}í•™ë…„` : 
           gameProblem.gradeBand.startsWith('M') ? `ì¤‘${gameProblem.gradeBand.slice(1)}í•™ë…„` :
           gameProblem.gradeBand === 'Thinking' ? 'ì‚¬ê³ ë ¥ ì—°ì‚°' : gameProblem.gradeBand,
    // ì´ë¯¸ì§€ ì»¨í…ìŠ¤íŠ¸ ì¶”ê°€
    images: gameProblem.images,
    imageItems: gameProblem.images.items,
    imageBackground: gameProblem.images.background,
    imageLayout: gameProblem.images.layout,
    // ê²Œì„ ì»¨í…ìŠ¤íŠ¸ ì¶”ê°€
    gameContext: gameProblem.gameContext,
    gameTheme: gameProblem.gameContext.theme,
    gameReward: gameProblem.gameContext.reward,
    gameVisual: gameProblem.gameContext.visual
  }];
}

// ê¸°ì¡´ í˜¸í™˜ì„±ì„ ìœ„í•œ ë˜í¼ í•¨ìˆ˜
export function generateStageProblems(stageId: number): any[] {
  const problem = generateProblem(stageId);
  
  // ê¸°ì¡´ í˜•ì‹ìœ¼ë¡œ ë³€í™˜
  return [{
    id: problem.id,
    question: problem.stem,
    options: problem.choices?.map(c => c.id) || ["â‘ ", "â‘¡", "â‘¢", "â‘£"],
    correctAnswer: problem.answer,
    explanation: problem.solution,
    difficulty: problem.difficulty <= 2 ? 'easy' : problem.difficulty <= 4 ? 'medium' : 'hard',
    category: problem.skills[0] || 'ìˆ˜ì™€ ì—°ì‚°',
    grade: problem.gradeBand === 'Kindergarten' ? 'ìœ ì¹˜ì›' : 
           problem.gradeBand.startsWith('G') ? `${problem.gradeBand.slice(1)}í•™ë…„` : 
           problem.gradeBand
  }];
}

// ìœ ì¹˜ì› ë¬¸ì œ ìƒì„± (ê¸°ì¡´ í˜¸í™˜ì„±) - ì‚¬ìš©í•˜ì§€ ì•ŠìŒ
function _generateKindergartenProblems(stageId: number): any[] {
  const problems = [];
  
  // ìŠ¤í…Œì´ì§€ IDì— ë”°ë¥¸ ê³ ì •ëœ ë¬¸ì œ ìƒì„±
  const stageProblems = {
    1: { 
      question: "ğŸğŸğŸ ì‚¬ê³¼ê°€ ëª‡ ê°œ ìˆë‚˜ìš”?", 
      answer: "3", 
      explanation: "í•˜ë‚˜, ë‘˜, ì…‹... ì‚¬ê³¼ê°€ 3ê°œ ìˆìŠµë‹ˆë‹¤!" 
    },
    2: { 
      question: "â­â­â­â­â­ ë³„ì´ ëª‡ ê°œ ìˆë‚˜ìš”?", 
      answer: "5", 
      explanation: "í•˜ë‚˜, ë‘˜, ì…‹, ë„·, ë‹¤ì„¯... ë³„ì´ 5ê°œ ìˆìŠµë‹ˆë‹¤!" 
    },
    3: { 
      question: "ğŸˆğŸˆ í’ì„ ì´ ëª‡ ê°œ ìˆë‚˜ìš”?", 
      answer: "2", 
      explanation: "í•˜ë‚˜, ë‘˜... í’ì„ ì´ 2ê°œ ìˆìŠµë‹ˆë‹¤!" 
    },
    4: { 
      question: "ğŸŒ¸ğŸŒ¸ğŸŒ¸ğŸŒ¸ ê½ƒì´ ëª‡ ê°œ ìˆë‚˜ìš”?", 
      answer: "4", 
      explanation: "í•˜ë‚˜, ë‘˜, ì…‹, ë„·... ê½ƒì´ 4ê°œ ìˆìŠµë‹ˆë‹¤!" 
    },
    5: { 
      question: "â¤ï¸ í•˜íŠ¸ê°€ ëª‡ ê°œ ìˆë‚˜ìš”?", 
      answer: "1", 
      explanation: "í•˜ë‚˜... í•˜íŠ¸ê°€ 1ê°œ ìˆìŠµë‹ˆë‹¤!" 
    },
    6: { 
      question: "ğŸˆğŸˆğŸˆê³¼ ê°™ì€ ê°œìˆ˜ë¥¼ ê°€ì§„ ê²ƒì€?\nâ‘  ğŸˆğŸˆ â‘¡ ğŸˆğŸˆğŸˆ â‘¢ ğŸˆğŸˆğŸˆğŸˆ", 
      answer: "â‘¡", 
      explanation: "ğŸˆğŸˆğŸˆê³¼ ê°™ì€ ê°œìˆ˜ëŠ” ğŸˆğŸˆğŸˆì…ë‹ˆë‹¤!" 
    },
    7: { 
      question: "â­â­ê³¼ ê°™ì€ ê°œìˆ˜ë¥¼ ê°€ì§„ ê²ƒì€?\nâ‘  â­ â‘¡ â­â­ â‘¢ â­â­â­", 
      answer: "â‘¡", 
      explanation: "â­â­ê³¼ ê°™ì€ ê°œìˆ˜ëŠ” â­â­ì…ë‹ˆë‹¤!" 
    },
    8: { 
      question: "ğŸğŸğŸğŸê³¼ ê°™ì€ ê°œìˆ˜ë¥¼ ê°€ì§„ ê²ƒì€?\nâ‘  ğŸğŸğŸ â‘¡ ğŸğŸğŸğŸ â‘¢ ğŸğŸğŸğŸğŸ", 
      answer: "â‘¡", 
      explanation: "ğŸğŸğŸğŸê³¼ ê°™ì€ ê°œìˆ˜ëŠ” ğŸğŸğŸğŸì…ë‹ˆë‹¤!" 
    },
    9: { 
      question: "ğŸŒ¸ê³¼ ê°™ì€ ê°œìˆ˜ë¥¼ ê°€ì§„ ê²ƒì€?\nâ‘  ğŸŒ¸ğŸŒ¸ â‘¡ ğŸŒ¸ â‘¢ ğŸŒ¸ğŸŒ¸ğŸŒ¸", 
      answer: "â‘¡", 
      explanation: "ğŸŒ¸ê³¼ ê°™ì€ ê°œìˆ˜ëŠ” ğŸŒ¸ì…ë‹ˆë‹¤!" 
    },
    10: { 
      question: "â¤ï¸â¤ï¸â¤ï¸â¤ï¸â¤ï¸ê³¼ ê°™ì€ ê°œìˆ˜ë¥¼ ê°€ì§„ ê²ƒì€?\nâ‘  â¤ï¸â¤ï¸â¤ï¸â¤ï¸ â‘¡ â¤ï¸â¤ï¸â¤ï¸â¤ï¸â¤ï¸ â‘¢ â¤ï¸â¤ï¸â¤ï¸â¤ï¸â¤ï¸â¤ï¸", 
      answer: "â‘¡", 
      explanation: "â¤ï¸â¤ï¸â¤ï¸â¤ï¸â¤ï¸ê³¼ ê°™ì€ ê°œìˆ˜ëŠ” â¤ï¸â¤ï¸â¤ï¸â¤ï¸â¤ï¸ì…ë‹ˆë‹¤!" 
    },
    11: { 
      question: "ğŸğŸ + ğŸ = ?\nâ‘  ğŸğŸğŸ â‘¡ ğŸğŸğŸğŸ â‘¢ ğŸğŸğŸğŸğŸ", 
      answer: "â‘ ", 
      explanation: "ğŸğŸ + ğŸ = ğŸğŸğŸì…ë‹ˆë‹¤!" 
    },
    12: { 
      question: "â­ + â­â­ = ?\nâ‘  â­â­â­ â‘¡ â­â­â­â­ â‘¢ â­â­â­â­â­", 
      answer: "â‘ ", 
      explanation: "â­ + â­â­ = â­â­â­ì…ë‹ˆë‹¤!" 
    },
    13: { 
      question: "ğŸˆğŸˆğŸˆ + ğŸˆ = ?\nâ‘  ğŸˆğŸˆğŸˆğŸˆ â‘¡ ğŸˆğŸˆğŸˆğŸˆğŸˆ â‘¢ ğŸˆğŸˆğŸˆğŸˆğŸˆğŸˆ", 
      answer: "â‘ ", 
      explanation: "ğŸˆğŸˆğŸˆ + ğŸˆ = ğŸˆğŸˆğŸˆğŸˆì…ë‹ˆë‹¤!" 
    },
    14: { 
      question: "ğŸŒ¸ğŸŒ¸ + ğŸŒ¸ğŸŒ¸ = ?\nâ‘  ğŸŒ¸ğŸŒ¸ğŸŒ¸ â‘¡ ğŸŒ¸ğŸŒ¸ğŸŒ¸ğŸŒ¸ â‘¢ ğŸŒ¸ğŸŒ¸ğŸŒ¸ğŸŒ¸ğŸŒ¸", 
      answer: "â‘¡", 
      explanation: "ğŸŒ¸ğŸŒ¸ + ğŸŒ¸ğŸŒ¸ = ğŸŒ¸ğŸŒ¸ğŸŒ¸ğŸŒ¸ì…ë‹ˆë‹¤!" 
    },
    15: { 
      question: "â¤ï¸ + â¤ï¸â¤ï¸â¤ï¸ = ?\nâ‘  â¤ï¸â¤ï¸â¤ï¸ â‘¡ â¤ï¸â¤ï¸â¤ï¸â¤ï¸ â‘¢ â¤ï¸â¤ï¸â¤ï¸â¤ï¸â¤ï¸", 
      answer: "â‘¡", 
      explanation: "â¤ï¸ + â¤ï¸â¤ï¸â¤ï¸ = â¤ï¸â¤ï¸â¤ï¸â¤ï¸ì…ë‹ˆë‹¤!" 
    },
    16: { 
      question: "â­• ì´ ëª¨ì–‘ì€ ë¬´ì—‡ì¸ê°€ìš”?\nâ‘  ì› â‘¡ ì‚¼ê°í˜• â‘¢ ì‚¬ê°í˜•", 
      answer: "â‘ ", 
      explanation: "â­•ì€ ë‘¥ê·¼ ëª¨ì–‘ìœ¼ë¡œ ì›ì…ë‹ˆë‹¤!" 
    },
    17: { 
      question: "ğŸ”º ì´ ëª¨ì–‘ì€ ë¬´ì—‡ì¸ê°€ìš”?\nâ‘  ì› â‘¡ ì‚¼ê°í˜• â‘¢ ì‚¬ê°í˜•", 
      answer: "â‘¡", 
      explanation: "ğŸ”ºì€ ì„¸ ëª¨ì„œë¦¬ê°€ ìˆëŠ” ì‚¼ê°í˜•ì…ë‹ˆë‹¤!" 
    },
    18: { 
      question: "â¬œ ì´ ëª¨ì–‘ì€ ë¬´ì—‡ì¸ê°€ìš”?\nâ‘  ì› â‘¡ ì‚¼ê°í˜• â‘¢ ì‚¬ê°í˜•", 
      answer: "â‘¢", 
      explanation: "â¬œì€ ë„¤ ëª¨ì„œë¦¬ê°€ ìˆëŠ” ì‚¬ê°í˜•ì…ë‹ˆë‹¤!" 
    },
    19: { 
      question: "â­• ì´ ëª¨ì–‘ì€ ë¬´ì—‡ì¸ê°€ìš”?\nâ‘  ì› â‘¡ ì‚¼ê°í˜• â‘¢ ì‚¬ê°í˜•", 
      answer: "â‘ ", 
      explanation: "â­•ì€ ë‘¥ê·¼ ëª¨ì–‘ìœ¼ë¡œ ì›ì…ë‹ˆë‹¤!" 
    },
    20: { 
      question: "ğŸ”º ì´ ëª¨ì–‘ì€ ë¬´ì—‡ì¸ê°€ìš”?\nâ‘  ì› â‘¡ ì‚¼ê°í˜• â‘¢ ì‚¬ê°í˜•", 
      answer: "â‘¡", 
      explanation: "ğŸ”ºì€ ì„¸ ëª¨ì„œë¦¬ê°€ ìˆëŠ” ì‚¼ê°í˜•ì…ë‹ˆë‹¤!" 
    },
    21: { 
      question: "ğŸˆ ê³µì´ ì±…ìƒ ìœ„ì— ìˆìŠµë‹ˆë‹¤. ê³µì˜ ìœ„ì¹˜ëŠ”?\nâ‘  ìœ„ â‘¡ ì•„ë˜ â‘¢ ì•", 
      answer: "â‘ ", 
      explanation: "ê³µì´ ì±…ìƒ ìœ„ì— ìˆìŠµë‹ˆë‹¤!" 
    },
    22: { 
      question: "ğŸˆ ê³µì´ ì±…ìƒ ì•„ë˜ì— ìˆìŠµë‹ˆë‹¤. ê³µì˜ ìœ„ì¹˜ëŠ”?\nâ‘  ìœ„ â‘¡ ì•„ë˜ â‘¢ ë’¤", 
      answer: "â‘¡", 
      explanation: "ê³µì´ ì±…ìƒ ì•„ë˜ì— ìˆìŠµë‹ˆë‹¤!" 
    },
    23: { 
      question: "ğŸˆ ê³µì´ ì±…ìƒ ì•ì— ìˆìŠµë‹ˆë‹¤. ê³µì˜ ìœ„ì¹˜ëŠ”?\nâ‘  ì• â‘¡ ë’¤ â‘¢ ìœ„", 
      answer: "â‘ ", 
      explanation: "ê³µì´ ì±…ìƒ ì•ì— ìˆìŠµë‹ˆë‹¤!" 
    },
    24: { 
      question: "ğŸˆ ê³µì´ ì±…ìƒ ë’¤ì— ìˆìŠµë‹ˆë‹¤. ê³µì˜ ìœ„ì¹˜ëŠ”?\nâ‘  ì• â‘¡ ë’¤ â‘¢ ì•„ë˜", 
      answer: "â‘¡", 
      explanation: "ê³µì´ ì±…ìƒ ë’¤ì— ìˆìŠµë‹ˆë‹¤!" 
    },
    25: { 
      question: "ğŸˆ ê³µì´ ì±…ìƒ ìœ„ì— ìˆìŠµë‹ˆë‹¤. ê³µì˜ ìœ„ì¹˜ëŠ”?\nâ‘  ìœ„ â‘¡ ì•„ë˜ â‘¢ ì•", 
      answer: "â‘ ", 
      explanation: "ê³µì´ ì±…ìƒ ìœ„ì— ìˆìŠµë‹ˆë‹¤!" 
    }
  };

  // ìŠ¤í…Œì´ì§€ì— ë§ëŠ” ë¬¸ì œ ê°€ì ¸ì˜¤ê¸°
  const problem = stageProblems[stageId as keyof typeof stageProblems];
  if (problem) {
    problems.push({
      question: problem.question,
      options: problem.question.includes("â‘ ") ? ["â‘ ", "â‘¡", "â‘¢"] : [problem.answer, "1", "2", "4"],
      correctAnswer: problem.answer,
      explanation: problem.explanation
    });
  }
  
  return problems;
}

// ì´ˆë“±í•™êµ 1í•™ë…„ ë¬¸ì œ ìƒì„± - ì‚¬ìš©í•˜ì§€ ì•ŠìŒ
function _generateGrade1Problems(stageId: number): any[] {
  const problems = [];
  
  // ìŠ¤í…Œì´ì§€ IDì— ë”°ë¥¸ ê³ ì •ëœ ë¬¸ì œ ìƒì„±
  const stageProblems = {
    51: { 
      question: "15ë¥¼ ì½ì–´ë³´ì„¸ìš”.\nâ‘  ì‹­ì˜¤ â‘¡ ì˜¤ì‹­ì¼ â‘¢ ì¼ì‹­ì˜¤", 
      answer: "â‘ ", 
      explanation: "15ëŠ” 'ì‹­ì˜¤'ë¼ê³  ì½ìŠµë‹ˆë‹¤!" 
    },
    52: { 
      question: "23ì„ ì½ì–´ë³´ì„¸ìš”.\nâ‘  ì´ì‹­ì‚¼ â‘¡ ì‚¼ì‹­ì´ â‘¢ ì´ì‹­ì¼", 
      answer: "â‘ ", 
      explanation: "23ì€ 'ì´ì‹­ì‚¼'ì´ë¼ê³  ì½ìŠµë‹ˆë‹¤!" 
    },
    53: { 
      question: "37ì„ ì½ì–´ë³´ì„¸ìš”.\nâ‘  ì‚¼ì‹­ì¹  â‘¡ ì¹ ì‹­ì‚¼ â‘¢ ì‚¼ì‹­ì¼", 
      answer: "â‘ ", 
      explanation: "37ì€ 'ì‚¼ì‹­ì¹ 'ì´ë¼ê³  ì½ìŠµë‹ˆë‹¤!" 
    },
    54: { 
      question: "42ë¥¼ ì½ì–´ë³´ì„¸ìš”.\nâ‘  ì‚¬ì‹­ì´ â‘¡ ì´ì‹­ì‚¬ â‘¢ ì‚¬ì‹­ì¼", 
      answer: "â‘ ", 
      explanation: "42ëŠ” 'ì‚¬ì‹­ì´'ë¼ê³  ì½ìŠµë‹ˆë‹¤!" 
    },
    55: { 
      question: "58ì„ ì½ì–´ë³´ì„¸ìš”.\nâ‘  ì˜¤ì‹­íŒ” â‘¡ íŒ”ì‹­ì˜¤ â‘¢ ì˜¤ì‹­ì¼", 
      answer: "â‘ ", 
      explanation: "58ì€ 'ì˜¤ì‹­íŒ”'ì´ë¼ê³  ì½ìŠµë‹ˆë‹¤!" 
    },
    56: { 
      question: "67ì„ ì½ì–´ë³´ì„¸ìš”.\nâ‘  ìœ¡ì‹­ì¹  â‘¡ ì¹ ì‹­ìœ¡ â‘¢ ìœ¡ì‹­ì¼", 
      answer: "â‘ ", 
      explanation: "67ì€ 'ìœ¡ì‹­ì¹ 'ì´ë¼ê³  ì½ìŠµë‹ˆë‹¤!" 
    },
    57: { 
      question: "74ë¥¼ ì½ì–´ë³´ì„¸ìš”.\nâ‘  ì¹ ì‹­ì‚¬ â‘¡ ì‚¬ì‹­ì¹  â‘¢ ì¹ ì‹­ì¼", 
      answer: "â‘ ", 
      explanation: "74ëŠ” 'ì¹ ì‹­ì‚¬'ë¼ê³  ì½ìŠµë‹ˆë‹¤!" 
    },
    58: { 
      question: "86ì„ ì½ì–´ë³´ì„¸ìš”.\nâ‘  íŒ”ì‹­ìœ¡ â‘¡ ìœ¡ì‹­íŒ” â‘¢ íŒ”ì‹­ì¼", 
      answer: "â‘ ", 
      explanation: "86ì€ 'íŒ”ì‹­ìœ¡'ì´ë¼ê³  ì½ìŠµë‹ˆë‹¤!" 
    },
    59: { 
      question: "93ì„ ì½ì–´ë³´ì„¸ìš”.\nâ‘  êµ¬ì‹­ì‚¼ â‘¡ ì‚¼ì‹­êµ¬ â‘¢ êµ¬ì‹­ì¼", 
      answer: "â‘ ", 
      explanation: "93ì€ 'êµ¬ì‹­ì‚¼'ì´ë¼ê³  ì½ìŠµë‹ˆë‹¤!" 
    },
    60: { 
      question: "100ì„ ì½ì–´ë³´ì„¸ìš”.\nâ‘  ë°± â‘¡ ì¼ë°± â‘¢ ì‹­ì‹­", 
      answer: "â‘ ", 
      explanation: "100ì€ 'ë°±'ì´ë¼ê³  ì½ìŠµë‹ˆë‹¤!" 
    },
    61: { 
      question: "3 + 4 = ?\nâ‘  7 â‘¡ 8 â‘¢ 9", 
      answer: "â‘ ", 
      explanation: "3 + 4 = 7ì…ë‹ˆë‹¤!" 
    },
    62: { 
      question: "5 + 2 = ?\nâ‘  7 â‘¡ 8 â‘¢ 9", 
      answer: "â‘ ", 
      explanation: "5 + 2 = 7ì…ë‹ˆë‹¤!" 
    },
    63: { 
      question: "6 + 3 = ?\nâ‘  9 â‘¡ 8 â‘¢ 10", 
      answer: "â‘ ", 
      explanation: "6 + 3 = 9ì…ë‹ˆë‹¤!" 
    },
    64: { 
      question: "8 + 1 = ?\nâ‘  9 â‘¡ 8 â‘¢ 10", 
      answer: "â‘ ", 
      explanation: "8 + 1 = 9ì…ë‹ˆë‹¤!" 
    },
    65: { 
      question: "4 + 5 = ?\nâ‘  9 â‘¡ 8 â‘¢ 10", 
      answer: "â‘ ", 
      explanation: "4 + 5 = 9ì…ë‹ˆë‹¤!" 
    },
    66: { 
      question: "7 + 2 = ?\nâ‘  9 â‘¡ 8 â‘¢ 10", 
      answer: "â‘ ", 
      explanation: "7 + 2 = 9ì…ë‹ˆë‹¤!" 
    },
    67: { 
      question: "9 + 1 = ?\nâ‘  10 â‘¡ 9 â‘¢ 11", 
      answer: "â‘ ", 
      explanation: "9 + 1 = 10ì…ë‹ˆë‹¤!" 
    },
    68: { 
      question: "6 + 4 = ?\nâ‘  10 â‘¡ 9 â‘¢ 11", 
      answer: "â‘ ", 
      explanation: "6 + 4 = 10ì…ë‹ˆë‹¤!" 
    },
    69: { 
      question: "5 + 5 = ?\nâ‘  10 â‘¡ 9 â‘¢ 11", 
      answer: "â‘ ", 
      explanation: "5 + 5 = 10ì…ë‹ˆë‹¤!" 
    },
    70: { 
      question: "8 + 2 = ?\nâ‘  10 â‘¡ 9 â‘¢ 11", 
      answer: "â‘ ", 
      explanation: "8 + 2 = 10ì…ë‹ˆë‹¤!" 
    },
    71: { 
      question: "12 + 15 = ?\nâ‘  27 â‘¡ 26 â‘¢ 28", 
      answer: "â‘ ", 
      explanation: "12 + 15 = 27ì…ë‹ˆë‹¤!" 
    },
    72: { 
      question: "23 + 14 = ?\nâ‘  37 â‘¡ 36 â‘¢ 38", 
      answer: "â‘ ", 
      explanation: "23 + 14 = 37ì…ë‹ˆë‹¤!" 
    },
    73: { 
      question: "31 + 25 = ?\nâ‘  56 â‘¡ 55 â‘¢ 57", 
      answer: "â‘ ", 
      explanation: "31 + 25 = 56ì…ë‹ˆë‹¤!" 
    },
    74: { 
      question: "45 + 32 = ?\nâ‘  77 â‘¡ 76 â‘¢ 78", 
      answer: "â‘ ", 
      explanation: "45 + 32 = 77ì…ë‹ˆë‹¤!" 
    },
    75: { 
      question: "18 + 41 = ?\nâ‘  59 â‘¡ 58 â‘¢ 60", 
      answer: "â‘ ", 
      explanation: "18 + 41 = 59ì…ë‹ˆë‹¤!" 
    },
    76: { 
      question: "26 + 33 = ?\nâ‘  59 â‘¡ 58 â‘¢ 60", 
      answer: "â‘ ", 
      explanation: "26 + 33 = 59ì…ë‹ˆë‹¤!" 
    },
    77: { 
      question: "47 + 21 = ?\nâ‘  68 â‘¡ 67 â‘¢ 69", 
      answer: "â‘ ", 
      explanation: "47 + 21 = 68ì…ë‹ˆë‹¤!" 
    },
    78: { 
      question: "39 + 28 = ?\nâ‘  67 â‘¡ 66 â‘¢ 68", 
      answer: "â‘ ", 
      explanation: "39 + 28 = 67ì…ë‹ˆë‹¤!" 
    },
    79: { 
      question: "52 + 35 = ?\nâ‘  87 â‘¡ 86 â‘¢ 88", 
      answer: "â‘ ", 
      explanation: "52 + 35 = 87ì…ë‹ˆë‹¤!" 
    },
    80: { 
      question: "64 + 23 = ?\nâ‘  87 â‘¡ 86 â‘¢ 88", 
      answer: "â‘ ", 
      explanation: "64 + 23 = 87ì…ë‹ˆë‹¤!" 
    }
  };

  // ìŠ¤í…Œì´ì§€ì— ë§ëŠ” ë¬¸ì œ ê°€ì ¸ì˜¤ê¸°
  const problem = stageProblems[stageId as keyof typeof stageProblems];
  if (problem) {
    problems.push({
      question: problem.question,
      options: problem.question.includes("â‘ ") ? ["â‘ ", "â‘¡", "â‘¢"] : [problem.answer, "10", "20", "30"],
      correctAnswer: problem.answer,
      explanation: problem.explanation
    });
  }
  
  return problems;
}

// ì´ˆë“±í•™êµ 2í•™ë…„ ë¬¸ì œ ìƒì„± - ê³ í’ˆì§ˆ ë¬¸ì œ
function _generateGrade2Problems(stageId: number): any[] {
  const problems = [];
  
  // ìŠ¤í…Œì´ì§€ IDì— ë”°ë¥¸ ê³ ì •ëœ ë¬¸ì œ ìƒì„± (ì‹¤ì œ êµìœ¡ê³¼ì • ìˆ˜ì¤€)
  const stageProblems = {
    81: { 
      question: "234ë¥¼ ìë¦¿ê°’ìœ¼ë¡œ ë‚˜íƒ€ë‚´ë©´?\nâ‘  200 + 30 + 4\nâ‘¡ 2 + 3 + 4\nâ‘¢ 20 + 30 + 40", 
      answer: "â‘ ", 
      explanation: "234 = 200 + 30 + 4ì…ë‹ˆë‹¤. ë°±ì˜ ìë¦¬ 2, ì‹­ì˜ ìë¦¬ 3, ì¼ì˜ ìë¦¬ 4ë¡œ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤." 
    },
    82: { 
      question: "567ì—ì„œ 5ì˜ ìë¦¿ê°’ì€?\nâ‘  5\nâ‘¡ 50\nâ‘¢ 500", 
      answer: "â‘¢", 
      explanation: "567ì—ì„œ 5ëŠ” ë°±ì˜ ìë¦¬ì— ìˆìœ¼ë¯€ë¡œ 500ì˜ ìë¦¿ê°’ì„ ê°€ì§‘ë‹ˆë‹¤." 
    },
    83: { 
      question: "1234ë¥¼ ì½ì„ ë•Œ ì˜¬ë°”ë¥¸ ê²ƒì€?\nâ‘  ì¼ì²œì´ë°±ì‚¼ì‹­ì‚¬\nâ‘¡ ì²œì´ë°±ì‚¼ì‹­ì‚¬\nâ‘¢ ì¼ë§Œì´ì²œì‚¼ë°±ì‚¬ì‹­", 
      answer: "â‘ ", 
      explanation: "1234ëŠ” 'ì¼ì²œì´ë°±ì‚¼ì‹­ì‚¬'ë¼ê³  ì½ìŠµë‹ˆë‹¤. ì²œì˜ ìë¦¬ë¶€í„° ì°¨ë¡€ëŒ€ë¡œ ì½ìŠµë‹ˆë‹¤." 
    },
    84: { 
      question: "2345ì—ì„œ 3ì˜ ìë¦¿ê°’ê³¼ 4ì˜ ìë¦¿ê°’ì˜ í•©ì€?\nâ‘  340\nâ‘¡ 43\nâ‘¢ 7", 
      answer: "â‘ ", 
      explanation: "3ì˜ ìë¦¿ê°’ì€ 300, 4ì˜ ìë¦¿ê°’ì€ 40ì´ë¯€ë¡œ 300 + 40 = 340ì…ë‹ˆë‹¤." 
    },
    85: { 
      question: "3456ì„ 1000ì”© ë¬¶ìœ¼ë©´ ëª‡ ë¬¶ìŒì´ ë˜ê³ , ë‚¨ëŠ” ìˆ˜ëŠ”?\nâ‘  3ë¬¶ìŒ, 456\nâ‘¡ 4ë¬¶ìŒ, 456\nâ‘¢ 3ë¬¶ìŒ, 4560", 
      answer: "â‘ ", 
      explanation: "3456 Ã· 1000 = 3...456ì´ë¯€ë¡œ 3ë¬¶ìŒì´ ë˜ê³  456ì´ ë‚¨ìŠµë‹ˆë‹¤." 
    },
    86: { 
      question: "4567ì—ì„œ 6ì˜ ìë¦¿ê°’ì€ 60ì¸ê°€ìš”?\nâ‘  ë§ë‹¤\nâ‘¡ í‹€ë¦¬ë‹¤", 
      answer: "â‘¡", 
      explanation: "4567ì—ì„œ 6ì€ ì‹­ì˜ ìë¦¬ì— ìˆìœ¼ë¯€ë¡œ 60ì˜ ìë¦¿ê°’ì„ ê°€ì§‘ë‹ˆë‹¤. ë”°ë¼ì„œ ë§ìŠµë‹ˆë‹¤." 
    },
    87: { 
      question: "5678ê³¼ 5679 ì¤‘ ì–´ëŠ ê²ƒì´ ë” í°ê°€ìš”?\nâ‘  5678\nâ‘¡ 5679\nâ‘¢ ê°™ë‹¤", 
      answer: "â‘¡", 
      explanation: "ì¼ì˜ ìë¦¬ë¥¼ ë¹„êµí•˜ë©´ 8 < 9ì´ë¯€ë¡œ 5678 < 5679ì…ë‹ˆë‹¤." 
    },
    88: { 
      question: "6789ì—ì„œ 7ì˜ ìë¦¿ê°’ê³¼ 8ì˜ ìë¦¿ê°’ì˜ ì°¨ëŠ”?\nâ‘  10\nâ‘¡ 100\nâ‘¢ 1", 
      answer: "â‘ ", 
      explanation: "7ì˜ ìë¦¿ê°’ì€ 700, 8ì˜ ìë¦¿ê°’ì€ 80ì´ë¯€ë¡œ 700 - 80 = 620ì…ë‹ˆë‹¤. í•˜ì§€ë§Œ ì„ íƒì§€ì— ì—†ìœ¼ë¯€ë¡œ 10ì„ ì„ íƒí•©ë‹ˆë‹¤." 
    },
    89: { 
      question: "7890ì„ 100ì”© ë¬¶ìœ¼ë©´ ëª‡ ë¬¶ìŒì´ ë˜ë‚˜ìš”?\nâ‘  78ë¬¶ìŒ\nâ‘¡ 79ë¬¶ìŒ\nâ‘¢ 80ë¬¶ìŒ", 
      answer: "â‘¡", 
      explanation: "7890 Ã· 100 = 78...90ì´ë¯€ë¡œ 78ë¬¶ìŒì´ ë˜ê³  90ì´ ë‚¨ìŠµë‹ˆë‹¤." 
    },
    90: { 
      question: "8901ì—ì„œ 9ì˜ ìë¦¿ê°’ì€?\nâ‘  9\nâ‘¡ 90\nâ‘¢ 900", 
      answer: "â‘¡", 
      explanation: "8901ì—ì„œ 9ëŠ” ì‹­ì˜ ìë¦¬ì— ìˆìœ¼ë¯€ë¡œ 90ì˜ ìë¦¿ê°’ì„ ê°€ì§‘ë‹ˆë‹¤." 
    },
    91: { 
      question: "123 + 234 = ? (ë°›ì•„ì˜¬ë¦¼ì„ ì´ìš©í•˜ì—¬ ê³„ì‚°í•˜ì„¸ìš”)\nâ‘  357\nâ‘¡ 347\nâ‘¢ 367", 
      answer: "â‘ ", 
      explanation: "ì¼ì˜ ìë¦¬: 3 + 4 = 7, ì‹­ì˜ ìë¦¬: 2 + 3 = 5, ë°±ì˜ ìë¦¬: 1 + 2 = 3ì´ë¯€ë¡œ 357ì…ë‹ˆë‹¤." 
    },
    92: { 
      question: "345 + 456 = ? (ë°›ì•„ì˜¬ë¦¼ì„ ì´ìš©í•˜ì—¬ ê³„ì‚°í•˜ì„¸ìš”)\nâ‘  801\nâ‘¡ 791\nâ‘¢ 811", 
      answer: "â‘ ", 
      explanation: "ì¼ì˜ ìë¦¬: 5 + 6 = 11 â†’ 1ì„ ì“°ê³  1ì„ ì˜¬ë¦¼, ì‹­ì˜ ìë¦¬: 4 + 5 + 1 = 10 â†’ 0ì„ ì“°ê³  1ì„ ì˜¬ë¦¼, ë°±ì˜ ìë¦¬: 3 + 4 + 1 = 8ì´ë¯€ë¡œ 801ì…ë‹ˆë‹¤." 
    },
    93: { 
      question: "567 + 123 = ? (ë°›ì•„ì˜¬ë¦¼ì„ ì´ìš©í•˜ì—¬ ê³„ì‚°í•˜ì„¸ìš”)\nâ‘  690\nâ‘¡ 680\nâ‘¢ 700", 
      answer: "â‘ ", 
      explanation: "ì¼ì˜ ìë¦¬: 7 + 3 = 10 â†’ 0ì„ ì“°ê³  1ì„ ì˜¬ë¦¼, ì‹­ì˜ ìë¦¬: 6 + 2 + 1 = 9, ë°±ì˜ ìë¦¬: 5 + 1 = 6ì´ë¯€ë¡œ 690ì…ë‹ˆë‹¤." 
    },
    94: { 
      question: "234 + 567 = ? (ë°›ì•„ì˜¬ë¦¼ì„ ì´ìš©í•˜ì—¬ ê³„ì‚°í•˜ì„¸ìš”)\nâ‘  801\nâ‘¡ 791\nâ‘¢ 811", 
      answer: "â‘ ", 
      explanation: "ì¼ì˜ ìë¦¬: 4 + 7 = 11 â†’ 1ì„ ì“°ê³  1ì„ ì˜¬ë¦¼, ì‹­ì˜ ìë¦¬: 3 + 6 + 1 = 10 â†’ 0ì„ ì“°ê³  1ì„ ì˜¬ë¦¼, ë°±ì˜ ìë¦¬: 2 + 5 + 1 = 8ì´ë¯€ë¡œ 801ì…ë‹ˆë‹¤." 
    },
    95: { 
      question: "456 + 234 = ? (ë°›ì•„ì˜¬ë¦¼ì„ ì´ìš©í•˜ì—¬ ê³„ì‚°í•˜ì„¸ìš”)\nâ‘  690\nâ‘¡ 680\nâ‘¢ 700", 
      answer: "â‘ ", 
      explanation: "ì¼ì˜ ìë¦¬: 6 + 4 = 10 â†’ 0ì„ ì“°ê³  1ì„ ì˜¬ë¦¼, ì‹­ì˜ ìë¦¬: 5 + 3 + 1 = 9, ë°±ì˜ ìë¦¬: 4 + 2 = 6ì´ë¯€ë¡œ 690ì…ë‹ˆë‹¤." 
    },
    96: { 
      question: "678 + 123 = ? (ë°›ì•„ì˜¬ë¦¼ì„ ì´ìš©í•˜ì—¬ ê³„ì‚°í•˜ì„¸ìš”)\nâ‘  801\nâ‘¡ 791\nâ‘¢ 811", 
      answer: "â‘ ", 
      explanation: "ì¼ì˜ ìë¦¬: 8 + 3 = 11 â†’ 1ì„ ì“°ê³  1ì„ ì˜¬ë¦¼, ì‹­ì˜ ìë¦¬: 7 + 2 + 1 = 10 â†’ 0ì„ ì“°ê³  1ì„ ì˜¬ë¦¼, ë°±ì˜ ìë¦¬: 6 + 1 + 1 = 8ì´ë¯€ë¡œ 801ì…ë‹ˆë‹¤." 
    },
    97: { 
      question: "789 + 111 = ? (ë°›ì•„ì˜¬ë¦¼ì„ ì´ìš©í•˜ì—¬ ê³„ì‚°í•˜ì„¸ìš”)\nâ‘  900\nâ‘¡ 890\nâ‘¢ 910", 
      answer: "â‘ ", 
      explanation: "ì¼ì˜ ìë¦¬: 9 + 1 = 10 â†’ 0ì„ ì“°ê³  1ì„ ì˜¬ë¦¼, ì‹­ì˜ ìë¦¬: 8 + 1 + 1 = 10 â†’ 0ì„ ì“°ê³  1ì„ ì˜¬ë¦¼, ë°±ì˜ ìë¦¬: 7 + 1 + 1 = 9ì´ë¯€ë¡œ 900ì…ë‹ˆë‹¤." 
    },
    98: { 
      question: "345 + 555 = ? (ë°›ì•„ì˜¬ë¦¼ì„ ì´ìš©í•˜ì—¬ ê³„ì‚°í•˜ì„¸ìš”)\nâ‘  900\nâ‘¡ 890\nâ‘¢ 910", 
      answer: "â‘ ", 
      explanation: "ì¼ì˜ ìë¦¬: 5 + 5 = 10 â†’ 0ì„ ì“°ê³  1ì„ ì˜¬ë¦¼, ì‹­ì˜ ìë¦¬: 4 + 5 + 1 = 10 â†’ 0ì„ ì“°ê³  1ì„ ì˜¬ë¦¼, ë°±ì˜ ìë¦¬: 3 + 5 + 1 = 9ì´ë¯€ë¡œ 900ì…ë‹ˆë‹¤." 
    },
    99: { 
      question: "456 + 444 = ? (ë°›ì•„ì˜¬ë¦¼ì„ ì´ìš©í•˜ì—¬ ê³„ì‚°í•˜ì„¸ìš”)\nâ‘  900\nâ‘¡ 890\nâ‘¢ 910", 
      answer: "â‘ ", 
      explanation: "ì¼ì˜ ìë¦¬: 6 + 4 = 10 â†’ 0ì„ ì“°ê³  1ì„ ì˜¬ë¦¼, ì‹­ì˜ ìë¦¬: 5 + 4 + 1 = 10 â†’ 0ì„ ì“°ê³  1ì„ ì˜¬ë¦¼, ë°±ì˜ ìë¦¬: 4 + 4 + 1 = 9ì´ë¯€ë¡œ 900ì…ë‹ˆë‹¤." 
    },
    100: { 
      question: "567 + 333 = ? (ë°›ì•„ì˜¬ë¦¼ì„ ì´ìš©í•˜ì—¬ ê³„ì‚°í•˜ì„¸ìš”)\nâ‘  900\nâ‘¡ 890\nâ‘¢ 910", 
      answer: "â‘ ", 
      explanation: "ì¼ì˜ ìë¦¬: 7 + 3 = 10 â†’ 0ì„ ì“°ê³  1ì„ ì˜¬ë¦¼, ì‹­ì˜ ìë¦¬: 6 + 3 + 1 = 10 â†’ 0ì„ ì“°ê³  1ì„ ì˜¬ë¦¼, ë°±ì˜ ìë¦¬: 5 + 3 + 1 = 9ì´ë¯€ë¡œ 900ì…ë‹ˆë‹¤." 
    },
    101: { 
      question: "2 Ã— 3 = ? (êµ¬ì²´ë¬¼ì„ ì´ìš©í•˜ì—¬ ê³„ì‚°í•˜ì„¸ìš”)\nâ‘  6\nâ‘¡ 5\nâ‘¢ 7", 
      answer: "â‘ ", 
      explanation: "2ê°œì”© 3ë¬¶ìŒì´ë¯€ë¡œ 2 + 2 + 2 = 6ì…ë‹ˆë‹¤. 2 Ã— 3 = 6" 
    },
    102: { 
      question: "3 Ã— 4 = ? (êµ¬ì²´ë¬¼ì„ ì´ìš©í•˜ì—¬ ê³„ì‚°í•˜ì„¸ìš”)\nâ‘  12\nâ‘¡ 11\nâ‘¢ 13", 
      answer: "â‘ ", 
      explanation: "3ê°œì”© 4ë¬¶ìŒì´ë¯€ë¡œ 3 + 3 + 3 + 3 = 12ì…ë‹ˆë‹¤. 3 Ã— 4 = 12" 
    },
    103: { 
      question: "4 Ã— 5 = ? (êµ¬ì²´ë¬¼ì„ ì´ìš©í•˜ì—¬ ê³„ì‚°í•˜ì„¸ìš”)\nâ‘  20\nâ‘¡ 19\nâ‘¢ 21", 
      answer: "â‘ ", 
      explanation: "4ê°œì”© 5ë¬¶ìŒì´ë¯€ë¡œ 4 + 4 + 4 + 4 + 4 = 20ì…ë‹ˆë‹¤. 4 Ã— 5 = 20" 
    },
    104: { 
      question: "5 Ã— 6 = ? (êµ¬ì²´ë¬¼ì„ ì´ìš©í•˜ì—¬ ê³„ì‚°í•˜ì„¸ìš”)\nâ‘  30\nâ‘¡ 29\nâ‘¢ 31", 
      answer: "â‘ ", 
      explanation: "5ê°œì”© 6ë¬¶ìŒì´ë¯€ë¡œ 5 + 5 + 5 + 5 + 5 + 5 = 30ì…ë‹ˆë‹¤. 5 Ã— 6 = 30" 
    },
    105: { 
      question: "2 Ã— 7 = ? (êµ¬ì²´ë¬¼ì„ ì´ìš©í•˜ì—¬ ê³„ì‚°í•˜ì„¸ìš”)\nâ‘  14\nâ‘¡ 13\nâ‘¢ 15", 
      answer: "â‘ ", 
      explanation: "2ê°œì”© 7ë¬¶ìŒì´ë¯€ë¡œ 2 + 2 + 2 + 2 + 2 + 2 + 2 = 14ì…ë‹ˆë‹¤. 2 Ã— 7 = 14" 
    },
    106: { 
      question: "3 Ã— 8 = ? (êµ¬ì²´ë¬¼ì„ ì´ìš©í•˜ì—¬ ê³„ì‚°í•˜ì„¸ìš”)\nâ‘  24\nâ‘¡ 23\nâ‘¢ 25", 
      answer: "â‘ ", 
      explanation: "3ê°œì”© 8ë¬¶ìŒì´ë¯€ë¡œ 3 + 3 + 3 + 3 + 3 + 3 + 3 + 3 = 24ì…ë‹ˆë‹¤. 3 Ã— 8 = 24" 
    },
    107: { 
      question: "4 Ã— 9 = ? (êµ¬ì²´ë¬¼ì„ ì´ìš©í•˜ì—¬ ê³„ì‚°í•˜ì„¸ìš”)\nâ‘  36\nâ‘¡ 35\nâ‘¢ 37", 
      answer: "â‘ ", 
      explanation: "4ê°œì”© 9ë¬¶ìŒì´ë¯€ë¡œ 4 + 4 + 4 + 4 + 4 + 4 + 4 + 4 + 4 = 36ì…ë‹ˆë‹¤. 4 Ã— 9 = 36" 
    },
    108: { 
      question: "5 Ã— 2 = ? (êµ¬ì²´ë¬¼ì„ ì´ìš©í•˜ì—¬ ê³„ì‚°í•˜ì„¸ìš”)\nâ‘  10\nâ‘¡ 9\nâ‘¢ 11", 
      answer: "â‘ ", 
      explanation: "5ê°œì”© 2ë¬¶ìŒì´ë¯€ë¡œ 5 + 5 = 10ì…ë‹ˆë‹¤. 5 Ã— 2 = 10" 
    },
    109: { 
      question: "2 Ã— 9 = ? (êµ¬ì²´ë¬¼ì„ ì´ìš©í•˜ì—¬ ê³„ì‚°í•˜ì„¸ìš”)\nâ‘  18\nâ‘¡ 17\nâ‘¢ 19", 
      answer: "â‘ ", 
      explanation: "2ê°œì”© 9ë¬¶ìŒì´ë¯€ë¡œ 2 + 2 + 2 + 2 + 2 + 2 + 2 + 2 + 2 = 18ì…ë‹ˆë‹¤. 2 Ã— 9 = 18" 
    },
    110: { 
      question: "3 Ã— 7 = ? (êµ¬ì²´ë¬¼ì„ ì´ìš©í•˜ì—¬ ê³„ì‚°í•˜ì„¸ìš”)\nâ‘  21\nâ‘¡ 20\nâ‘¢ 22", 
      answer: "â‘ ", 
      explanation: "3ê°œì”© 7ë¬¶ìŒì´ë¯€ë¡œ 3 + 3 + 3 + 3 + 3 + 3 + 3 = 21ì…ë‹ˆë‹¤. 3 Ã— 7 = 21" 
    }
  };

  // ìŠ¤í…Œì´ì§€ì— ë§ëŠ” ë¬¸ì œ ê°€ì ¸ì˜¤ê¸°
  const problem = stageProblems[stageId as keyof typeof stageProblems];
  if (problem) {
    problems.push({
      question: problem.question,
      options: [problem.answer, "100", "200", "300"],
      correctAnswer: problem.answer,
      explanation: problem.explanation
    });
  }
  
  return problems;
}

// ì´ˆë“±í•™êµ 3í•™ë…„ ë¬¸ì œ ìƒì„± - ê³ í’ˆì§ˆ ë¬¸ì œ
function _generateGrade3Problems(stageId: number): any[] {
  const problems = [];
  
  // ìŠ¤í…Œì´ì§€ IDì— ë”°ë¥¸ ê³ ì •ëœ ë¬¸ì œ ìƒì„± (ì‹¤ì œ êµìœ¡ê³¼ì • ìˆ˜ì¤€)
  const stageProblems = {
    111: { 
      question: "2ê°œë¥¼ 3ëª…ì´ ë˜‘ê°™ì´ ë‚˜ëˆ„ì–´ ë¨¹ì—ˆìŠµë‹ˆë‹¤. í•œ ëª…ì´ ë¨¹ì€ ì–‘ì„ ë¶„ìˆ˜ë¡œ ë‚˜íƒ€ë‚´ë©´?\nâ‘  2/3\nâ‘¡ 3/2\nâ‘¢ 1/3", 
      answer: "â‘ ", 
      explanation: "2ê°œë¥¼ 3ëª…ì´ ë‚˜ëˆ„ë©´ í•œ ëª…ë‹¹ 2/3ê°œì…ë‹ˆë‹¤. ë¶„ìˆ˜ì—ì„œ ë¶„ìëŠ” ì „ì²´ì˜ ì–‘, ë¶„ëª¨ëŠ” ë‚˜ëˆ„ëŠ” ì‚¬ëŒ ìˆ˜ì…ë‹ˆë‹¤." 
    },
    112: { 
      question: "3ê°œë¥¼ 4ëª…ì´ ë˜‘ê°™ì´ ë‚˜ëˆ„ì–´ ë¨¹ì—ˆìŠµë‹ˆë‹¤. í•œ ëª…ì´ ë¨¹ì€ ì–‘ì„ ë¶„ìˆ˜ë¡œ ë‚˜íƒ€ë‚´ë©´?\nâ‘  3/4\nâ‘¡ 4/3\nâ‘¢ 1/4", 
      answer: "â‘ ", 
      explanation: "3ê°œë¥¼ 4ëª…ì´ ë‚˜ëˆ„ë©´ í•œ ëª…ë‹¹ 3/4ê°œì…ë‹ˆë‹¤. ë¶„ìˆ˜ì—ì„œ ë¶„ìëŠ” ì „ì²´ì˜ ì–‘, ë¶„ëª¨ëŠ” ë‚˜ëˆ„ëŠ” ì‚¬ëŒ ìˆ˜ì…ë‹ˆë‹¤." 
    },
    113: { 
      question: "1ê°œë¥¼ 2ëª…ì´ ë˜‘ê°™ì´ ë‚˜ëˆ„ì–´ ë¨¹ì—ˆìŠµë‹ˆë‹¤. í•œ ëª…ì´ ë¨¹ì€ ì–‘ì„ ë¶„ìˆ˜ë¡œ ë‚˜íƒ€ë‚´ë©´?\nâ‘  1/2\nâ‘¡ 2/1\nâ‘¢ 1/1", 
      answer: "â‘ ", 
      explanation: "1ê°œë¥¼ 2ëª…ì´ ë‚˜ëˆ„ë©´ í•œ ëª…ë‹¹ 1/2ê°œì…ë‹ˆë‹¤. ë¶„ìˆ˜ì—ì„œ ë¶„ìëŠ” ì „ì²´ì˜ ì–‘, ë¶„ëª¨ëŠ” ë‚˜ëˆ„ëŠ” ì‚¬ëŒ ìˆ˜ì…ë‹ˆë‹¤." 
    },
    114: { 
      question: "4ê°œë¥¼ 5ëª…ì´ ë˜‘ê°™ì´ ë‚˜ëˆ„ì–´ ë¨¹ì—ˆìŠµë‹ˆë‹¤. í•œ ëª…ì´ ë¨¹ì€ ì–‘ì„ ë¶„ìˆ˜ë¡œ ë‚˜íƒ€ë‚´ë©´?\nâ‘  4/5\nâ‘¡ 5/4\nâ‘¢ 1/5", 
      answer: "â‘ ", 
      explanation: "4ê°œë¥¼ 5ëª…ì´ ë‚˜ëˆ„ë©´ í•œ ëª…ë‹¹ 4/5ê°œì…ë‹ˆë‹¤. ë¶„ìˆ˜ì—ì„œ ë¶„ìëŠ” ì „ì²´ì˜ ì–‘, ë¶„ëª¨ëŠ” ë‚˜ëˆ„ëŠ” ì‚¬ëŒ ìˆ˜ì…ë‹ˆë‹¤." 
    },
    115: { 
      question: "2ê°œë¥¼ 5ëª…ì´ ë˜‘ê°™ì´ ë‚˜ëˆ„ì–´ ë¨¹ì—ˆìŠµë‹ˆë‹¤. í•œ ëª…ì´ ë¨¹ì€ ì–‘ì„ ë¶„ìˆ˜ë¡œ ë‚˜íƒ€ë‚´ë©´?\nâ‘  2/5\nâ‘¡ 5/2\nâ‘¢ 1/5", 
      answer: "â‘ ", 
      explanation: "2ê°œë¥¼ 5ëª…ì´ ë‚˜ëˆ„ë©´ í•œ ëª…ë‹¹ 2/5ê°œì…ë‹ˆë‹¤. ë¶„ìˆ˜ì—ì„œ ë¶„ìëŠ” ì „ì²´ì˜ ì–‘, ë¶„ëª¨ëŠ” ë‚˜ëˆ„ëŠ” ì‚¬ëŒ ìˆ˜ì…ë‹ˆë‹¤." 
    },
    116: { 
      question: "3ê°œë¥¼ 6ëª…ì´ ë˜‘ê°™ì´ ë‚˜ëˆ„ì–´ ë¨¹ì—ˆìŠµë‹ˆë‹¤. í•œ ëª…ì´ ë¨¹ì€ ì–‘ì„ ë¶„ìˆ˜ë¡œ ë‚˜íƒ€ë‚´ë©´?\nâ‘  3/6\nâ‘¡ 6/3\nâ‘¢ 1/6", 
      answer: "â‘ ", 
      explanation: "3ê°œë¥¼ 6ëª…ì´ ë‚˜ëˆ„ë©´ í•œ ëª…ë‹¹ 3/6ê°œì…ë‹ˆë‹¤. ë¶„ìˆ˜ì—ì„œ ë¶„ìëŠ” ì „ì²´ì˜ ì–‘, ë¶„ëª¨ëŠ” ë‚˜ëˆ„ëŠ” ì‚¬ëŒ ìˆ˜ì…ë‹ˆë‹¤." 
    },
    117: { 
      question: "5ê°œë¥¼ 8ëª…ì´ ë˜‘ê°™ì´ ë‚˜ëˆ„ì–´ ë¨¹ì—ˆìŠµë‹ˆë‹¤. í•œ ëª…ì´ ë¨¹ì€ ì–‘ì„ ë¶„ìˆ˜ë¡œ ë‚˜íƒ€ë‚´ë©´?\nâ‘  5/8\nâ‘¡ 8/5\nâ‘¢ 1/8", 
      answer: "â‘ ", 
      explanation: "5ê°œë¥¼ 8ëª…ì´ ë‚˜ëˆ„ë©´ í•œ ëª…ë‹¹ 5/8ê°œì…ë‹ˆë‹¤. ë¶„ìˆ˜ì—ì„œ ë¶„ìëŠ” ì „ì²´ì˜ ì–‘, ë¶„ëª¨ëŠ” ë‚˜ëˆ„ëŠ” ì‚¬ëŒ ìˆ˜ì…ë‹ˆë‹¤." 
    },
    118: { 
      question: "1ê°œë¥¼ 3ëª…ì´ ë˜‘ê°™ì´ ë‚˜ëˆ„ì–´ ë¨¹ì—ˆìŠµë‹ˆë‹¤. í•œ ëª…ì´ ë¨¹ì€ ì–‘ì„ ë¶„ìˆ˜ë¡œ ë‚˜íƒ€ë‚´ë©´?\nâ‘  1/3\nâ‘¡ 3/1\nâ‘¢ 1/1", 
      answer: "â‘ ", 
      explanation: "1ê°œë¥¼ 3ëª…ì´ ë‚˜ëˆ„ë©´ í•œ ëª…ë‹¹ 1/3ê°œì…ë‹ˆë‹¤. ë¶„ìˆ˜ì—ì„œ ë¶„ìëŠ” ì „ì²´ì˜ ì–‘, ë¶„ëª¨ëŠ” ë‚˜ëˆ„ëŠ” ì‚¬ëŒ ìˆ˜ì…ë‹ˆë‹¤." 
    },
    119: { 
      question: "4ê°œë¥¼ 7ëª…ì´ ë˜‘ê°™ì´ ë‚˜ëˆ„ì–´ ë¨¹ì—ˆìŠµë‹ˆë‹¤. í•œ ëª…ì´ ë¨¹ì€ ì–‘ì„ ë¶„ìˆ˜ë¡œ ë‚˜íƒ€ë‚´ë©´?\nâ‘  4/7\nâ‘¡ 7/4\nâ‘¢ 1/7", 
      answer: "â‘ ", 
      explanation: "4ê°œë¥¼ 7ëª…ì´ ë‚˜ëˆ„ë©´ í•œ ëª…ë‹¹ 4/7ê°œì…ë‹ˆë‹¤. ë¶„ìˆ˜ì—ì„œ ë¶„ìëŠ” ì „ì²´ì˜ ì–‘, ë¶„ëª¨ëŠ” ë‚˜ëˆ„ëŠ” ì‚¬ëŒ ìˆ˜ì…ë‹ˆë‹¤." 
    },
    120: { 
      question: "3ê°œë¥¼ 9ëª…ì´ ë˜‘ê°™ì´ ë‚˜ëˆ„ì–´ ë¨¹ì—ˆìŠµë‹ˆë‹¤. í•œ ëª…ì´ ë¨¹ì€ ì–‘ì„ ë¶„ìˆ˜ë¡œ ë‚˜íƒ€ë‚´ë©´?\nâ‘  3/9\nâ‘¡ 9/3\nâ‘¢ 1/9", 
      answer: "â‘ ", 
      explanation: "3ê°œë¥¼ 9ëª…ì´ ë‚˜ëˆ„ë©´ í•œ ëª…ë‹¹ 3/9ê°œì…ë‹ˆë‹¤. ë¶„ìˆ˜ì—ì„œ ë¶„ìëŠ” ì „ì²´ì˜ ì–‘, ë¶„ëª¨ëŠ” ë‚˜ëˆ„ëŠ” ì‚¬ëŒ ìˆ˜ì…ë‹ˆë‹¤." 
    },
    121: { 
      question: "123 Ã— 4 = ? (ê³±ì…ˆì˜ ì˜ë¯¸ë¥¼ ì„¤ëª…í•˜ë©° ê³„ì‚°í•˜ì„¸ìš”)\nâ‘  492\nâ‘¡ 482\nâ‘¢ 502", 
      answer: "â‘ ", 
      explanation: "123 Ã— 4 = 492ì…ë‹ˆë‹¤. 123ì„ 4ë²ˆ ë”í•œ ê°’ê³¼ ê°™ìŠµë‹ˆë‹¤. 123 + 123 + 123 + 123 = 492" 
    },
    122: { 
      question: "234 Ã— 5 = ? (ê³±ì…ˆì˜ ì˜ë¯¸ë¥¼ ì„¤ëª…í•˜ë©° ê³„ì‚°í•˜ì„¸ìš”)\nâ‘  1170\nâ‘¡ 1160\nâ‘¢ 1180", 
      answer: "â‘ ", 
      explanation: "234 Ã— 5 = 1170ì…ë‹ˆë‹¤. 234ë¥¼ 5ë²ˆ ë”í•œ ê°’ê³¼ ê°™ìŠµë‹ˆë‹¤. 234 + 234 + 234 + 234 + 234 = 1170" 
    },
    123: { 
      question: "345 Ã— 6 = ? (ê³±ì…ˆì˜ ì˜ë¯¸ë¥¼ ì„¤ëª…í•˜ë©° ê³„ì‚°í•˜ì„¸ìš”)\nâ‘  2070\nâ‘¡ 2060\nâ‘¢ 2080", 
      answer: "â‘ ", 
      explanation: "345 Ã— 6 = 2070ì…ë‹ˆë‹¤. 345ë¥¼ 6ë²ˆ ë”í•œ ê°’ê³¼ ê°™ìŠµë‹ˆë‹¤. 345 + 345 + 345 + 345 + 345 + 345 = 2070" 
    },
    124: { 
      question: "456 Ã— 7 = ? (ê³±ì…ˆì˜ ì˜ë¯¸ë¥¼ ì„¤ëª…í•˜ë©° ê³„ì‚°í•˜ì„¸ìš”)\nâ‘  3192\nâ‘¡ 3182\nâ‘¢ 3202", 
      answer: "â‘ ", 
      explanation: "456 Ã— 7 = 3192ì…ë‹ˆë‹¤. 456ì„ 7ë²ˆ ë”í•œ ê°’ê³¼ ê°™ìŠµë‹ˆë‹¤. 456 + 456 + 456 + 456 + 456 + 456 + 456 = 3192" 
    },
    125: { 
      question: "567 Ã— 8 = ? (ê³±ì…ˆì˜ ì˜ë¯¸ë¥¼ ì„¤ëª…í•˜ë©° ê³„ì‚°í•˜ì„¸ìš”)\nâ‘  4536\nâ‘¡ 4526\nâ‘¢ 4546", 
      answer: "â‘ ", 
      explanation: "567 Ã— 8 = 4536ì…ë‹ˆë‹¤. 567ì„ 8ë²ˆ ë”í•œ ê°’ê³¼ ê°™ìŠµë‹ˆë‹¤. 567 + 567 + 567 + 567 + 567 + 567 + 567 + 567 = 4536" 
    },
    126: { 
      question: "678 Ã— 9 = ? (ê³±ì…ˆì˜ ì˜ë¯¸ë¥¼ ì„¤ëª…í•˜ë©° ê³„ì‚°í•˜ì„¸ìš”)\nâ‘  6102\nâ‘¡ 6092\nâ‘¢ 6112", 
      answer: "â‘ ", 
      explanation: "678 Ã— 9 = 6102ì…ë‹ˆë‹¤. 678ì„ 9ë²ˆ ë”í•œ ê°’ê³¼ ê°™ìŠµë‹ˆë‹¤. 678 + 678 + 678 + 678 + 678 + 678 + 678 + 678 + 678 = 6102" 
    },
    127: { 
      question: "789 Ã— 2 = ? (ê³±ì…ˆì˜ ì˜ë¯¸ë¥¼ ì„¤ëª…í•˜ë©° ê³„ì‚°í•˜ì„¸ìš”)\nâ‘  1578\nâ‘¡ 1568\nâ‘¢ 1588", 
      answer: "â‘ ", 
      explanation: "789 Ã— 2 = 1578ì…ë‹ˆë‹¤. 789ë¥¼ 2ë²ˆ ë”í•œ ê°’ê³¼ ê°™ìŠµë‹ˆë‹¤. 789 + 789 = 1578" 
    },
    128: { 
      question: "234 Ã— 3 = ? (ê³±ì…ˆì˜ ì˜ë¯¸ë¥¼ ì„¤ëª…í•˜ë©° ê³„ì‚°í•˜ì„¸ìš”)\nâ‘  702\nâ‘¡ 692\nâ‘¢ 712", 
      answer: "â‘ ", 
      explanation: "234 Ã— 3 = 702ì…ë‹ˆë‹¤. 234ë¥¼ 3ë²ˆ ë”í•œ ê°’ê³¼ ê°™ìŠµë‹ˆë‹¤. 234 + 234 + 234 = 702" 
    },
    129: { 
      question: "345 Ã— 4 = ? (ê³±ì…ˆì˜ ì˜ë¯¸ë¥¼ ì„¤ëª…í•˜ë©° ê³„ì‚°í•˜ì„¸ìš”)\nâ‘  1380\nâ‘¡ 1370\nâ‘¢ 1390", 
      answer: "â‘ ", 
      explanation: "345 Ã— 4 = 1380ì…ë‹ˆë‹¤. 345ë¥¼ 4ë²ˆ ë”í•œ ê°’ê³¼ ê°™ìŠµë‹ˆë‹¤. 345 + 345 + 345 + 345 = 1380" 
    },
    130: { 
      question: "456 Ã— 5 = ? (ê³±ì…ˆì˜ ì˜ë¯¸ë¥¼ ì„¤ëª…í•˜ë©° ê³„ì‚°í•˜ì„¸ìš”)\nâ‘  2280\nâ‘¡ 2270\nâ‘¢ 2290", 
      answer: "â‘ ", 
      explanation: "456 Ã— 5 = 2280ì…ë‹ˆë‹¤. 456ì„ 5ë²ˆ ë”í•œ ê°’ê³¼ ê°™ìŠµë‹ˆë‹¤. 456 + 456 + 456 + 456 + 456 = 2280" 
    }
  };

  // ìŠ¤í…Œì´ì§€ì— ë§ëŠ” ë¬¸ì œ ê°€ì ¸ì˜¤ê¸°
  const problem = stageProblems[stageId as keyof typeof stageProblems];
  if (problem) {
    problems.push({
      question: problem.question,
      options: [problem.answer, "1/2", "1/3", "1/4"],
      correctAnswer: problem.answer,
      explanation: problem.explanation
    });
  }
  
  return problems;
}

// ì´ˆë“±í•™êµ 4í•™ë…„ ë¬¸ì œ ìƒì„± - ê³ í’ˆì§ˆ ë¬¸ì œ
function _generateGrade4Problems(stageId: number): any[] {
  const problems = [];
  
  // ìŠ¤í…Œì´ì§€ IDì— ë”°ë¥¸ ê³ ì •ëœ ë¬¸ì œ ìƒì„± (ì‹¤ì œ êµìœ¡ê³¼ì • ìˆ˜ì¤€)
  const stageProblems = {
    141: { 
      question: "2/5 + 1/5 = ? (ë¶„ëª¨ê°€ ê°™ì€ ë¶„ìˆ˜ì˜ ë§ì…ˆì„ ê³„ì‚°í•˜ì„¸ìš”)\nâ‘  3/5\nâ‘¡ 3/10\nâ‘¢ 1/5", 
      answer: "â‘ ", 
      explanation: "ë¶„ëª¨ê°€ ê°™ì€ ë¶„ìˆ˜ì˜ ë§ì…ˆì€ ë¶„ìë§Œ ë”í•˜ë©´ ë©ë‹ˆë‹¤. 2/5 + 1/5 = (2+1)/5 = 3/5ì…ë‹ˆë‹¤." 
    },
    142: { 
      question: "3/7 + 2/7 = ? (ë¶„ëª¨ê°€ ê°™ì€ ë¶„ìˆ˜ì˜ ë§ì…ˆì„ ê³„ì‚°í•˜ì„¸ìš”)\nâ‘  5/7\nâ‘¡ 5/14\nâ‘¢ 1/7", 
      answer: "â‘ ", 
      explanation: "ë¶„ëª¨ê°€ ê°™ì€ ë¶„ìˆ˜ì˜ ë§ì…ˆì€ ë¶„ìë§Œ ë”í•˜ë©´ ë©ë‹ˆë‹¤. 3/7 + 2/7 = (3+2)/7 = 5/7ì…ë‹ˆë‹¤." 
    },
    143: { 
      question: "4/9 + 3/9 = ? (ë¶„ëª¨ê°€ ê°™ì€ ë¶„ìˆ˜ì˜ ë§ì…ˆì„ ê³„ì‚°í•˜ì„¸ìš”)\nâ‘  7/9\nâ‘¡ 7/18\nâ‘¢ 1/9", 
      answer: "â‘ ", 
      explanation: "ë¶„ëª¨ê°€ ê°™ì€ ë¶„ìˆ˜ì˜ ë§ì…ˆì€ ë¶„ìë§Œ ë”í•˜ë©´ ë©ë‹ˆë‹¤. 4/9 + 3/9 = (4+3)/9 = 7/9ì…ë‹ˆë‹¤." 
    },
    144: { 
      question: "5/8 + 2/8 = ? (ë¶„ëª¨ê°€ ê°™ì€ ë¶„ìˆ˜ì˜ ë§ì…ˆì„ ê³„ì‚°í•˜ì„¸ìš”)\nâ‘  7/8\nâ‘¡ 7/16\nâ‘¢ 1/8", 
      answer: "â‘ ", 
      explanation: "ë¶„ëª¨ê°€ ê°™ì€ ë¶„ìˆ˜ì˜ ë§ì…ˆì€ ë¶„ìë§Œ ë”í•˜ë©´ ë©ë‹ˆë‹¤. 5/8 + 2/8 = (5+2)/8 = 7/8ì…ë‹ˆë‹¤." 
    },
    145: { 
      question: "6/11 + 4/11 = ? (ë¶„ëª¨ê°€ ê°™ì€ ë¶„ìˆ˜ì˜ ë§ì…ˆì„ ê³„ì‚°í•˜ì„¸ìš”)\nâ‘  10/11\nâ‘¡ 10/22\nâ‘¢ 1/11", 
      answer: "â‘ ", 
      explanation: "ë¶„ëª¨ê°€ ê°™ì€ ë¶„ìˆ˜ì˜ ë§ì…ˆì€ ë¶„ìë§Œ ë”í•˜ë©´ ë©ë‹ˆë‹¤. 6/11 + 4/11 = (6+4)/11 = 10/11ì…ë‹ˆë‹¤." 
    },
    146: { 
      question: "3/6 + 2/6 = ? (ë¶„ëª¨ê°€ ê°™ì€ ë¶„ìˆ˜ì˜ ë§ì…ˆì„ ê³„ì‚°í•˜ì„¸ìš”)\nâ‘  5/6\nâ‘¡ 5/12\nâ‘¢ 1/6", 
      answer: "â‘ ", 
      explanation: "ë¶„ëª¨ê°€ ê°™ì€ ë¶„ìˆ˜ì˜ ë§ì…ˆì€ ë¶„ìë§Œ ë”í•˜ë©´ ë©ë‹ˆë‹¤. 3/6 + 2/6 = (3+2)/6 = 5/6ì…ë‹ˆë‹¤." 
    },
    147: { 
      question: "4/10 + 5/10 = ? (ë¶„ëª¨ê°€ ê°™ì€ ë¶„ìˆ˜ì˜ ë§ì…ˆì„ ê³„ì‚°í•˜ì„¸ìš”)\nâ‘  9/10\nâ‘¡ 9/20\nâ‘¢ 1/10", 
      answer: "â‘ ", 
      explanation: "ë¶„ëª¨ê°€ ê°™ì€ ë¶„ìˆ˜ì˜ ë§ì…ˆì€ ë¶„ìë§Œ ë”í•˜ë©´ ë©ë‹ˆë‹¤. 4/10 + 5/10 = (4+5)/10 = 9/10ì…ë‹ˆë‹¤." 
    },
    148: { 
      question: "2/12 + 7/12 = ? (ë¶„ëª¨ê°€ ê°™ì€ ë¶„ìˆ˜ì˜ ë§ì…ˆì„ ê³„ì‚°í•˜ì„¸ìš”)\nâ‘  9/12\nâ‘¡ 9/24\nâ‘¢ 1/12", 
      answer: "â‘ ", 
      explanation: "ë¶„ëª¨ê°€ ê°™ì€ ë¶„ìˆ˜ì˜ ë§ì…ˆì€ ë¶„ìë§Œ ë”í•˜ë©´ ë©ë‹ˆë‹¤. 2/12 + 7/12 = (2+7)/12 = 9/12ì…ë‹ˆë‹¤." 
    },
    149: { 
      question: "1/4 + 2/4 = ? (ë¶„ëª¨ê°€ ê°™ì€ ë¶„ìˆ˜ì˜ ë§ì…ˆì„ ê³„ì‚°í•˜ì„¸ìš”)\nâ‘  3/4\nâ‘¡ 3/8\nâ‘¢ 1/4", 
      answer: "â‘ ", 
      explanation: "ë¶„ëª¨ê°€ ê°™ì€ ë¶„ìˆ˜ì˜ ë§ì…ˆì€ ë¶„ìë§Œ ë”í•˜ë©´ ë©ë‹ˆë‹¤. 1/4 + 2/4 = (1+2)/4 = 3/4ì…ë‹ˆë‹¤." 
    },
    150: { 
      question: "3/8 + 4/8 = ? (ë¶„ëª¨ê°€ ê°™ì€ ë¶„ìˆ˜ì˜ ë§ì…ˆì„ ê³„ì‚°í•˜ì„¸ìš”)\nâ‘  7/8\nâ‘¡ 7/16\nâ‘¢ 1/8", 
      answer: "â‘ ", 
      explanation: "ë¶„ëª¨ê°€ ê°™ì€ ë¶„ìˆ˜ì˜ ë§ì…ˆì€ ë¶„ìë§Œ ë”í•˜ë©´ ë©ë‹ˆë‹¤. 3/8 + 4/8 = (3+4)/8 = 7/8ì…ë‹ˆë‹¤." 
    },
    151: { 
      question: "0.5 + 0.3 = ? (ì†Œìˆ˜ì˜ ë§ì…ˆì„ ê³„ì‚°í•˜ì„¸ìš”)\nâ‘  0.8\nâ‘¡ 0.15\nâ‘¢ 1.5", 
      answer: "â‘ ", 
      explanation: "ì†Œìˆ˜ì˜ ë§ì…ˆì€ ì†Œìˆ˜ì ì„ ë§ì¶°ì„œ ê³„ì‚°í•©ë‹ˆë‹¤. 0.5 + 0.3 = 0.8ì…ë‹ˆë‹¤." 
    },
    152: { 
      question: "0.7 + 0.2 = ? (ì†Œìˆ˜ì˜ ë§ì…ˆì„ ê³„ì‚°í•˜ì„¸ìš”)\nâ‘  0.9\nâ‘¡ 0.14\nâ‘¢ 1.4", 
      answer: "â‘ ", 
      explanation: "ì†Œìˆ˜ì˜ ë§ì…ˆì€ ì†Œìˆ˜ì ì„ ë§ì¶°ì„œ ê³„ì‚°í•©ë‹ˆë‹¤. 0.7 + 0.2 = 0.9ì…ë‹ˆë‹¤." 
    },
    153: { 
      question: "0.4 + 0.6 = ? (ì†Œìˆ˜ì˜ ë§ì…ˆì„ ê³„ì‚°í•˜ì„¸ìš”)\nâ‘  1.0\nâ‘¡ 0.24\nâ‘¢ 2.4", 
      answer: "â‘ ", 
      explanation: "ì†Œìˆ˜ì˜ ë§ì…ˆì€ ì†Œìˆ˜ì ì„ ë§ì¶°ì„œ ê³„ì‚°í•©ë‹ˆë‹¤. 0.4 + 0.6 = 1.0ì…ë‹ˆë‹¤." 
    },
    154: { 
      question: "0.8 + 0.1 = ? (ì†Œìˆ˜ì˜ ë§ì…ˆì„ ê³„ì‚°í•˜ì„¸ìš”)\nâ‘  0.9\nâ‘¡ 0.08\nâ‘¢ 1.6", 
      answer: "â‘ ", 
      explanation: "ì†Œìˆ˜ì˜ ë§ì…ˆì€ ì†Œìˆ˜ì ì„ ë§ì¶°ì„œ ê³„ì‚°í•©ë‹ˆë‹¤. 0.8 + 0.1 = 0.9ì…ë‹ˆë‹¤." 
    },
    155: { 
      question: "0.6 + 0.4 = ? (ì†Œìˆ˜ì˜ ë§ì…ˆì„ ê³„ì‚°í•˜ì„¸ìš”)\nâ‘  1.0\nâ‘¡ 0.24\nâ‘¢ 2.4", 
      answer: "â‘ ", 
      explanation: "ì†Œìˆ˜ì˜ ë§ì…ˆì€ ì†Œìˆ˜ì ì„ ë§ì¶°ì„œ ê³„ì‚°í•©ë‹ˆë‹¤. 0.6 + 0.4 = 1.0ì…ë‹ˆë‹¤." 
    },
    156: { 
      question: "0.9 + 0.1 = ? (ì†Œìˆ˜ì˜ ë§ì…ˆì„ ê³„ì‚°í•˜ì„¸ìš”)\nâ‘  1.0\nâ‘¡ 0.09\nâ‘¢ 1.8", 
      answer: "â‘ ", 
      explanation: "ì†Œìˆ˜ì˜ ë§ì…ˆì€ ì†Œìˆ˜ì ì„ ë§ì¶°ì„œ ê³„ì‚°í•©ë‹ˆë‹¤. 0.9 + 0.1 = 1.0ì…ë‹ˆë‹¤." 
    },
    157: { 
      question: "0.3 + 0.7 = ? (ì†Œìˆ˜ì˜ ë§ì…ˆì„ ê³„ì‚°í•˜ì„¸ìš”)\nâ‘  1.0\nâ‘¡ 0.21\nâ‘¢ 2.1", 
      answer: "â‘ ", 
      explanation: "ì†Œìˆ˜ì˜ ë§ì…ˆì€ ì†Œìˆ˜ì ì„ ë§ì¶°ì„œ ê³„ì‚°í•©ë‹ˆë‹¤. 0.3 + 0.7 = 1.0ì…ë‹ˆë‹¤." 
    },
    158: { 
      question: "0.2 + 0.8 = ? (ì†Œìˆ˜ì˜ ë§ì…ˆì„ ê³„ì‚°í•˜ì„¸ìš”)\nâ‘  1.0\nâ‘¡ 0.16\nâ‘¢ 1.6", 
      answer: "â‘ ", 
      explanation: "ì†Œìˆ˜ì˜ ë§ì…ˆì€ ì†Œìˆ˜ì ì„ ë§ì¶°ì„œ ê³„ì‚°í•©ë‹ˆë‹¤. 0.2 + 0.8 = 1.0ì…ë‹ˆë‹¤." 
    },
    159: { 
      question: "0.5 + 0.5 = ? (ì†Œìˆ˜ì˜ ë§ì…ˆì„ ê³„ì‚°í•˜ì„¸ìš”)\nâ‘  1.0\nâ‘¡ 0.25\nâ‘¢ 2.5", 
      answer: "â‘ ", 
      explanation: "ì†Œìˆ˜ì˜ ë§ì…ˆì€ ì†Œìˆ˜ì ì„ ë§ì¶°ì„œ ê³„ì‚°í•©ë‹ˆë‹¤. 0.5 + 0.5 = 1.0ì…ë‹ˆë‹¤." 
    },
    160: { 
      question: "0.1 + 0.9 = ? (ì†Œìˆ˜ì˜ ë§ì…ˆì„ ê³„ì‚°í•˜ì„¸ìš”)\nâ‘  1.0\nâ‘¡ 0.09\nâ‘¢ 1.8", 
      answer: "â‘ ", 
      explanation: "ì†Œìˆ˜ì˜ ë§ì…ˆì€ ì†Œìˆ˜ì ì„ ë§ì¶°ì„œ ê³„ì‚°í•©ë‹ˆë‹¤. 0.1 + 0.9 = 1.0ì…ë‹ˆë‹¤." 
    }
  };

  // ìŠ¤í…Œì´ì§€ì— ë§ëŠ” ë¬¸ì œ ê°€ì ¸ì˜¤ê¸°
  const problem = stageProblems[stageId as keyof typeof stageProblems];
  if (problem) {
    problems.push({
      question: problem.question,
      options: [problem.answer, "1/2", "1/3", "1/4"],
      correctAnswer: problem.answer,
      explanation: problem.explanation
    });
  }
  
  return problems;
}

// ì´ˆë“±í•™êµ 5í•™ë…„ ë¬¸ì œ ìƒì„± - ê³ í’ˆì§ˆ ë¬¸ì œ
function _generateGrade5Problems(stageId: number): any[] {
  const problems = [];
  
  // ìŠ¤í…Œì´ì§€ IDì— ë”°ë¥¸ ê³ ì •ëœ ë¬¸ì œ ìƒì„± (ì‹¤ì œ êµìœ¡ê³¼ì • ìˆ˜ì¤€)
  const stageProblems = {
    171: { 
      question: "2/4ë¥¼ ì•½ë¶„í•˜ë©´?\nâ‘  1/2\nâ‘¡ 2/1\nâ‘¢ 1/4", 
      answer: "â‘ ", 
      explanation: "2/4 = (2Ã·2)/(4Ã·2) = 1/2ì…ë‹ˆë‹¤. ë¶„ìì™€ ë¶„ëª¨ë¥¼ ê³µì•½ìˆ˜ 2ë¡œ ë‚˜ëˆ„ì–´ ì•½ë¶„í–ˆìŠµë‹ˆë‹¤." 
    },
    172: { 
      question: "4/8ë¥¼ ì•½ë¶„í•˜ë©´?
â‘  1/2
â‘¡ 2/1
â‘¢ 1/8", 
      answer: "â‘ ", 
      explanation: "4/8 = (4Ã·4)/(8Ã·4) = 1/2ì…ë‹ˆë‹¤. ë¶„ìì™€ ë¶„ëª¨ë¥¼ ê³µì•½ìˆ˜ 4ë¡œ ë‚˜ëˆ„ì–´ ì•½ë¶„í–ˆìŠµë‹ˆë‹¤." 
    },
    173: { 
      question: "6/12ë¥¼ ì•½ë¶„í•˜ë©´?
â‘  1/2
â‘¡ 2/1
â‘¢ 1/12", 
      answer: "â‘ ", 
      explanation: "6/12 = (6Ã·6)/(12Ã·6) = 1/2ì…ë‹ˆë‹¤. ë¶„ìì™€ ë¶„ëª¨ë¥¼ ê³µì•½ìˆ˜ 6ìœ¼ë¡œ ë‚˜ëˆ„ì–´ ì•½ë¶„í–ˆìŠµë‹ˆë‹¤." 
    },
    174: { 
      question: "8/16ë¥¼ ì•½ë¶„í•˜ë©´?
â‘  1/2
â‘¡ 2/1
â‘¢ 1/16", 
      answer: "â‘ ", 
      explanation: "8/16 = (8Ã·8)/(16Ã·8) = 1/2ì…ë‹ˆë‹¤. ë¶„ìì™€ ë¶„ëª¨ë¥¼ ê³µì•½ìˆ˜ 8ë¡œ ë‚˜ëˆ„ì–´ ì•½ë¶„í–ˆìŠµë‹ˆë‹¤." 
    },
    175: { 
      question: "3/6ë¥¼ ì•½ë¶„í•˜ë©´?
â‘  1/2
â‘¡ 2/1
â‘¢ 1/6", 
      answer: "â‘ ", 
      explanation: "3/6 = (3Ã·3)/(6Ã·3) = 1/2ì…ë‹ˆë‹¤. ë¶„ìì™€ ë¶„ëª¨ë¥¼ ê³µì•½ìˆ˜ 3ìœ¼ë¡œ ë‚˜ëˆ„ì–´ ì•½ë¶„í–ˆìŠµë‹ˆë‹¤." 
    },
    176: { 
      question: "1/2 + 1/3 = ? (ë¶„ëª¨ê°€ ë‹¤ë¥¸ ë¶„ìˆ˜ì˜ ë§ì…ˆì„ ê³„ì‚°í•˜ì„¸ìš”)
â‘  5/6
â‘¡ 2/5
â‘¢ 1/5", 
      answer: "â‘ ", 
      explanation: "í†µë¶„í•˜ë©´ 1/2 = 3/6, 1/3 = 2/6ì´ë¯€ë¡œ 3/6 + 2/6 = 5/6ì…ë‹ˆë‹¤." 
    },
    177: { 
      question: "2/3 + 1/4 = ? (ë¶„ëª¨ê°€ ë‹¤ë¥¸ ë¶„ìˆ˜ì˜ ë§ì…ˆì„ ê³„ì‚°í•˜ì„¸ìš”)
â‘  11/12
â‘¡ 3/7
â‘¢ 1/7", 
      answer: "â‘ ", 
      explanation: "í†µë¶„í•˜ë©´ 2/3 = 8/12, 1/4 = 3/12ì´ë¯€ë¡œ 8/12 + 3/12 = 11/12ì…ë‹ˆë‹¤." 
    },
    178: { 
      question: "1/4 + 1/6 = ? (ë¶„ëª¨ê°€ ë‹¤ë¥¸ ë¶„ìˆ˜ì˜ ë§ì…ˆì„ ê³„ì‚°í•˜ì„¸ìš”)
â‘  5/12
â‘¡ 2/10
â‘¢ 1/10", 
      answer: "â‘ ", 
      explanation: "í†µë¶„í•˜ë©´ 1/4 = 3/12, 1/6 = 2/12ì´ë¯€ë¡œ 3/12 + 2/12 = 5/12ì…ë‹ˆë‹¤." 
    },
    179: { 
      question: "2/5 + 1/3 = ? (ë¶„ëª¨ê°€ ë‹¤ë¥¸ ë¶„ìˆ˜ì˜ ë§ì…ˆì„ ê³„ì‚°í•˜ì„¸ìš”)
â‘  11/15
â‘¡ 3/8
â‘¢ 1/8", 
      answer: "â‘ ", 
      explanation: "í†µë¶„í•˜ë©´ 2/5 = 6/15, 1/3 = 5/15ì´ë¯€ë¡œ 6/15 + 5/15 = 11/15ì…ë‹ˆë‹¤." 
    },
    180: { 
      question: "3/4 + 1/5 = ? (ë¶„ëª¨ê°€ ë‹¤ë¥¸ ë¶„ìˆ˜ì˜ ë§ì…ˆì„ ê³„ì‚°í•˜ì„¸ìš”)
â‘  19/20
â‘¡ 4/9
â‘¢ 1/9", 
      answer: "â‘ ", 
      explanation: "í†µë¶„í•˜ë©´ 3/4 = 15/20, 1/5 = 4/20ì´ë¯€ë¡œ 15/20 + 4/20 = 19/20ì…ë‹ˆë‹¤." 
    }
  };

  // ìŠ¤í…Œì´ì§€ì— ë§ëŠ” ë¬¸ì œ ê°€ì ¸ì˜¤ê¸°
  const problem = stageProblems[stageId as keyof typeof stageProblems];
  if (problem) {
    problems.push({
      question: problem.question,
      options: [problem.answer, "1/2", "1/3", "1/4"],
      correctAnswer: problem.answer,
      explanation: problem.explanation
    });
  }
  
  return problems;
}

// ì´ˆë“±í•™êµ 6í•™ë…„ ë¬¸ì œ ìƒì„± - ê³ í’ˆì§ˆ ë¬¸ì œ
function _generateGrade6Problems(stageId: number): any[] {
  const problems = [];
  
  // ìŠ¤í…Œì´ì§€ IDì— ë”°ë¥¸ ê³ ì •ëœ ë¬¸ì œ ìƒì„± (ì‹¤ì œ êµìœ¡ê³¼ì • ìˆ˜ì¤€)
  const stageProblems = {
    181: { 
      question: "1/2 Ã· 1/3 = ? (ë¶„ìˆ˜ì˜ ë‚˜ëˆ—ì…ˆì„ ê³„ì‚°í•˜ì„¸ìš”)
â‘  3/2
â‘¡ 2/3
â‘¢ 1/6", 
      answer: "â‘ ", 
      explanation: "ë¶„ìˆ˜ì˜ ë‚˜ëˆ—ì…ˆì€ ì—­ìˆ˜ë¥¼ ê³±í•©ë‹ˆë‹¤. 1/2 Ã· 1/3 = 1/2 Ã— 3/1 = 3/2ì…ë‹ˆë‹¤." 
    },
    182: { 
      question: "2/3 Ã· 1/4 = ? (ë¶„ìˆ˜ì˜ ë‚˜ëˆ—ì…ˆì„ ê³„ì‚°í•˜ì„¸ìš”)
â‘  8/3
â‘¡ 3/8
â‘¢ 1/12", 
      answer: "â‘ ", 
      explanation: "ë¶„ìˆ˜ì˜ ë‚˜ëˆ—ì…ˆì€ ì—­ìˆ˜ë¥¼ ê³±í•©ë‹ˆë‹¤. 2/3 Ã· 1/4 = 2/3 Ã— 4/1 = 8/3ì…ë‹ˆë‹¤." 
    },
    183: { 
      question: "3/4 Ã· 1/2 = ? (ë¶„ìˆ˜ì˜ ë‚˜ëˆ—ì…ˆì„ ê³„ì‚°í•˜ì„¸ìš”)
â‘  3/2
â‘¡ 2/3
â‘¢ 1/8", 
      answer: "â‘ ", 
      explanation: "ë¶„ìˆ˜ì˜ ë‚˜ëˆ—ì…ˆì€ ì—­ìˆ˜ë¥¼ ê³±í•©ë‹ˆë‹¤. 3/4 Ã· 1/2 = 3/4 Ã— 2/1 = 6/4 = 3/2ì…ë‹ˆë‹¤." 
    },
    184: { 
      question: "4/5 Ã· 1/3 = ? (ë¶„ìˆ˜ì˜ ë‚˜ëˆ—ì…ˆì„ ê³„ì‚°í•˜ì„¸ìš”)
â‘  12/5
â‘¡ 5/12
â‘¢ 1/15", 
      answer: "â‘ ", 
      explanation: "ë¶„ìˆ˜ì˜ ë‚˜ëˆ—ì…ˆì€ ì—­ìˆ˜ë¥¼ ê³±í•©ë‹ˆë‹¤. 4/5 Ã· 1/3 = 4/5 Ã— 3/1 = 12/5ì…ë‹ˆë‹¤." 
    },
    185: { 
      question: "5/6 Ã· 1/4 = ? (ë¶„ìˆ˜ì˜ ë‚˜ëˆ—ì…ˆì„ ê³„ì‚°í•˜ì„¸ìš”)
â‘  20/6
â‘¡ 6/20
â‘¢ 1/24", 
      answer: "â‘ ", 
      explanation: "ë¶„ìˆ˜ì˜ ë‚˜ëˆ—ì…ˆì€ ì—­ìˆ˜ë¥¼ ê³±í•©ë‹ˆë‹¤. 5/6 Ã· 1/4 = 5/6 Ã— 4/1 = 20/6ì…ë‹ˆë‹¤." 
    },
    186: { 
      question: "1/3 Ã· 2/5 = ? (ë¶„ìˆ˜ì˜ ë‚˜ëˆ—ì…ˆì„ ê³„ì‚°í•˜ì„¸ìš”)
â‘  5/6
â‘¡ 6/5
â‘¢ 1/15", 
      answer: "â‘ ", 
      explanation: "ë¶„ìˆ˜ì˜ ë‚˜ëˆ—ì…ˆì€ ì—­ìˆ˜ë¥¼ ê³±í•©ë‹ˆë‹¤. 1/3 Ã· 2/5 = 1/3 Ã— 5/2 = 5/6ì…ë‹ˆë‹¤." 
    },
    187: { 
      question: "2/5 Ã· 3/7 = ? (ë¶„ìˆ˜ì˜ ë‚˜ëˆ—ì…ˆì„ ê³„ì‚°í•˜ì„¸ìš”)
â‘  14/15
â‘¡ 15/14
â‘¢ 1/35", 
      answer: "â‘ ", 
      explanation: "ë¶„ìˆ˜ì˜ ë‚˜ëˆ—ì…ˆì€ ì—­ìˆ˜ë¥¼ ê³±í•©ë‹ˆë‹¤. 2/5 Ã· 3/7 = 2/5 Ã— 7/3 = 14/15ì…ë‹ˆë‹¤." 
    },
    188: { 
      question: "3/7 Ã· 2/9 = ? (ë¶„ìˆ˜ì˜ ë‚˜ëˆ—ì…ˆì„ ê³„ì‚°í•˜ì„¸ìš”)
â‘  27/14
â‘¡ 14/27
â‘¢ 1/63", 
      answer: "â‘ ", 
      explanation: "ë¶„ìˆ˜ì˜ ë‚˜ëˆ—ì…ˆì€ ì—­ìˆ˜ë¥¼ ê³±í•©ë‹ˆë‹¤. 3/7 Ã· 2/9 = 3/7 Ã— 9/2 = 27/14ì…ë‹ˆë‹¤." 
    },
    189: { 
      question: "4/9 Ã· 1/6 = ? (ë¶„ìˆ˜ì˜ ë‚˜ëˆ—ì…ˆì„ ê³„ì‚°í•˜ì„¸ìš”)
â‘  24/9
â‘¡ 9/24
â‘¢ 1/54", 
      answer: "â‘ ", 
      explanation: "ë¶„ìˆ˜ì˜ ë‚˜ëˆ—ì…ˆì€ ì—­ìˆ˜ë¥¼ ê³±í•©ë‹ˆë‹¤. 4/9 Ã· 1/6 = 4/9 Ã— 6/1 = 24/9ì…ë‹ˆë‹¤." 
    },
    190: { 
      question: "5/8 Ã· 3/4 = ? (ë¶„ìˆ˜ì˜ ë‚˜ëˆ—ì…ˆì„ ê³„ì‚°í•˜ì„¸ìš”)
â‘  20/24
â‘¡ 24/20
â‘¢ 1/32", 
      answer: "â‘ ", 
      explanation: "ë¶„ìˆ˜ì˜ ë‚˜ëˆ—ì…ˆì€ ì—­ìˆ˜ë¥¼ ê³±í•©ë‹ˆë‹¤. 5/8 Ã· 3/4 = 5/8 Ã— 4/3 = 20/24ì…ë‹ˆë‹¤." 
    },
    191: { 
      question: "2:3ì˜ ë¹„ìœ¨ì„ ì†Œìˆ˜ë¡œ ë‚˜íƒ€ë‚´ë©´?
â‘  0.67
â‘¡ 1.5
â‘¢ 0.6", 
      answer: "â‘ ", 
      explanation: "2:3ì˜ ë¹„ìœ¨ì€ 2 Ã· 3 = 0.666... â‰ˆ 0.67ì…ë‹ˆë‹¤." 
    },
    192: { 
      question: "3:4ì˜ ë¹„ìœ¨ì„ ì†Œìˆ˜ë¡œ ë‚˜íƒ€ë‚´ë©´?
â‘  0.75
â‘¡ 1.33
â‘¢ 0.7", 
      answer: "â‘ ", 
      explanation: "3:4ì˜ ë¹„ìœ¨ì€ 3 Ã· 4 = 0.75ì…ë‹ˆë‹¤." 
    },
    193: { 
      question: "4:5ì˜ ë¹„ìœ¨ì„ ì†Œìˆ˜ë¡œ ë‚˜íƒ€ë‚´ë©´?
â‘  0.8
â‘¡ 1.25
â‘¢ 0.8", 
      answer: "â‘ ", 
      explanation: "4:5ì˜ ë¹„ìœ¨ì€ 4 Ã· 5 = 0.8ì…ë‹ˆë‹¤." 
    },
    194: { 
      question: "5:6ì˜ ë¹„ìœ¨ì„ ì†Œìˆ˜ë¡œ ë‚˜íƒ€ë‚´ë©´?
â‘  0.83
â‘¡ 1.2
â‘¢ 0.8", 
      answer: "â‘ ", 
      explanation: "5:6ì˜ ë¹„ìœ¨ì€ 5 Ã· 6 = 0.833... â‰ˆ 0.83ì…ë‹ˆë‹¤." 
    },
    195: { 
      question: "6:7ì˜ ë¹„ìœ¨ì„ ì†Œìˆ˜ë¡œ ë‚˜íƒ€ë‚´ë©´?
â‘  0.86
â‘¡ 1.17
â‘¢ 0.8", 
      answer: "â‘ ", 
      explanation: "6:7ì˜ ë¹„ìœ¨ì€ 6 Ã· 7 = 0.857... â‰ˆ 0.86ì…ë‹ˆë‹¤." 
    },
    196: { 
      question: "7:8ì˜ ë¹„ìœ¨ì„ ì†Œìˆ˜ë¡œ ë‚˜íƒ€ë‚´ë©´?
â‘  0.88
â‘¡ 1.14
â‘¢ 0.8", 
      answer: "â‘ ", 
      explanation: "7:8ì˜ ë¹„ìœ¨ì€ 7 Ã· 8 = 0.875 â‰ˆ 0.88ì…ë‹ˆë‹¤." 
    },
    197: { 
      question: "8:9ì˜ ë¹„ìœ¨ì„ ì†Œìˆ˜ë¡œ ë‚˜íƒ€ë‚´ë©´?
â‘  0.89
â‘¡ 1.13
â‘¢ 0.8", 
      answer: "â‘ ", 
      explanation: "8:9ì˜ ë¹„ìœ¨ì€ 8 Ã· 9 = 0.888... â‰ˆ 0.89ì…ë‹ˆë‹¤." 
    },
    198: { 
      question: "9:10ì˜ ë¹„ìœ¨ì„ ì†Œìˆ˜ë¡œ ë‚˜íƒ€ë‚´ë©´?
â‘  0.9
â‘¡ 1.11
â‘¢ 0.8", 
      answer: "â‘ ", 
      explanation: "9:10ì˜ ë¹„ìœ¨ì€ 9 Ã· 10 = 0.9ì…ë‹ˆë‹¤." 
    },
    199: { 
      question: "10:11ì˜ ë¹„ìœ¨ì„ ì†Œìˆ˜ë¡œ ë‚˜íƒ€ë‚´ë©´?
â‘  0.91
â‘¡ 1.1
â‘¢ 0.8", 
      answer: "â‘ ", 
      explanation: "10:11ì˜ ë¹„ìœ¨ì€ 10 Ã· 11 = 0.909... â‰ˆ 0.91ì…ë‹ˆë‹¤." 
    },
    200: { 
      question: "11:12ì˜ ë¹„ìœ¨ì„ ì†Œìˆ˜ë¡œ ë‚˜íƒ€ë‚´ë©´?
â‘  0.92
â‘¡ 1.09
â‘¢ 0.8", 
      answer: "â‘ ", 
      explanation: "11:12ì˜ ë¹„ìœ¨ì€ 11 Ã· 12 = 0.916... â‰ˆ 0.92ì…ë‹ˆë‹¤." 
    }
  };

  // ìŠ¤í…Œì´ì§€ì— ë§ëŠ” ë¬¸ì œ ê°€ì ¸ì˜¤ê¸°
  const problem = stageProblems[stageId as keyof typeof stageProblems];
  if (problem) {
    problems.push({
      question: problem.question,
      options: [problem.answer, "1.0", "2.0", "3.0"],
      correctAnswer: problem.answer,
      explanation: problem.explanation
    });
  }
  
  return problems;
}

// ì¤‘í•™êµ 1í•™ë…„ ë¬¸ì œ ìƒì„± - ê³ í’ˆì§ˆ ë¬¸ì œ
function _generateMiddle1Problems(stageId: number): any[] {
  const problems = [];
  
  // ìŠ¤í…Œì´ì§€ IDì— ë”°ë¥¸ ê³ ì •ëœ ë¬¸ì œ ìƒì„± (ì‹¤ì œ êµìœ¡ê³¼ì • ìˆ˜ì¤€)
  const stageProblems = {
    201: { 
      question: "3 + (-2) = ? (ì •ìˆ˜ì˜ ë§ì…ˆì„ ê³„ì‚°í•˜ì„¸ìš”)
â‘  1
â‘¡ -1
â‘¢ 5", 
      answer: "â‘ ", 
      explanation: "3 + (-2) = 3 - 2 = 1ì…ë‹ˆë‹¤. ì–‘ìˆ˜ì™€ ìŒìˆ˜ì˜ ë§ì…ˆì€ ëº„ì…ˆìœ¼ë¡œ ê³„ì‚°í•©ë‹ˆë‹¤." 
    },
    202: { 
      question: "-4 + 5 = ? (ì •ìˆ˜ì˜ ë§ì…ˆì„ ê³„ì‚°í•˜ì„¸ìš”)
â‘  1
â‘¡ -1
â‘¢ 9", 
      answer: "â‘ ", 
      explanation: "-4 + 5 = 5 - 4 = 1ì…ë‹ˆë‹¤. ìŒìˆ˜ì™€ ì–‘ìˆ˜ì˜ ë§ì…ˆì€ í° ìˆ˜ì—ì„œ ì‘ì€ ìˆ˜ë¥¼ ëºë‹ˆë‹¤." 
    },
    203: { 
      question: "-2 + (-3) = ? (ì •ìˆ˜ì˜ ë§ì…ˆì„ ê³„ì‚°í•˜ì„¸ìš”)
â‘  -5
â‘¡ 5
â‘¢ -1", 
      answer: "â‘ ", 
      explanation: "-2 + (-3) = -(2 + 3) = -5ì…ë‹ˆë‹¤. ìŒìˆ˜ë¼ë¦¬ì˜ ë§ì…ˆì€ ì ˆëŒ“ê°’ì„ ë”í•˜ê³  ìŒìˆ˜ ë¶€í˜¸ë¥¼ ë¶™ì…ë‹ˆë‹¤." 
    },
    204: { 
      question: "4 + (-6) = ? (ì •ìˆ˜ì˜ ë§ì…ˆì„ ê³„ì‚°í•˜ì„¸ìš”)
â‘  -2
â‘¡ 2
â‘¢ 10", 
      answer: "â‘ ", 
      explanation: "4 + (-6) = 4 - 6 = -2ì…ë‹ˆë‹¤. ì–‘ìˆ˜ì™€ ìŒìˆ˜ì˜ ë§ì…ˆì€ ëº„ì…ˆìœ¼ë¡œ ê³„ì‚°í•©ë‹ˆë‹¤." 
    },
    205: { 
      question: "-1 + 7 = ? (ì •ìˆ˜ì˜ ë§ì…ˆì„ ê³„ì‚°í•˜ì„¸ìš”)
â‘  6
â‘¡ -6
â‘¢ 8", 
      answer: "â‘ ", 
      explanation: "-1 + 7 = 7 - 1 = 6ì…ë‹ˆë‹¤. ìŒìˆ˜ì™€ ì–‘ìˆ˜ì˜ ë§ì…ˆì€ í° ìˆ˜ì—ì„œ ì‘ì€ ìˆ˜ë¥¼ ëºë‹ˆë‹¤." 
    },
    206: { 
      question: "5 + (-8) = ? (ì •ìˆ˜ì˜ ë§ì…ˆì„ ê³„ì‚°í•˜ì„¸ìš”)
â‘  -3
â‘¡ 3
â‘¢ 13", 
      answer: "â‘ ", 
      explanation: "5 + (-8) = 5 - 8 = -3ì…ë‹ˆë‹¤. ì–‘ìˆ˜ì™€ ìŒìˆ˜ì˜ ë§ì…ˆì€ ëº„ì…ˆìœ¼ë¡œ ê³„ì‚°í•©ë‹ˆë‹¤." 
    },
    207: { 
      question: "-3 + (-4) = ? (ì •ìˆ˜ì˜ ë§ì…ˆì„ ê³„ì‚°í•˜ì„¸ìš”)
â‘  -7
â‘¡ 7
â‘¢ -1", 
      answer: "â‘ ", 
      explanation: "-3 + (-4) = -(3 + 4) = -7ì…ë‹ˆë‹¤. ìŒìˆ˜ë¼ë¦¬ì˜ ë§ì…ˆì€ ì ˆëŒ“ê°’ì„ ë”í•˜ê³  ìŒìˆ˜ ë¶€í˜¸ë¥¼ ë¶™ì…ë‹ˆë‹¤." 
    },
    208: { 
      question: "6 + (-9) = ? (ì •ìˆ˜ì˜ ë§ì…ˆì„ ê³„ì‚°í•˜ì„¸ìš”)
â‘  -3
â‘¡ 3
â‘¢ 15", 
      answer: "â‘ ", 
      explanation: "6 + (-9) = 6 - 9 = -3ì…ë‹ˆë‹¤. ì–‘ìˆ˜ì™€ ìŒìˆ˜ì˜ ë§ì…ˆì€ ëº„ì…ˆìœ¼ë¡œ ê³„ì‚°í•©ë‹ˆë‹¤." 
    },
    209: { 
      question: "-5 + 8 = ? (ì •ìˆ˜ì˜ ë§ì…ˆì„ ê³„ì‚°í•˜ì„¸ìš”)
â‘  3
â‘¡ -3
â‘¢ 13", 
      answer: "â‘ ", 
      explanation: "-5 + 8 = 8 - 5 = 3ì…ë‹ˆë‹¤. ìŒìˆ˜ì™€ ì–‘ìˆ˜ì˜ ë§ì…ˆì€ í° ìˆ˜ì—ì„œ ì‘ì€ ìˆ˜ë¥¼ ëºë‹ˆë‹¤." 
    },
    210: { 
      question: "2 + (-7) = ? (ì •ìˆ˜ì˜ ë§ì…ˆì„ ê³„ì‚°í•˜ì„¸ìš”)
â‘  -5
â‘¡ 5
â‘¢ 9", 
      answer: "â‘ ", 
      explanation: "2 + (-7) = 2 - 7 = -5ì…ë‹ˆë‹¤. ì–‘ìˆ˜ì™€ ìŒìˆ˜ì˜ ë§ì…ˆì€ ëº„ì…ˆìœ¼ë¡œ ê³„ì‚°í•©ë‹ˆë‹¤." 
    },
    211: { 
      question: "|-3| = ? (ì ˆëŒ“ê°’ì„ êµ¬í•˜ì„¸ìš”)
â‘  3
â‘¡ -3
â‘¢ 0", 
      answer: "â‘ ", 
      explanation: "|-3| = 3ì…ë‹ˆë‹¤. ì ˆëŒ“ê°’ì€ ìˆ˜ì§ì„ ì—ì„œ 0ìœ¼ë¡œë¶€í„°ì˜ ê±°ë¦¬ì´ë¯€ë¡œ í•­ìƒ ì–‘ìˆ˜ì…ë‹ˆë‹¤." 
    },
    212: { 
      question: "|5| = ? (ì ˆëŒ“ê°’ì„ êµ¬í•˜ì„¸ìš”)
â‘  5
â‘¡ -5
â‘¢ 0", 
      answer: "â‘ ", 
      explanation: "|5| = 5ì…ë‹ˆë‹¤. ì–‘ìˆ˜ì˜ ì ˆëŒ“ê°’ì€ ê·¸ ìˆ˜ ìì‹ ì…ë‹ˆë‹¤." 
    },
    213: { 
      question: "|-7| = ? (ì ˆëŒ“ê°’ì„ êµ¬í•˜ì„¸ìš”)
â‘  7
â‘¡ -7
â‘¢ 0", 
      answer: "â‘ ", 
      explanation: "|-7| = 7ì…ë‹ˆë‹¤. ìŒìˆ˜ì˜ ì ˆëŒ“ê°’ì€ ê·¸ ìˆ˜ì˜ ë¶€í˜¸ë¥¼ ë°”ê¾¼ ìˆ˜ì…ë‹ˆë‹¤." 
    },
    214: { 
      question: "|0| = ? (ì ˆëŒ“ê°’ì„ êµ¬í•˜ì„¸ìš”)
â‘  0
â‘¡ 1
â‘¢ -1", 
      answer: "â‘ ", 
      explanation: "|0| = 0ì…ë‹ˆë‹¤. 0ì˜ ì ˆëŒ“ê°’ì€ 0ì…ë‹ˆë‹¤." 
    },
    215: { 
      question: "|-9| = ? (ì ˆëŒ“ê°’ì„ êµ¬í•˜ì„¸ìš”)
â‘  9
â‘¡ -9
â‘¢ 0", 
      answer: "â‘ ", 
      explanation: "|-9| = 9ì…ë‹ˆë‹¤. ìŒìˆ˜ì˜ ì ˆëŒ“ê°’ì€ ê·¸ ìˆ˜ì˜ ë¶€í˜¸ë¥¼ ë°”ê¾¼ ìˆ˜ì…ë‹ˆë‹¤." 
    },
    216: { 
      question: "|4| = ? (ì ˆëŒ“ê°’ì„ êµ¬í•˜ì„¸ìš”)
â‘  4
â‘¡ -4
â‘¢ 0", 
      answer: "â‘ ", 
      explanation: "|4| = 4ì…ë‹ˆë‹¤. ì–‘ìˆ˜ì˜ ì ˆëŒ“ê°’ì€ ê·¸ ìˆ˜ ìì‹ ì…ë‹ˆë‹¤." 
    },
    217: { 
      question: "|-6| = ? (ì ˆëŒ“ê°’ì„ êµ¬í•˜ì„¸ìš”)
â‘  6
â‘¡ -6
â‘¢ 0", 
      answer: "â‘ ", 
      explanation: "|-6| = 6ì…ë‹ˆë‹¤. ìŒìˆ˜ì˜ ì ˆëŒ“ê°’ì€ ê·¸ ìˆ˜ì˜ ë¶€í˜¸ë¥¼ ë°”ê¾¼ ìˆ˜ì…ë‹ˆë‹¤." 
    },
    218: { 
      question: "|8| = ? (ì ˆëŒ“ê°’ì„ êµ¬í•˜ì„¸ìš”)
â‘  8
â‘¡ -8
â‘¢ 0", 
      answer: "â‘ ", 
      explanation: "|8| = 8ì…ë‹ˆë‹¤. ì–‘ìˆ˜ì˜ ì ˆëŒ“ê°’ì€ ê·¸ ìˆ˜ ìì‹ ì…ë‹ˆë‹¤." 
    },
    219: { 
      question: "|-2| = ? (ì ˆëŒ“ê°’ì„ êµ¬í•˜ì„¸ìš”)
â‘  2
â‘¡ -2
â‘¢ 0", 
      answer: "â‘ ", 
      explanation: "|-2| = 2ì…ë‹ˆë‹¤. ìŒìˆ˜ì˜ ì ˆëŒ“ê°’ì€ ê·¸ ìˆ˜ì˜ ë¶€í˜¸ë¥¼ ë°”ê¾¼ ìˆ˜ì…ë‹ˆë‹¤." 
    },
    220: { 
      question: "|1| = ? (ì ˆëŒ“ê°’ì„ êµ¬í•˜ì„¸ìš”)
â‘  1
â‘¡ -1
â‘¢ 0", 
      answer: "â‘ ", 
      explanation: "|1| = 1ì…ë‹ˆë‹¤. ì–‘ìˆ˜ì˜ ì ˆëŒ“ê°’ì€ ê·¸ ìˆ˜ ìì‹ ì…ë‹ˆë‹¤." 
    }
  };

  // ìŠ¤í…Œì´ì§€ì— ë§ëŠ” ë¬¸ì œ ê°€ì ¸ì˜¤ê¸°
  const problem = stageProblems[stageId as keyof typeof stageProblems];
  if (problem) {
    problems.push({
      question: problem.question,
      options: [problem.answer, "0", "1", "2"],
      correctAnswer: problem.answer,
      explanation: problem.explanation
    });
  }
  
  return problems;
}

// ì¤‘í•™êµ 2í•™ë…„ ë¬¸ì œ ìƒì„± - ê³ í’ˆì§ˆ ë¬¸ì œ
function _generateMiddle2Problems(stageId: number): any[] {
  const problems = [];
  
  // ìŠ¤í…Œì´ì§€ IDì— ë”°ë¥¸ ê³ ì •ëœ ë¬¸ì œ ìƒì„± (ì‹¤ì œ êµìœ¡ê³¼ì • ìˆ˜ì¤€)
  const stageProblems = {
    221: { 
      question: "2x + 3 = 7ì¼ ë•Œ, xì˜ ê°’ì€?
â‘  2
â‘¡ 3
â‘¢ 4", 
      answer: "â‘ ", 
      explanation: "2x + 3 = 7ì—ì„œ 2x = 7 - 3 = 4, x = 4 Ã· 2 = 2ì…ë‹ˆë‹¤." 
    },
    222: { 
      question: "3x + 1 = 10ì¼ ë•Œ, xì˜ ê°’ì€?
â‘  3
â‘¡ 2
â‘¢ 4", 
      answer: "â‘ ", 
      explanation: "3x + 1 = 10ì—ì„œ 3x = 10 - 1 = 9, x = 9 Ã· 3 = 3ì…ë‹ˆë‹¤." 
    },
    223: { 
      question: "4x + 2 = 14ì¼ ë•Œ, xì˜ ê°’ì€?
â‘  3
â‘¡ 2
â‘¢ 4", 
      answer: "â‘ ", 
      explanation: "4x + 2 = 14ì—ì„œ 4x = 14 - 2 = 12, x = 12 Ã· 4 = 3ì…ë‹ˆë‹¤." 
    },
    224: { 
      question: "5x + 1 = 16ì¼ ë•Œ, xì˜ ê°’ì€?
â‘  3
â‘¡ 2
â‘¢ 4", 
      answer: "â‘ ", 
      explanation: "5x + 1 = 16ì—ì„œ 5x = 16 - 1 = 15, x = 15 Ã· 5 = 3ì…ë‹ˆë‹¤." 
    },
    225: { 
      question: "2x + 5 = 11ì¼ ë•Œ, xì˜ ê°’ì€?
â‘  3
â‘¡ 2
â‘¢ 4", 
      answer: "â‘ ", 
      explanation: "2x + 5 = 11ì—ì„œ 2x = 11 - 5 = 6, x = 6 Ã· 2 = 3ì…ë‹ˆë‹¤." 
    },
    226: { 
      question: "3x + 4 = 13ì¼ ë•Œ, xì˜ ê°’ì€?
â‘  3
â‘¡ 2
â‘¢ 4", 
      answer: "â‘ ", 
      explanation: "3x + 4 = 13ì—ì„œ 3x = 13 - 4 = 9, x = 9 Ã· 3 = 3ì…ë‹ˆë‹¤." 
    },
    227: { 
      question: "4x + 3 = 15ì¼ ë•Œ, xì˜ ê°’ì€?
â‘  3
â‘¡ 2
â‘¢ 4", 
      answer: "â‘ ", 
      explanation: "4x + 3 = 15ì—ì„œ 4x = 15 - 3 = 12, x = 12 Ã· 4 = 3ì…ë‹ˆë‹¤." 
    },
    228: { 
      question: "5x + 2 = 17ì¼ ë•Œ, xì˜ ê°’ì€?
â‘  3
â‘¡ 2
â‘¢ 4", 
      answer: "â‘ ", 
      explanation: "5x + 2 = 17ì—ì„œ 5x = 17 - 2 = 15, x = 15 Ã· 5 = 3ì…ë‹ˆë‹¤." 
    },
    229: { 
      question: "2x + 7 = 13ì¼ ë•Œ, xì˜ ê°’ì€?
â‘  3
â‘¡ 2
â‘¢ 4", 
      answer: "â‘ ", 
      explanation: "2x + 7 = 13ì—ì„œ 2x = 13 - 7 = 6, x = 6 Ã· 2 = 3ì…ë‹ˆë‹¤." 
    },
    230: { 
      question: "3x + 6 = 15ì¼ ë•Œ, xì˜ ê°’ì€?
â‘  3
â‘¡ 2
â‘¢ 4", 
      answer: "â‘ ", 
      explanation: "3x + 6 = 15ì—ì„œ 3x = 15 - 6 = 9, x = 9 Ã· 3 = 3ì…ë‹ˆë‹¤." 
    },
    231: { 
      question: "ì—°ë¦½ë°©ì •ì‹ 2x + 3y = 8, 3x + 2y = 7ì˜ í•´ì—ì„œ xì˜ ê°’ì€?
â‘  1
â‘¡ 2
â‘¢ 3", 
      answer: "â‘ ", 
      explanation: "ì—°ë¦½ë°©ì •ì‹ì„ í’€ë©´ x = 1, y = 2ì…ë‹ˆë‹¤. ê°€ê°ë²•ì´ë‚˜ ëŒ€ì…ë²•ì„ ì‚¬ìš©í•˜ì—¬ í’€ ìˆ˜ ìˆìŠµë‹ˆë‹¤." 
    },
    232: { 
      question: "ì—°ë¦½ë°©ì •ì‹ 3x + 4y = 11, 2x + 3y = 8ì˜ í•´ì—ì„œ xì˜ ê°’ì€?
â‘  1
â‘¡ 2
â‘¢ 3", 
      answer: "â‘ ", 
      explanation: "ì—°ë¦½ë°©ì •ì‹ì„ í’€ë©´ x = 1, y = 2ì…ë‹ˆë‹¤. ê°€ê°ë²•ì´ë‚˜ ëŒ€ì…ë²•ì„ ì‚¬ìš©í•˜ì—¬ í’€ ìˆ˜ ìˆìŠµë‹ˆë‹¤." 
    },
    233: { 
      question: "ì—°ë¦½ë°©ì •ì‹ 4x + 5y = 14, 3x + 4y = 11ì˜ í•´ì—ì„œ xì˜ ê°’ì€?
â‘  1
â‘¡ 2
â‘¢ 3", 
      answer: "â‘ ", 
      explanation: "ì—°ë¦½ë°©ì •ì‹ì„ í’€ë©´ x = 1, y = 2ì…ë‹ˆë‹¤. ê°€ê°ë²•ì´ë‚˜ ëŒ€ì…ë²•ì„ ì‚¬ìš©í•˜ì—¬ í’€ ìˆ˜ ìˆìŠµë‹ˆë‹¤." 
    },
    234: { 
      question: "ì—°ë¦½ë°©ì •ì‹ 5x + 6y = 17, 4x + 5y = 14ì˜ í•´ì—ì„œ xì˜ ê°’ì€?
â‘  1
â‘¡ 2
â‘¢ 3", 
      answer: "â‘ ", 
      explanation: "ì—°ë¦½ë°©ì •ì‹ì„ í’€ë©´ x = 1, y = 2ì…ë‹ˆë‹¤. ê°€ê°ë²•ì´ë‚˜ ëŒ€ì…ë²•ì„ ì‚¬ìš©í•˜ì—¬ í’€ ìˆ˜ ìˆìŠµë‹ˆë‹¤." 
    },
    235: { 
      question: "ì—°ë¦½ë°©ì •ì‹ 2x + 5y = 12, 3x + 4y = 11ì˜ í•´ì—ì„œ xì˜ ê°’ì€?
â‘  1
â‘¡ 2
â‘¢ 3", 
      answer: "â‘ ", 
      explanation: "ì—°ë¦½ë°©ì •ì‹ì„ í’€ë©´ x = 1, y = 2ì…ë‹ˆë‹¤. ê°€ê°ë²•ì´ë‚˜ ëŒ€ì…ë²•ì„ ì‚¬ìš©í•˜ì—¬ í’€ ìˆ˜ ìˆìŠµë‹ˆë‹¤." 
    },
    236: { 
      question: "ì—°ë¦½ë°©ì •ì‹ 3x + 6y = 15, 4x + 5y = 14ì˜ í•´ì—ì„œ xì˜ ê°’ì€?
â‘  1
â‘¡ 2
â‘¢ 3", 
      answer: "â‘ ", 
      explanation: "ì—°ë¦½ë°©ì •ì‹ì„ í’€ë©´ x = 1, y = 2ì…ë‹ˆë‹¤. ê°€ê°ë²•ì´ë‚˜ ëŒ€ì…ë²•ì„ ì‚¬ìš©í•˜ì—¬ í’€ ìˆ˜ ìˆìŠµë‹ˆë‹¤." 
    },
    237: { 
      question: "ì—°ë¦½ë°©ì •ì‹ 4x + 7y = 18, 5x + 6y = 17ì˜ í•´ì—ì„œ xì˜ ê°’ì€?
â‘  1
â‘¡ 2
â‘¢ 3", 
      answer: "â‘ ", 
      explanation: "ì—°ë¦½ë°©ì •ì‹ì„ í’€ë©´ x = 1, y = 2ì…ë‹ˆë‹¤. ê°€ê°ë²•ì´ë‚˜ ëŒ€ì…ë²•ì„ ì‚¬ìš©í•˜ì—¬ í’€ ìˆ˜ ìˆìŠµë‹ˆë‹¤." 
    },
    238: { 
      question: "ì—°ë¦½ë°©ì •ì‹ 5x + 8y = 21, 6x + 7y = 20ì˜ í•´ì—ì„œ xì˜ ê°’ì€?
â‘  1
â‘¡ 2
â‘¢ 3", 
      answer: "â‘ ", 
      explanation: "ì—°ë¦½ë°©ì •ì‹ì„ í’€ë©´ x = 1, y = 2ì…ë‹ˆë‹¤. ê°€ê°ë²•ì´ë‚˜ ëŒ€ì…ë²•ì„ ì‚¬ìš©í•˜ì—¬ í’€ ìˆ˜ ìˆìŠµë‹ˆë‹¤." 
    },
    239: { 
      question: "ì—°ë¦½ë°©ì •ì‹ 2x + 9y = 20, 3x + 8y = 19ì˜ í•´ì—ì„œ xì˜ ê°’ì€?
â‘  1
â‘¡ 2
â‘¢ 3", 
      answer: "â‘ ", 
      explanation: "ì—°ë¦½ë°©ì •ì‹ì„ í’€ë©´ x = 1, y = 2ì…ë‹ˆë‹¤. ê°€ê°ë²•ì´ë‚˜ ëŒ€ì…ë²•ì„ ì‚¬ìš©í•˜ì—¬ í’€ ìˆ˜ ìˆìŠµë‹ˆë‹¤." 
    },
    240: { 
      question: "ì—°ë¦½ë°©ì •ì‹ 3x + 10y = 23, 4x + 9y = 22ì˜ í•´ì—ì„œ xì˜ ê°’ì€?
â‘  1
â‘¡ 2
â‘¢ 3", 
      answer: "â‘ ", 
      explanation: "ì—°ë¦½ë°©ì •ì‹ì„ í’€ë©´ x = 1, y = 2ì…ë‹ˆë‹¤. ê°€ê°ë²•ì´ë‚˜ ëŒ€ì…ë²•ì„ ì‚¬ìš©í•˜ì—¬ í’€ ìˆ˜ ìˆìŠµë‹ˆë‹¤." 
    }
  };

  // ìŠ¤í…Œì´ì§€ì— ë§ëŠ” ë¬¸ì œ ê°€ì ¸ì˜¤ê¸°
  const problem = stageProblems[stageId as keyof typeof stageProblems];
  if (problem) {
    problems.push({
      question: problem.question,
      options: [problem.answer, "1", "2", "3"],
      correctAnswer: problem.answer,
      explanation: problem.explanation
    });
  }
  
  return problems;
}

// ì¤‘í•™êµ 3í•™ë…„ ë¬¸ì œ ìƒì„± - ì‚¬ìš©í•˜ì§€ ì•ŠìŒ
function _generateMiddle3Problems(stageId: number): any[] {
  const problems = [];
  
  if (stageId <= 310) {
    // ë‹¤í•­ì‹, ê³±ì…ˆê³¼ ì¸ìˆ˜ë¶„í•´
    const a = Math.floor(Math.random() * 5) + 1;
    const b = Math.floor(Math.random() * 5) + 1;
    const c = Math.floor(Math.random() * 5) + 1;
    const result = a + b + c;
    const objects = ['ì‚¬ê³¼', 'ê³µ', 'ë³„'];
    const object = objects[Math.floor(Math.random() * objects.length)];
    problems.push({
      question: `ğŸ ${object} ${a}ê°œì”© xÂ²ë¬¶ìŒê³¼ ${b}ê°œì”© xë¬¶ìŒ, ${c}ê°œë¥¼ í•©í•˜ë©´ x = 1ì¼ ë•Œ ëª‡ ê°œì¸ê°€ìš”?`,
      options: [result.toString(), (result + 1).toString(), (result - 1).toString(), (result + 2).toString()],
      correctAnswer: result.toString(),
      explanation: `x = 1ì„ ëŒ€ì…í•˜ë©´ ${a}(1)Â² + ${b}(1) + ${c} = ${a} + ${b} + ${c} = ${result}ì…ë‹ˆë‹¤!`
    });
  } else if (stageId <= 320) {
    // ì´ì°¨ë°©ì •ì‹
    const x = Math.floor(Math.random() * 5) + 1;
    const b = -2 * x;
    const c = x * x;
    const objects = ['ì‚¬ê³¼', 'ê³µ', 'ë³„'];
    const object = objects[Math.floor(Math.random() * objects.length)];
    problems.push({
      question: `ğŸ ${object} xÂ² + ${b}x + ${c} = 0ì¼ ë•Œ xì˜ ê°’ì€?`,
      options: [x.toString(), (x + 1).toString(), (x - 1).toString(), (x + 2).toString()],
      correctAnswer: x.toString(),
      explanation: `xÂ² + ${b}x + ${c} = 0ì€ (x - ${x})Â² = 0ì´ë¯€ë¡œ x = ${x}ì…ë‹ˆë‹¤!`
    });
  }
  
  return problems;
}

function _generateOptions(type: string, numbers?: number[]): string[] {
  if (!numbers) {
    return ['1', '2', '3', '4'];
  }

  let correctAnswer: number;
  let options: string[] = [];

  switch (type) {
    case 'comparison':
      correctAnswer = Math.max(...numbers);
      options = numbers.map(n => n.toString());
      break;
    
    case 'addition':
      correctAnswer = numbers[0] + numbers[1];
      options = generateMathOptions(correctAnswer, 4);
      break;
    
    case 'subtraction':
      correctAnswer = numbers[0] - numbers[1];
      options = generateMathOptions(correctAnswer, 4);
      break;
    
    case 'multiplication':
      correctAnswer = numbers[0] * numbers[1];
      options = generateMathOptions(correctAnswer, 4);
      break;
    
    case 'division':
      correctAnswer = numbers[0] / numbers[1];
      options = generateMathOptions(correctAnswer, 4);
      break;
    
    case 'fraction_addition':
      correctAnswer = (numbers[0] + numbers[2]) / (numbers[1] + numbers[3]);
      options = generateFractionOptions(correctAnswer);
      break;
    
    case 'fraction_subtraction':
      correctAnswer = (numbers[0] - numbers[2]) / (numbers[1] - numbers[3]);
      options = generateFractionOptions(correctAnswer);
      break;
    
    case 'decimal_addition':
      correctAnswer = numbers[0] + numbers[1];
      options = generateDecimalOptions(correctAnswer);
      break;
    
    case 'counting':
      correctAnswer = numbers.length;
      options = generateMathOptions(correctAnswer, 4);
      break;
    
    case 'matching':
      correctAnswer = numbers[1]; // ë‘ ë²ˆì§¸ ìˆ˜ê°€ ì •ë‹µ
      options = numbers.map(n => n.toString());
      break;
    
    default:
      correctAnswer = 5;
      options = ['3', '4', '5', '6'];
  }

  return options;
}

// ìˆ˜í•™ ë¬¸ì œ ì˜µì…˜ ìƒì„±
function generateMathOptions(correctAnswer: number, count: number): string[] {
  const options = new Set<string>();
  options.add(correctAnswer.toString());
  
  // ì •ë‹µ ì£¼ë³€ì˜ ìˆ«ìë“¤ë¡œ ì˜µì…˜ ìƒì„±
  while (options.size < count) {
    const offset = Math.floor(Math.random() * 4) + 1;
    const sign = Math.random() > 0.5 ? 1 : -1;
    const option = correctAnswer + (offset * sign);
    if (option > 0) {
      options.add(option.toString());
    }
  }
  
  return Array.from(options).slice(0, count);
}

// ë¶„ìˆ˜ ì˜µì…˜ ìƒì„±
function generateFractionOptions(correctAnswer: number): string[] {
  const options = new Set<string>();
  
  // ì •ë‹µì„ ë¶„ìˆ˜ë¡œ í‘œí˜„
  if (correctAnswer === 1) {
    options.add('1');
    options.add('2/2');
    options.add('3/3');
    options.add('4/4');
  } else if (correctAnswer === 0.5) {
    options.add('1/2');
    options.add('2/4');
    options.add('3/6');
    options.add('4/8');
  } else if (correctAnswer === 0.33) {
    options.add('1/3');
    options.add('2/6');
    options.add('3/9');
    options.add('4/12');
  } else {
    options.add('1/2');
    options.add('1/3');
    options.add('2/3');
    options.add('1');
  }
  
  return Array.from(options).slice(0, 4);
}

// ì†Œìˆ˜ ì˜µì…˜ ìƒì„±
function generateDecimalOptions(correctAnswer: number): string[] {
  const options = new Set<string>();
  options.add(correctAnswer.toFixed(1));
  
  while (options.size < 4) {
    const offset = (Math.random() * 0.3 + 0.1) * (Math.random() > 0.5 ? 1 : -1);
    const option = (correctAnswer + offset).toFixed(1);
    if (parseFloat(option) > 0) {
      options.add(option);
    }
  }
  
  return Array.from(options).slice(0, 4);
}

function _generateCorrectAnswer(type: string, numbers?: number[]): string {
  if (!numbers) {
    return '5';
  }

  let correctAnswer: number;

  switch (type) {
    case 'comparison':
      correctAnswer = Math.max(...numbers);
      break;
    
    case 'addition':
      correctAnswer = numbers[0] + numbers[1];
      break;
    
    case 'subtraction':
      correctAnswer = numbers[0] - numbers[1];
      break;
    
    case 'multiplication':
      correctAnswer = numbers[0] * numbers[1];
      break;
    
    case 'division':
      correctAnswer = numbers[0] / numbers[1];
      break;
    
    case 'fraction_addition':
      correctAnswer = (numbers[0] + numbers[2]) / (numbers[1] + numbers[3]);
      break;
    
    case 'fraction_subtraction':
      correctAnswer = (numbers[0] - numbers[2]) / (numbers[1] - numbers[3]);
      break;
    
    case 'decimal_addition':
      correctAnswer = numbers[0] + numbers[1];
      break;
    
    case 'counting':
      correctAnswer = numbers.length;
      break;
    
    case 'matching':
      correctAnswer = numbers[1]; // ë‘ ë²ˆì§¸ ìˆ˜ê°€ ì •ë‹µ
      break;
    
    default:
      correctAnswer = 5;
  }

  // ë¶„ìˆ˜ë‚˜ ì†Œìˆ˜ì¸ ê²½ìš° ì ì ˆí•œ í˜•íƒœë¡œ ë°˜í™˜
  if (type.includes('fraction')) {
    if (correctAnswer === 1) return '1';
    if (correctAnswer === 0.5) return '1/2';
    if (correctAnswer === 0.33) return '1/3';
    return correctAnswer.toString();
  }
  
  if (type.includes('decimal')) {
    return correctAnswer.toFixed(1);
  }
  
  return correctAnswer.toString();
}

function _generateExplanation(type: string, numbers?: number[]): string {
  if (!numbers) {
    return 'ì •ë‹µì…ë‹ˆë‹¤!';
  }

  switch (type) {
    case 'comparison':
      const max = Math.max(...numbers);
      return `${max}ê°€ ê°€ì¥ í° ìˆ˜ì…ë‹ˆë‹¤.`;
    
    case 'addition':
      const sum = numbers[0] + numbers[1];
      return `${numbers[0]} + ${numbers[1]} = ${sum}ì…ë‹ˆë‹¤.`;
    
    case 'subtraction':
      const diff = numbers[0] - numbers[1];
      return `${numbers[0]} - ${numbers[1]} = ${diff}ì…ë‹ˆë‹¤.`;
    
    case 'multiplication':
      const product = numbers[0] * numbers[1];
      return `${numbers[0]} Ã— ${numbers[1]} = ${product}ì…ë‹ˆë‹¤.`;
    
    case 'division':
      const quotient = numbers[0] / numbers[1];
      return `${numbers[0]} Ã· ${numbers[1]} = ${quotient}ì…ë‹ˆë‹¤.`;
    
    case 'fraction_addition':
      const fracSum = (numbers[0] + numbers[2]) / (numbers[1] + numbers[3]);
      return `${numbers[0]}/${numbers[1]} + ${numbers[2]}/${numbers[3]} = ${fracSum}ì…ë‹ˆë‹¤.`;
    
    case 'fraction_subtraction':
      const fracDiff = (numbers[0] - numbers[2]) / (numbers[1] - numbers[3]);
      return `${numbers[0]}/${numbers[1]} - ${numbers[2]}/${numbers[3]} = ${fracDiff}ì…ë‹ˆë‹¤.`;
    
    case 'decimal_addition':
      const decimalSum = numbers[0] + numbers[1];
      return `${numbers[0]} + ${numbers[1]} = ${decimalSum}ì…ë‹ˆë‹¤.`;
    
    case 'counting':
      return `1ë¶€í„° ${numbers.length}ê¹Œì§€ ì„¸ë©´ ì´ ${numbers.length}ê°œì…ë‹ˆë‹¤.`;
    
    case 'matching':
      return `${numbers[1]}ì´ ì •ë‹µì…ë‹ˆë‹¤.`;
    
    default:
      return 'ì •ë‹µì…ë‹ˆë‹¤!';
  }
}
